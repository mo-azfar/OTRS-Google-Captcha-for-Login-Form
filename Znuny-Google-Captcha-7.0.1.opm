<?xml version="1.0" encoding="utf-8" ?>
<otrs_package version="1.1">
    <Name>Znuny-Google-Captcha</Name>
    <Version>7.0.1</Version>
    <Vendor>mo-azfar</Vendor>
    <URL>https://github.com/mo-azfar/OTRS-Google-Captcha-for-Login-Form</URL>
    <License>GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007</License>
    <ChangeLog Date="2023-08-21 00:00:01" Version="7.0.1">New package.</ChangeLog>
    <Description Lang="en">Google reCaptcha at Znuny agent portal and customer portal (login form).</Description>
    <Framework>7.0.x</Framework>
    <IntroInstall Lang="en" Title="Install Information" Type="pre">
        &lt;br&gt;
        &lt;b&gt;WELCOME&lt;/b&gt;
        &lt;br&gt;
        &lt;br&gt;
        You are about to install the package Znuny-Google-Captcha. Make sure cpan module &lt;b&gt;Captcha::reCAPTCHA::V2&lt;/b&gt; is installed first.&lt;br/&gt;&lt;br/&gt;Check &lt;a href='https://github.com/mo-azfar/OTRS-Google-Captcha-for-Login-Form' target='_blank'&gt;README&lt;/a&gt;&lt;br&gt;
        &lt;br&gt;
        &lt;br&gt;
		DO RESTART YOUR WEBSERVER AFTERWARDS
		&lt;br&gt;
        ((enjoy))&lt;br&gt;
        &lt;br&gt;
    </IntroInstall>
    <BuildDate>2023-08-21 17:08:05</BuildDate>
    <BuildHost>app.myserver.com</BuildHost>
    <Filelist>
        <File Location="Kernel/Config/Files/XML/ZZZGoogleCaptcha.xml" Permission="660" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxvdHJzX2NvbmZpZyB2ZXJzaW9uPSIyLjAiIGluaXQ9IkNvbmZpZyI+DQogICAgPFNldHRpbmcgTmFtZT0iRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QjIyNTaG93R29vZ2xlQ2FwdGNoYSIgUmVxdWlyZWQ9IjAiIFZhbGlkPSIxIj4NCiAgICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+TW9kdWxlIHRvIHNob3cgZ29vZ2xlIGNhcGN0aGEuPC9EZXNjcmlwdGlvbj4NCiAgICAgICAgPE5hdmlnYXRpb24+RnJvbnRlbmQ6OkJhc2U6Ok91dHB1dEZpbHRlcjwvTmF2aWdhdGlvbj4NCiAgICAgICAgPFZhbHVlPg0KICAgICAgICAgICAgPEhhc2g+DQogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJNb2R1bGUiPktlcm5lbDo6T3V0cHV0OjpIVE1MOjpGaWx0ZXJFbGVtZW50UG9zdDo6U2hvd0dvb2dsZUNhcHRjaGE8L0l0ZW0+DQogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJUZW1wbGF0ZXMiPg0KICAgICAgICAgICAgICAgICAgICA8SGFzaD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxJdGVtIEtleT0iTG9naW4iPjA8L0l0ZW0+DQoJCQkJCQk8SXRlbSBLZXk9IkN1c3RvbWVyTG9naW4iPjA8L0l0ZW0+DQogICAgICAgICAgICAgICAgICAgIDwvSGFzaD4NCiAgICAgICAgICAgICAgICA8L0l0ZW0+DQogICAgICAgICAgICA8L0hhc2g+DQogICAgICAgIDwvVmFsdWU+DQogICAgPC9TZXR0aW5nPg0KCTxTZXR0aW5nIE5hbWU9Ikdvb2dsZUNhcHRjaGE6OlNpdGVLZXkiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMSI+DQogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPkRlZmluZXMgdGhlIGdvb2dsZSByZWNhcHRjaGEgc2l0ZSBrZXk8L0Rlc2NyaXB0aW9uPg0KICAgICAgICA8TmF2aWdhdGlvbj5Hb29nbGVDYXB0Y2hhPC9OYXZpZ2F0aW9uPg0KICAgICAgICA8VmFsdWU+DQogICAgICAgICAgICA8SXRlbSBWYWx1ZVR5cGU9IlN0cmluZyIgVmFsdWVSZWdleD0iIj5TSVRFX0tFWV9IRVJFPC9JdGVtPg0KICAgICAgICA8L1ZhbHVlPg0KICAgIDwvU2V0dGluZz4NCiAgICA8U2V0dGluZyBOYW1lPSJHb29nbGVDYXB0Y2hhOjpTZWNyZXRLZXkiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMSI+DQogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPkRlZmluZXMgdGhlIGdvb2dsZSByZWNhcHRjaGEgc2VjcmV0IGtleTwvRGVzY3JpcHRpb24+DQogICAgICAgIDxOYXZpZ2F0aW9uPkdvb2dsZUNhcHRjaGE8L05hdmlnYXRpb24+DQogICAgICAgIDxWYWx1ZT4NCiAgICAgICAgICAgIDxJdGVtIFZhbHVlVHlwZT0iU3RyaW5nIiBWYWx1ZVJlZ2V4PSIiPlNFQ1JFVF9LRVlfSEVSRTwvSXRlbT4NCiAgICAgICAgPC9WYWx1ZT4NCiAgICA8L1NldHRpbmc+DQo8L290cnNfY29uZmlnPg0K</File>
        <File Location="Custom/Kernel/Output/HTML/FilterElementPost/ShowGoogleCaptcha.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkZpbHRlckVsZW1lbnRQb3N0OjpTaG93R29vZ2xlQ2FwdGNoYTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnLAopOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJENvbmZpZ09iamVjdCAgICAgICAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgI215ICRQYXJhbU9iamVjdCAgICAgICAgICAgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoJCgkjIC0tCgkjIEFnZW50IEdvb2dsZSBDYXB0Y2hhCgkjIC0tCglpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9IGVxICdMb2dpbicpCiAgICB7CgkJdXNlIENhcHRjaGE6OnJlQ0FQVENIQTo6VjI7CiAgICAgICAgbXkgJFNpdGVLZXkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0dvb2dsZUNhcHRjaGE6OlNpdGVLZXknKTsJCQogICAgICAgIG15ICRyYyA9IENhcHRjaGE6OnJlQ0FQVENIQTo6VjItPm5ldzsKCQlteSAkY2FwdGNoYWZpZWxkID0gJHJjLT5odG1sKCRTaXRlS2V5LCB7IHRoZW1lID0+ICdkYXJrJyB9LCB7IHNpemUgPT4gJ2NvbXBhY3QnIH0sIHsgdHlwZSA9PiAnaW1hZ2UnIH0pOwoJCW15ICRGaWVsZCA9IHFxfgoJCTxkaXY+JGNhcHRjaGFmaWVsZDwvZGl2PgoJCX47CgkgICAgICAgICAgICAKCQlteSAkU2VhcmNoRmllbGQgPSBxdW90ZW1ldGEgIjxkaXYgY2xhc3M9XCJGaWVsZFwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBpZD1cIkxvZ2luQnV0dG9uXCIgY2xhc3M9XCJidG4tbWFpbiBidG4tcHJpbWFyeVwiIHZhbHVlPVwiTG9naW5cIiBkaXNhYmxlZD1cImRpc2FibGVkXCI+PHNwYW4+TG9naW48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IjsKCQoJCW15ICRSZXR1cm5GaWVsZCA9IHFxfjxkaXYgY2xhc3M9IkZpZWxkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGlkPSJMb2dpbkJ1dHRvbiIgY2xhc3M9ImJ0bi1tYWluIGJ0bi1wcmltYXJ5IiB2YWx1ZT0iTG9naW4iIGRpc2FibGVkPSJkaXNhYmxlZCI+PHNwYW4+TG9naW48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgkJfjsKCQoJCSNzZWFyY2ggYW5kIHJlcGxhY2UJIAoJCSR7ICRQYXJhbXtEYXRhfSB9ID1+IHN7JFNlYXJjaEZpZWxkfXskRmllbGQgJFJldHVybkZpZWxkfTsKCQkKICAgIH0gIAoJIyAtLQoJCgkjIC0tCgkjIEN1c3RvbWVyIEdvb2dsZSBDYXB0Y2hhCgkjIC0tCglpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9IGVxICdDdXN0b21lckxvZ2luJykKICAgIHsKCQl1c2UgQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMjsKICAgICAgICBteSAkU2l0ZUtleSA9ICRDb25maWdPYmplY3QtPkdldCgnR29vZ2xlQ2FwdGNoYTo6U2l0ZUtleScpOwkJCiAgICAgICAgbXkgJHJjID0gQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMi0+bmV3OwoJCW15ICRjYXB0Y2hhZmllbGQgPSAkcmMtPmh0bWwoJFNpdGVLZXksIHsgdGhlbWUgPT4gJ2RhcmsnIH0sIHsgc2l6ZSA9PiAnY29tcGFjdCcgfSwgeyB0eXBlID0+ICdpbWFnZScgfSk7CgkJbXkgJEZpZWxkID0gcXF+CgkJPGRpdj4kY2FwdGNoYWZpZWxkPC9kaXY+CgkJfjsKCSAgICAgICAgICAgIAoJCW15ICRTZWFyY2hGaWVsZCA9IHF1b3RlbWV0YSAiPGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIkxvZyBJblwiIGNsYXNzPVwiYnRuLW1haW4gYnRuLXByaW1hcnlcIiBkaXNhYmxlZD1cImRpc2FibGVkXCI+TG9nIEluPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4iOwoJCgkJbXkgJFJldHVybkZpZWxkID0gcXF+PGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgdmFsdWU9IkxvZyBJbiIgY2xhc3M9ImJ0bi1tYWluIGJ0bi1wcmltYXJ5IiBkaXNhYmxlZD0iZGlzYWJsZWQiPkxvZyBJbjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CgkJfjsKCQoJCSNzZWFyY2ggYW5kIHJlcGxhY2UJIAoJCSR7ICRQYXJhbXtEYXRhfSB9ID1+IHN7JFNlYXJjaEZpZWxkfXskRmllbGQgJFJldHVybkZpZWxkfTsKCQkKICAgIH0gIAoJIyAtLQoJCiAgICByZXR1cm4gMTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/Web/InterfaceAgent.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxIFpudW55IEdtYkgsIGh0dHBzOi8vem51bnkub3JnLwojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQWdlbnQ7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwp1c2UgS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJywKICAgICdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEQicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkVtYWlsJywKICAgICdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6U2NoZWR1bGVyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnLAopOwoKPWhlYWQxIE5BTUUKCktlcm5lbDo6U3lzdGVtOjpXZWI6OkludGVyZmFjZUFnZW50IC0gdGhlIGFnZW50IHdlYiBpbnRlcmZhY2UKCj1oZWFkMSBERVNDUklQVElPTgoKdGhlIGdsb2JhbCBhZ2VudCB3ZWIgaW50ZXJmYWNlIChhdXRoZW50aWNhdGlvbiwgc2Vzc2lvbiBoYW5kbGluZywgLi4uKQoKPWhlYWQxIFBVQkxJQyBJTlRFUkZBQ0UKCj1oZWFkMiBuZXcoKQoKY3JlYXRlIGFnZW50IHdlYiBpbnRlcmZhY2Ugb2JqZWN0LiBEbyBub3QgdXNlIGl0IGRpcmVjdGx5LCBpbnN0ZWFkIHVzZToKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXI7CiAgICBteSAkRGVidWcgPSAwLAogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpJbnRlcmZhY2VBZ2VudCcgPT4gewogICAgICAgICAgICBEZWJ1ZyAgID0+IDAsCiAgICAgICAgICAgIFdlYlJlcXVlc3QgPT4gQ0dJOjpGYXN0LT5uZXcoKSwgIyBvcHRpb25hbCwgZS4gZy4gaWYgZmFzdCBjZ2kgaXMgdXNlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRoZSBDR0kgb2JqZWN0IGlzIGFscmVhZHkgcHJvdmlkZWQKICAgICAgICB9CiAgICApOwogICAgbXkgJEludGVyZmFjZUFnZW50ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQWdlbnQnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBQZXJmb3JtYW5jZSBsb2cKICAgICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gPSB0aW1lKCk7CgogICAgIyBnZXQgZGVidWcgbGV2ZWwKICAgICRTZWxmLT57RGVidWd9ID0gJFBhcmFte0RlYnVnfSB8fCAwOwoKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycgPT4gewogICAgICAgICAgICBMb2dQcmVmaXggPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDR0lMb2dQcmVmaXgnKSwKICAgICAgICB9LAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyA9PiB7CiAgICAgICAgICAgIFdlYlJlcXVlc3QgPT4gJFBhcmFte1dlYlJlcXVlc3R9IHx8IDAsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBkZWJ1ZyBpbmZvCiAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnR2xvYmFsIGhhbmRsZSBzdGFydGVkLi4uJywKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAkU2VsZjsKfQoKPWhlYWQyIFJ1bigpCgpleGVjdXRlIHRoZSBvYmplY3QKCiAgICAkSW50ZXJmYWNlQWdlbnQtPlJ1bigpOwoKPWN1dAoKc3ViIFJ1biB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRRdWVyeVN0cmluZyA9ICRFTlZ7UVVFUllfU1RSSU5HfSB8fCAnJzsKCiAgICAjIENoZWNrIGlmIGh0dHBzIGZvcmNpbmcgaXMgYWN0aXZlLCBhbmQgcmVkaXJlY3QgaWYgbmVlZGVkLgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hUVFBTRm9yY2VSZWRpcmVjdCcpICkgewoKICAgICAgICAjIFNvbWUgd2ViIHNlcnZlcnMgZG8gbm90IHNldCBIVFRQUyBlbnZpcm9ubWVudCB2YXJpYWJsZSwgc28gaXQncyBub3QgcG9zc2libGUgdG8gZWFzaWx5IGtub3cgaWYgd2UgYXJlIHVzaW5nCiAgICAgICAgIyAgIGh0dHBzIHByb3RvY29sLiBMb29rIGFsc28gZm9yIHNpbWlsYXJseSBuYW1lZCBrZXlzIGluIGVudmlyb25tZW50IGhhc2gsIHNpbmNlIHRoaXMgc2hvdWxkIHByZXZlbnQgbG9vcHMgaW4KICAgICAgICAjICAgY2VydGFpbiBjYXNlcy4KICAgICAgICBpZiAoCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICFkZWZpbmVkICRFTlZ7SFRUUFN9CiAgICAgICAgICAgICAgICAmJiAhZ3JlcCB7L15IVFRQUyg/Ol98JCkvfSBrZXlzICVFTlYKICAgICAgICAgICAgKQogICAgICAgICAgICB8fCAkRU5We0hUVFBTfSBuZSAnb24nCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICRIb3N0ID0gJEVOVntIVFRQX0hPU1R9IHx8ICRDb25maWdPYmplY3QtPkdldCgnRlFETicpOwoKICAgICAgICAgICAgIyBSZWRpcmVjdCB3aXRoIDMwMSBjb2RlLiBBZGQgdHdvIG5ldyBsaW5lcyBhdCB0aGUgZW5kLCBzbyBIVFRQIGhlYWRlcnMgYXJlIHZhbGlkYXRlZCBjb3JyZWN0bHkuCiAgICAgICAgICAgIHByaW50ICJTdGF0dXM6IDMwMSBNb3ZlZCBQZXJtYW5lbnRseVxuTG9jYXRpb246IGh0dHBzOi8vJEhvc3QkRU5We1JFUVVFU1RfVVJJfVxuXG4iOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRQYXJhbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICBteSAlUGFyYW07CgogICAgIyBnZXQgc2Vzc2lvbiBpZAogICAgJFBhcmFte1Nlc3Npb25OYW1lfSA9ICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvbk5hbWUnKSAgICAgICAgICAgICAgICAgICAgICB8fCAnU2Vzc2lvbklEJzsKICAgICRQYXJhbXtTZXNzaW9uSUR9ICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9ICkgfHwgJyc7CgogICAgIyBkcm9wIG9sZCBzZXNzaW9uIGlkIChpZiBleGlzdHMpCiAgICAkUXVlcnlTdHJpbmcgPX4gcy8oXD98Jnw7fCkkUGFyYW17U2Vzc2lvbk5hbWV9KD0mfD07fD0uKz8mfD0uKz8kKS87L2c7CgogICAgIyBkZWZpbmUgZnJhbWV3b3JrIHBhcmFtcwogICAgbXkgJEZyYW1ld29ya1BhcmFtcyA9IHsKICAgICAgICBMYW5nICAgICAgICAgPT4gJycsCiAgICAgICAgQWN0aW9uICAgICAgID0+ICcnLAogICAgICAgIFN1YmFjdGlvbiAgICA9PiAnJywKICAgICAgICBSZXF1ZXN0ZWRVUkwgPT4gJFF1ZXJ5U3RyaW5nLAogICAgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JEZyYW1ld29ya1BhcmFtc30gKSB7CiAgICAgICAgJFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApCiAgICAgICAgICAgIHx8ICRGcmFtZXdvcmtQYXJhbXMtPnskS2V5fTsKICAgIH0KCiAgICAjIHZhbGlkYXRlIGxhbmd1YWdlCiAgICBpZiAoICRQYXJhbXtMYW5nfSAmJiAkUGFyYW17TGFuZ30gIX4gbXtcQVthLXpdezJ9KD86X1tBLVpdezJ9KT9cen14bXMgKSB7CiAgICAgICAgZGVsZXRlICRQYXJhbXtMYW5nfTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHRoZSBicm93c2VyIHNlbmRzIHRoZSBTZXNzaW9uSUQgY29va2llIGFuZCBzZXQgdGhlIFNlc3Npb25JRC1jb29raWUKICAgICMgYXMgU2Vzc2lvbklEISBHRVQgb3IgUE9TVCBTZXNzaW9uSUQgaGF2ZSB0aGUgbG93ZXN0IHByaW9yaXR5LgogICAgbXkgJEJyb3dzZXJIYXNDb29raWUgPSAwOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25Vc2VDb29raWUnKSApIHsKICAgICAgICAkUGFyYW17U2Vzc2lvbklEQ29va2llfSA9ICRQYXJhbU9iamVjdC0+R2V0Q29va2llKCBLZXkgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSApOwogICAgICAgIGlmICggJFBhcmFte1Nlc3Npb25JRENvb2tpZX0gKSB7CiAgICAgICAgICAgICRQYXJhbXtTZXNzaW9uSUR9ID0gJFBhcmFte1Nlc3Npb25JRENvb2tpZX07CiAgICAgICAgfQogICAgfQoKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICBMYW5nICAgICAgICAgPT4gJFBhcmFte0xhbmd9LAogICAgICAgICAgICBVc2VyTGFuZ3VhZ2UgPT4gJFBhcmFte0xhbmd9LAogICAgICAgIH0sCiAgICAgICAgJ0tlcm5lbDo6TGFuZ3VhZ2UnID0+IHsKICAgICAgICAgICAgVXNlckxhbmd1YWdlID0+ICRQYXJhbXtMYW5nfQogICAgICAgIH0sCiAgICApOwoKICAgIG15ICRDb29raWVTZWN1cmVBdHRyaWJ1dGU7CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSHR0cFR5cGUnKSBlcSAnaHR0cHMnICkgewoKICAgICAgICAjIFJlc3RyaWN0IENvb2tpZSB0byBIVFRQUyBpZiBpdCBpcyB1c2VkLgogICAgICAgICRDb29raWVTZWN1cmVBdHRyaWJ1dGUgPSAxOwogICAgfQoKICAgIG15ICREQkNhbkNvbm5lY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+Q29ubmVjdCgpOwoKICAgIGlmICggISREQkNhbkNvbm5lY3QgfHwgJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgaWYgKCAhJERCQ2FuQ29ubmVjdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+RXJyb3IoKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFBhcmFtT2JqZWN0LT5FcnJvcigpLAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGNvbW1vbiBhcHBsaWNhdGlvbiBhbmQgYWRkLW9uIGFwcGxpY2F0aW9uIHBhcmFtcwogICAgbXkgJUNvbW1vbk9iamVjdFBhcmFtID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6Q29tbW9uUGFyYW0nKSB9OwogICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJUNvbW1vbk9iamVjdFBhcmFtICkgewogICAgICAgICRQYXJhbXskS2V5fSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRLZXkgKSB8fCAkQ29tbW9uT2JqZWN0UGFyYW17JEtleX07CiAgICB9CgogICAgIyBzZWN1cml0eSBjaGVjayBBY3Rpb24gUGFyYW0gKHJlcGxhY2Ugbm9uIHdvcmQgY2hhcnMpCiAgICAkUGFyYW17QWN0aW9ufSA9fiBzL1xXLy9nOwoKICAgIG15ICRTZXNzaW9uT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyk7CiAgICBteSAkVXNlck9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyk7CgogICAgIyBjaGVjayByZXF1ZXN0IHR5cGUKICAgIGlmICggJFBhcmFte0FjdGlvbn0gZXEgJ1ByZUxvZ2luJyApIHsKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJFBhcmFte1JlcXVlc3RlZFVSTH0gfHwgIkFjdGlvbj1BZ2VudERhc2hib2FyZCI7CgogICAgICAgICMgbG9naW4gc2NyZWVuCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgTW9kZSAgPT4gJ1ByZUxvZ2luJywKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdMb2dpbicgKSB7CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgIG15ICRQb3N0VXNlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdVc2VyJyApIHx8ICcnOwogICAgICAgIG15ICRQb3N0UHcgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oCiAgICAgICAgICAgIFBhcmFtID0+ICdQYXNzd29yZCcsCiAgICAgICAgICAgIFJhdyAgID0+IDEKICAgICAgICApIHx8ICcnOwogICAgICAgIG15ICRQb3N0VHdvRmFjdG9yVG9rZW4gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKAogICAgICAgICAgICBQYXJhbSA9PiAnVHdvRmFjdG9yVG9rZW4nLAogICAgICAgICAgICBSYXcgICA9PiAxCiAgICAgICAgKSB8fCAnJzsKCQkKCQkjIC0tCgkJIyBBZ2VudCBHb29nbGUgQ2FwdGNoYQoJCSMgLS0KICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QnKS0+e1Nob3dHb29nbGVDYXB0Y2hhfS0+e1RlbXBsYXRlc30tPntMb2dpbn0gKQoJCXsKCQkJdXNlIENhcHRjaGE6OnJlQ0FQVENIQTo6VjI7CiAgICAgICAgICAgIG15ICRyYyA9IENhcHRjaGE6OnJlQ0FQVENIQTo6VjItPm5ldzsKICAgICAgICAgICAgbXkgJFNlY3JldEtleSA9ICRDb25maWdPYmplY3QtPkdldCgnR29vZ2xlQ2FwdGNoYTo6U2VjcmV0S2V5Jyk7CQkJCiAgICAgICAgICAgIG15ICRyZXNwb25zZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oUGFyYW0gPT4gJ2ctcmVjYXB0Y2hhLXJlc3BvbnNlJykgfHwgJyc7CiAgICAgICAgICAgIG15ICRyZXN1bHQgPSAkcmMtPnZlcmlmeSgkU2VjcmV0S2V5LCAkcmVzcG9uc2UpOwogICAgCiAgICAgICAgICAgIGlmICggISRyZXN1bHQtPntzdWNjZXNzfSApIAogICAgICAgICAgICB7CgkJCQkjbXkgJGNfZXJyb3IgPSAkcmVzdWx0LT57ZXJyb3JfY29kZXN9LT5bMF07CgkJCQkjIHNob3cgbmVlZCB1c2VyIGRhdGEgZXJyb3IgbWVzc2FnZQoJCQkJJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5QcmludCgKCQkJCQlPdXRwdXQgPT4gXCRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+TG9naW4oCgkJCQkJCVRpdGxlICAgPT4gJ0xvZ2luJywKCQkJCQkJTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoInJlQ0FQVENIQSBlbnRyeSBmYWlsZWQuICRyZXN1bHQtPntlcnJvcl9jb2Rlc30tPlswXSIpLAoJCQkJCQlNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAoJCQkJCSksCgkJCQkpOwoJCQkKCQkJCXJldHVybjsKICAgICAgICAgICAgfQoJCX0gCiAgICAgICAgIyAtLQoJCQogICAgICAgICMgY3JlYXRlIEF1dGhPYmplY3QKICAgICAgICBteSAkQXV0aE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJyk7CgogICAgICAgICMgY2hlY2sgc3VibWl0dGVkIGRhdGEKICAgICAgICBteSAkVXNlciA9ICRBdXRoT2JqZWN0LT5BdXRoKAogICAgICAgICAgICBVc2VyICAgICAgICAgICA9PiAkUG9zdFVzZXIsCiAgICAgICAgICAgIFB3ICAgICAgICAgICAgID0+ICRQb3N0UHcsCiAgICAgICAgICAgIFR3b0ZhY3RvclRva2VuID0+ICRQb3N0VHdvRmFjdG9yVG9rZW4sCiAgICAgICAgKTsKCiAgICAgICAgIyBsb2dpbiBpcyBpbnZhbGlkCiAgICAgICAgaWYgKCAhJFVzZXIgKSB7CgogICAgICAgICAgICBteSAkRXhwaXJlcyA9ICcrJyAuICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvbk1heFRpbWUnKSAuICdzJzsKICAgICAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llQWZ0ZXJCcm93c2VyQ2xvc2UnKSApIHsKICAgICAgICAgICAgICAgICRFeHBpcmVzID0gJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9UUlNCcm93c2VySGFzQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAkRXhwaXJlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+ICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnTG9naW5VUkwnKSApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1Mb2dpbkZhaWxlZCZSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5HZXRMb2dFbnRyeSgKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9PiAnSW5mbycsCiAgICAgICAgICAgICAgICAgICAgICAgIFdoYXQgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJEF1dGhPYmplY3QtPkdldExhc3RFcnJvck1lc3NhZ2UoKSApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IFRyYW5zbGF0YWJsZSgnTG9naW4gZmFpbGVkISBZb3VyIHVzZXIgbmFtZSBvciBwYXNzd29yZCB3YXMgZW50ZXJlZCBpbmNvcnJlY3RseS4nKSwKICAgICAgICAgICAgICAgICAgICBMb2dpbkZhaWxlZCA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICAgICAgPT4gJFVzZXIsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBpcyBzdWNjZXNzZnVsCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFVzZXJPYmplY3QtPkdldFVzZXJEYXRhKAogICAgICAgICAgICBVc2VyICAgICAgICAgID0+ICRVc2VyLAogICAgICAgICAgICBWYWxpZCAgICAgICAgID0+IDEsCiAgICAgICAgICAgIE5vT3V0T2ZPZmZpY2UgPT4gMSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGNvb2tpZXMKICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+R2V0Q29va2llKCBLZXkgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJyApICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgICAgIEJyb3dzZXJIYXNDb29raWUgPT4gMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIG5lZWRlZCBkYXRhCiAgICAgICAgaWYgKCAhJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRVc2VyRGF0YXtVc2VyTG9naW59ICkgewoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICBwcmludCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgLiAnP1JlYXNvbj1TeXN0ZW1FcnJvcicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyBzaG93IG5lZWQgdXNlciBkYXRhIGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdBdXRoZW50aWNhdGlvbiBzdWNjZWVkZWQsIGJ1dCBubyB1c2VyIGRhdGEgcmVjb3JkIGlzIGZvdW5kIGluIHRoZSBkYXRhYmFzZS4gUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJwogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbXkgJERhdGVUaW1lT2JqID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgICMgY3JlYXRlIG5ldyBzZXNzaW9uIGlkCiAgICAgICAgbXkgJE5ld1Nlc3Npb25JRCA9ICRTZXNzaW9uT2JqZWN0LT5DcmVhdGVTZXNzaW9uSUQoCiAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgVXNlckxhc3RSZXF1ZXN0ID0+ICREYXRlVGltZU9iai0+VG9FcG9jaCgpLAogICAgICAgICAgICBVc2VyVHlwZSAgICAgICAgPT4gJ1VzZXInLAogICAgICAgICAgICBTZXNzaW9uU291cmNlICAgPT4gJ0FnZW50SW50ZXJmYWNlJywKICAgICAgICApOwoKICAgICAgICAjIHNob3cgZXJyb3IgbWVzc2FnZSBpZiBubyBzZXNzaW9uIGlkIGhhcyBiZWVuIGNyZWF0ZWQKICAgICAgICBpZiAoICEkTmV3U2Vzc2lvbklEICkgewoKICAgICAgICAgICAgIyBnZXQgZXJyb3IgbWVzc2FnZQogICAgICAgICAgICBteSAkRXJyb3IgPSAkU2Vzc2lvbk9iamVjdC0+U2Vzc2lvbklERXJyb3JNZXNzYWdlKCkgfHwgJyc7CgogICAgICAgICAgICAjIG91dHB1dCBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+ICRFcnJvciwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZXhlY3V0aW9uIGluIDIwIHNlY29uZHMKICAgICAgICBteSAkRXhlY3V0aW9uVGltZU9iaiA9ICREYXRlVGltZU9iai0+Q2xvbmUoKTsKICAgICAgICAkRXhlY3V0aW9uVGltZU9iai0+QWRkKCBTZWNvbmRzID0+IDIwICk7CiAgICAgICAgbXkgJEV4ZWN1dGlvblRpbWUgPSAkRXhlY3V0aW9uVGltZU9iai0+VG9TdHJpbmcoKTsKCiAgICAgICAgIyBhZGQgYSBhc3ljaHJvbm91cyBleGVjdXRvciBzY2hlZHVsZXIgdGFzayB0byBjb3VudCB0aGUgY29uY3VycmVudCB1c2VyCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlNjaGVkdWxlcicpLT5UYXNrQWRkKAogICAgICAgICAgICBFeGVjdXRpb25UaW1lICAgICAgICAgICAgPT4gJEV4ZWN1dGlvblRpbWUsCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgICAgICAgICA9PiAnQXN5bmNocm9ub3VzRXhlY3V0b3InLAogICAgICAgICAgICBOYW1lICAgICAgICAgICAgICAgICAgICAgPT4gJ1BsdWdpbkFzeW5jaHJvbm91czo6Q29uY3VycmVudFVzZXInLAogICAgICAgICAgICBNYXhpbXVtUGFyYWxsZWxJbnN0YW5jZXMgPT4gMSwKICAgICAgICAgICAgRGF0YSAgICAgICAgICAgICAgICAgICAgID0+IHsKICAgICAgICAgICAgICAgIE9iamVjdCAgID0+ICdLZXJuZWw6OlN5c3RlbTo6U3VwcG9ydERhdGFDb2xsZWN0b3I6OlBsdWdpbkFzeW5jaHJvbm91czo6T1RSUzo6Q29uY3VycmVudFVzZXJzJywKICAgICAgICAgICAgICAgIEZ1bmN0aW9uID0+ICdSdW5Bc3luY2hyb25vdXMnLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgIG15ICRVc2VyVGltZVpvbmUgPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglVXNlckRhdGEpOwoKICAgICAgICAkU2Vzc2lvbk9iamVjdC0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJE5ld1Nlc3Npb25JRCwKICAgICAgICAgICAgS2V5ICAgICAgID0+ICdVc2VyVGltZVpvbmUnLAogICAgICAgICAgICBWYWx1ZSAgICAgPT4gJFVzZXJUaW1lWm9uZSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrIGlmIHRoZSB0aW1lIHpvbmUgb2Zmc2V0IHJlcG9ydGVkIGJ5IHRoZSB1c2VyJ3MgYnJvd3NlciBkaWZmZXJzIGZyb20gdGhhdAogICAgICAgICMgb2YgdGhlIE9UUlMgdXNlcidzIHRpbWUgem9uZSBvZmZzZXQKICAgICAgICBteSAkRGF0ZVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgIFRpbWVab25lID0+ICRVc2VyVGltZVpvbmUsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICBteSAkT1RSU1VzZXJUaW1lWm9uZU9mZnNldCA9ICREYXRlVGltZU9iamVjdC0+Rm9ybWF0KCBGb3JtYXQgPT4gJyV7b2Zmc2V0fScgKSAvIDYwOwogICAgICAgIG15ICRCcm93c2VyVGltZVpvbmVPZmZzZXQgID0gKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVGltZVpvbmVPZmZzZXQnICkgfHwgMCApICogLTE7CgogICAgICAgICMgVGltZVpvbmVPZmZzZXREaWZmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaWZmZXJlbmNlIG9mIHRoZSB0aW1lIHpvbmUgb2Zmc2V0IGJldHdlZW4KICAgICAgICAjIHRoZSB1c2VyJ3MgT1RSUyB0aW1lIHpvbmUgc2V0dGluZyBhbmQgdGhlIG9uZSByZXBvcnRlZCBieSB0aGUgdXNlcidzIGJyb3dzZXIuCiAgICAgICAgIyBJZiB0aGVyZSBpcyBhIGRpZmZlcmVuY2UgaXQgY2FuIGJlIGV2YWx1YXRlZCBsYXRlciB0byBlLiBnLiBzaG93IGEgbWVzc2FnZQogICAgICAgICMgZm9yIHRoZSB1c2VyIHRvIGNoZWNrIGhpcyBPVFJTIHRpbWUgem9uZSBzZXR0aW5nLgogICAgICAgIG15ICRVc2VyVGltZVpvbmVPZmZzZXREaWZmZXJlbmNlID0gYWJzKCAkT1RSU1VzZXJUaW1lWm9uZU9mZnNldCAtICRCcm93c2VyVGltZVpvbmVPZmZzZXQgKTsKICAgICAgICAkU2Vzc2lvbk9iamVjdC0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJE5ld1Nlc3Npb25JRCwKICAgICAgICAgICAgS2V5ICAgICAgID0+ICdVc2VyVGltZVpvbmVPZmZzZXREaWZmZXJlbmNlJywKICAgICAgICAgICAgVmFsdWUgICAgID0+ICRVc2VyVGltZVpvbmVPZmZzZXREaWZmZXJlbmNlLAogICAgICAgICk7CgogICAgICAgICMgY3JlYXRlIGEgbmV3IExheW91dE9iamVjdCB3aXRoIFNlc3Npb25JRENvb2tpZQogICAgICAgIG15ICRFeHBpcmVzID0gJysnIC4gJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uTWF4VGltZScpIC4gJ3MnOwogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZUFmdGVyQnJvd3NlckNsb3NlJykgKSB7CiAgICAgICAgICAgICRFeHBpcmVzID0gJyc7CiAgICAgICAgfQoKICAgICAgICBteSAkU2VjdXJlQXR0cmlidXRlOwogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdIdHRwVHlwZScpIGVxICdodHRwcycgKSB7CgogICAgICAgICAgICAjIFJlc3RyaWN0IENvb2tpZSB0byBIVFRQUyBpZiBpdCBpcyB1c2VkLgogICAgICAgICAgICAkU2VjdXJlQXR0cmlidXRlID0gMTsKICAgICAgICB9CgogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgIFNldENvb2tpZXMgPT4gewogICAgICAgICAgICAgICAgICAgIFNlc3Npb25JRENvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJE5ld1Nlc3Npb25JRCwKICAgICAgICAgICAgICAgICAgICAgICAgRXhwaXJlcyAgPT4gJEV4cGlyZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gc2NhbGFyICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBPVFJTQnJvd3Nlckhhc0Nvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJywKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICctMXknLAogICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+ICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTZXNzaW9uSUQgICA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICAgICAgU2Vzc2lvbk5hbWUgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIHJlZGlyZWN0IHdpdGggbmV3IHNlc3Npb24gaWQgYW5kIG9sZCBwYXJhbXMKICAgICAgICAjIHByZXBhcmUgb2xkIHJlZGlyZWN0IFVSTCAtLSBkbyBub3QgcmVkaXJlY3QgdG8gTG9naW4gb3IgTG9nb3V0IChsb29wKSEKICAgICAgICBpZiAoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID1+IC9BY3Rpb249KExvZ291dHxMb2dpbnxMb3N0UGFzc3dvcmR8UHJlTG9naW4pLyApIHsKICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAnJzsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3Qgd2l0aCBuZXcgc2Vzc2lvbiBpZAogICAgICAgIHByaW50ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+UmVkaXJlY3QoCiAgICAgICAgICAgIE9QICAgID0+ICRQYXJhbXtSZXF1ZXN0ZWRVUkx9LAogICAgICAgICAgICBMb2dpbiA9PiAxLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBsb2dvdXQKICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0xvZ291dCcgKSB7CgogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgY2hlY2sgc2Vzc2lvbiBpZAogICAgICAgIGlmICggISRTZXNzaW9uT2JqZWN0LT5DaGVja1Nlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnTG9naW5VUkwnKSApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1JbnZhbGlkU2Vzc2lvbklEJlJlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgbG9naW4gc2NyZWVuCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9nb3V0JywKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGdldCBzZXNzaW9uIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkU2Vzc2lvbk9iamVjdC0+R2V0U2Vzc2lvbklERGF0YSgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgICAgICk7CgogICAgICAgICRVc2VyRGF0YXtVc2VyVGltZVpvbmV9ID0gJFNlbGYtPl9Vc2VyVGltZVpvbmVHZXQoJVVzZXJEYXRhKTsKCiAgICAgICAgIyBjcmVhdGUgYSBuZXcgTGF5b3V0T2JqZWN0IHdpdGggJVVzZXJEYXRhCiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2Vzc2lvbklEQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgRXhwaXJlcyAgPT4gJy0xeScsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gc2NhbGFyICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0c0Rpc2NhcmQoIE9iamVjdHMgPT4gWydLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0J10gKTsKICAgICAgICAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIFByZXZlbnQgQ1NSRiBhdHRhY2tzCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICAjIHJlbW92ZSBzZXNzaW9uIGlkCiAgICAgICAgaWYgKCAhJFNlc3Npb25PYmplY3QtPlJlbW92ZVNlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnQ2FuYHQgcmVtb3ZlIFNlc3Npb25JRC4nKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnTG9nb3V0VVJMJykgKSB7CiAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnTG9nb3V0VVJMJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGxvZ291dCBzY3JlZW4KICAgICAgICBteSAkTG9nb3V0TWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnTG9nb3V0IHN1Y2Nlc3NmdWwuJyk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0xvZ291dCcsCiAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiAkTG9nb3V0TWVzc2FnZSwKICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgdXNlciBsb3N0IHBhc3N3b3JkCiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdMb3N0UGFzc3dvcmQnICkgewoKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIGNoZWNrIGZlYXR1cmUKICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvc3RQYXNzd29yZCcpICkgewoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiBUcmFuc2xhdGFibGUoJ0ZlYXR1cmUgbm90IGFjdGl2ZSEnKSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgbXkgJFVzZXIgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1VzZXInICkgIHx8ICcnOwogICAgICAgIG15ICRUb2tlbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUb2tlbicgKSB8fCAnJzsKCiAgICAgICAgIyBnZXQgdXNlciBsb2dpbiBieSB0b2tlbgogICAgICAgIGlmICggISRVc2VyICYmICRUb2tlbiApIHsKCiAgICAgICAgICAgICMgUHJldmVudCBleHRyYWN0aW5nIHBhc3N3b3JkIHJlc2V0IHRva2VuIGNoYXJhY3Rlci1ieS1jaGFyYWN0ZXIgdmlhIHdpbGRjYXJkIGluamVjdGlvbgogICAgICAgICAgICAjIFRoZSB3aWxkIGNhcmQgY2hhcmFjdGVycyAiJSIgYW5kICJfIiBjb3VsZCBiZSB1c2VkIHRvIG1hdGNoIGFyYml0cmFyeSBjaGFyYWN0ZXIuCiAgICAgICAgICAgIGlmICggJFRva2VuICF+IG17XEEgKD86IFthLXpBLVpdIHwgXGQgKSsgXHp9eG1zICkgewoKICAgICAgICAgICAgICAgICMgU2VjdXJpdHk6IHByZXRlbmQgdGhhdCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMgd2VyZSBhY3R1YWxseSBzZW50IHRvCiAgICAgICAgICAgICAgICAjICAgbWFrZSBzdXJlIHRoYXQgdXNlcnMgY2Fubm90IGZpbmQgb3V0IHZhbGlkIHVzZXJuYW1lcyBieQogICAgICAgICAgICAgICAgIyAgIGp1c3QgdHJ5aW5nIGFuZCBjaGVja2luZyB0aGUgcmVzdWx0IG1lc3NhZ2UuCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiBUcmFuc2xhdGFibGUoJ1NlbnQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICVVc2VyTGlzdCA9ICRVc2VyT2JqZWN0LT5TZWFyY2hQcmVmZXJlbmNlcygKICAgICAgICAgICAgICAgIEtleSAgID0+ICdVc2VyVG9rZW4nLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJFRva2VuLAogICAgICAgICAgICApOwogICAgICAgICAgICBVU0VSUzoKICAgICAgICAgICAgZm9yIG15ICRVc2VySUQgKCBzb3J0IGtleXMgJVVzZXJMaXN0ICkgewogICAgICAgICAgICAgICAgbXkgJVVzZXJEYXRhID0gJFVzZXJPYmplY3QtPkdldFVzZXJEYXRhKAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkVXNlcklELAogICAgICAgICAgICAgICAgICAgIFZhbGlkICA9PiAxLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICglVXNlckRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAkVXNlciA9ICRVc2VyRGF0YXtVc2VyTG9naW59OwogICAgICAgICAgICAgICAgICAgIGxhc3QgVVNFUlM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IHVzZXIgZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRVc2VyT2JqZWN0LT5HZXRVc2VyRGF0YSgKICAgICAgICAgICAgVXNlciAgPT4gJFVzZXIsCiAgICAgICAgICAgIFZhbGlkID0+IDEKICAgICAgICApOwoKICAgICAgICAjIHZlcmlmeSB1c2VyIGlzIHZhbGlkIHdoZW4gcmVxdWVzdGluZyBwYXNzd29yZCByZXNldAogICAgICAgIG15IEBWYWxpZElEcyAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZElEc0dldCgpOwogICAgICAgIG15ICRVc2VySXNWYWxpZCA9IGdyZXAgeyAkVXNlckRhdGF7VmFsaWRJRH0gJiYgJFVzZXJEYXRhe1ZhbGlkSUR9ID09ICRfIH0gQFZhbGlkSURzOwogICAgICAgIGlmICggISRVc2VyRGF0YXtVc2VySUR9IHx8ICEkVXNlcklzVmFsaWQgKSB7CgogICAgICAgICAgICAjIFNlY3VyaXR5OiBwcmV0ZW5kIHRoYXQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zIHdlcmUgYWN0dWFsbHkgc2VudCB0bwogICAgICAgICAgICAjICAgbWFrZSBzdXJlIHRoYXQgdXNlcnMgY2Fubm90IGZpbmQgb3V0IHZhbGlkIHVzZXJuYW1lcyBieQogICAgICAgICAgICAjICAganVzdCB0cnlpbmcgYW5kIGNoZWNraW5nIHRoZSByZXN1bHQgbWVzc2FnZS4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdTZW50IHBhc3N3b3JkIHJlc2V0IGluc3RydWN0aW9ucy4gUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwuJyksCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIGVtYWlsIG9iamVjdAogICAgICAgIG15ICRFbWFpbE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbWFpbCcpOwoKICAgICAgICAjIHNlbmQgcGFzc3dvcmQgcmVzZXQgdG9rZW4KICAgICAgICBpZiAoICEkVG9rZW4gKSB7CgogICAgICAgICAgICAjIGdlbmVyYXRlIHRva2VuCiAgICAgICAgICAgICRVc2VyRGF0YXtUb2tlbn0gPSAkVXNlck9iamVjdC0+VG9rZW5HZW5lcmF0ZSgKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2VuZCB0b2tlbiBub3RpZnkgZW1haWwgd2l0aCBsaW5rCiAgICAgICAgICAgIG15ICRCb2R5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdOb3RpZmljYXRpb25Cb2R5TG9zdFBhc3N3b3JkVG9rZW4nKQogICAgICAgICAgICAgICAgfHwgJ0VSUk9SOiBOb3RpZmljYXRpb25Cb2R5TG9zdFBhc3N3b3JkVG9rZW4gaXMgbWlzc2luZyEnOwogICAgICAgICAgICBteSAkU3ViamVjdCA9ICRDb25maWdPYmplY3QtPkdldCgnTm90aWZpY2F0aW9uU3ViamVjdExvc3RQYXNzd29yZFRva2VuJykKICAgICAgICAgICAgICAgIHx8ICdFUlJPUjogTm90aWZpY2F0aW9uU3ViamVjdExvc3RQYXNzd29yZFRva2VuIGlzIG1pc3NpbmchJzsKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJVVzZXJEYXRhICkgewogICAgICAgICAgICAgICAgJEJvZHkgPX4gcy88T1RSU18kS2V5Pi8kVXNlckRhdGF7JEtleX0vZ2k7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbXkgJFNlbnQgPSAkRW1haWxPYmplY3QtPlNlbmQoCiAgICAgICAgICAgICAgICBUbyAgICAgICA9PiAkVXNlckRhdGF7VXNlckVtYWlsfSwKICAgICAgICAgICAgICAgIFN1YmplY3QgID0+ICRTdWJqZWN0LAogICAgICAgICAgICAgICAgQ2hhcnNldCAgPT4gJExheW91dE9iamVjdC0+e1VzZXJDaGFyc2V0fSwKICAgICAgICAgICAgICAgIE1pbWVUeXBlID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgICAgIEJvZHkgICAgID0+ICRCb2R5CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggISRTZW50LT57U3VjY2Vzc30gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdTZW50IHBhc3N3b3JkIHJlc2V0IGluc3RydWN0aW9ucy4gUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwuJyksCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgIyByZXNldCBwYXNzd29yZAogICAgICAgICMgY2hlY2sgaWYgdG9rZW4gaXMgdmFsaWQKICAgICAgICBteSAkVG9rZW5WYWxpZCA9ICRVc2VyT2JqZWN0LT5Ub2tlbkNoZWNrKAogICAgICAgICAgICBUb2tlbiAgPT4gJFRva2VuLAogICAgICAgICAgICBVc2VySUQgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkVG9rZW5WYWxpZCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdJbnZhbGlkIFRva2VuIScpLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbmV3IHBhc3N3b3JkCiAgICAgICAgJFVzZXJEYXRhe05ld1BXfSA9ICRVc2VyT2JqZWN0LT5HZW5lcmF0ZVJhbmRvbVBhc3N3b3JkKCk7CgogICAgICAgICMgdXBkYXRlIG5ldyBwYXNzd29yZAogICAgICAgICRVc2VyT2JqZWN0LT5TZXRQYXNzd29yZCgKICAgICAgICAgICAgVXNlckxvZ2luID0+ICRVc2VyLAogICAgICAgICAgICBQVyAgICAgICAgPT4gJFVzZXJEYXRhe05ld1BXfQogICAgICAgICk7CgogICAgICAgICMgc2VuZCBub3RpZnkgZW1haWwKICAgICAgICBteSAkQm9keSA9ICRDb25maWdPYmplY3QtPkdldCgnTm90aWZpY2F0aW9uQm9keUxvc3RQYXNzd29yZCcpCiAgICAgICAgICAgIHx8ICdOZXcgUGFzc3dvcmQgaXM6IDxPVFJTX05FV1BXPic7CiAgICAgICAgbXkgJFN1YmplY3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ05vdGlmaWNhdGlvblN1YmplY3RMb3N0UGFzc3dvcmQnKQogICAgICAgICAgICB8fCAnTmV3IFBhc3N3b3JkISc7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJVVzZXJEYXRhICkgewogICAgICAgICAgICAkQm9keSA9fiBzLzxPVFJTXyRLZXk+LyRVc2VyRGF0YXskS2V5fS9naTsKICAgICAgICB9CiAgICAgICAgbXkgJFNlbnQgPSAkRW1haWxPYmplY3QtPlNlbmQoCiAgICAgICAgICAgIFRvICAgICAgID0+ICRVc2VyRGF0YXtVc2VyRW1haWx9LAogICAgICAgICAgICBTdWJqZWN0ICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgQ2hhcnNldCAgPT4gJExheW91dE9iamVjdC0+e1VzZXJDaGFyc2V0fSwKICAgICAgICAgICAgTWltZVR5cGUgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICBCb2R5ICAgICA9PiAkQm9keQogICAgICAgICk7CgogICAgICAgIGlmICggISRTZW50LT57U3VjY2Vzc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICdTZW50IG5ldyBwYXNzd29yZCB0byAlcy4gUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwuJywKICAgICAgICAgICAgJFVzZXJEYXRhe1VzZXJFbWFpbH0sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgICAgIFVzZXIgICAgICAgID0+ICRVc2VyLAogICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBzaG93IGxvZ2luIHNpdGUKICAgIGVsc2lmICggISRQYXJhbXtTZXNzaW9uSUR9ICkgewoKICAgICAgICAjIGNyZWF0ZSBBdXRoT2JqZWN0CiAgICAgICAgbXkgJEF1dGhPYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJyk7CiAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgICAgICBpZiAoICRBdXRoT2JqZWN0LT5HZXRPcHRpb24oIFdoYXQgPT4gJ1ByZUF1dGgnICkgKSB7CgogICAgICAgICAgICAjIGF1dG9tYXRpYyBsb2dpbgogICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4gIkFjdGlvbj1QcmVMb2dpbiZSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpICkgewoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAuICI/UmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBzY3JlZW4KICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBydW4gbW9kdWxlcyBpZiBhIHZlcnNpb24gdmFsdWUgZXhpc3RzCiAgICBlbHNpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoIktlcm5lbDo6TW9kdWxlczo6JFBhcmFte0FjdGlvbn0iKSApIHsKCiAgICAgICAgIyBjaGVjayBzZXNzaW9uIGlkCiAgICAgICAgaWYgKCAhJFNlc3Npb25PYmplY3QtPkNoZWNrU2Vzc2lvbklEKCBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0gKSApIHsKCiAgICAgICAgICAgICMgcHV0ICclUGFyYW0nIGludG8gTGF5b3V0T2JqZWN0CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNlc3Npb25JRENvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICctMXknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gc2NhbGFyICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RzRGlzY2FyZCggT2JqZWN0cyA9PiBbJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnXSApOwogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyBjcmVhdGUgQXV0aE9iamVjdAogICAgICAgICAgICBteSAkQXV0aE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJyk7CiAgICAgICAgICAgIGlmICggJEF1dGhPYmplY3QtPkdldE9wdGlvbiggV2hhdCA9PiAnUHJlQXV0aCcgKSApIHsKCiAgICAgICAgICAgICAgICAjIGF1dG9tYXRpYyByZS1sb2dpbgogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgT1AgPT4gIj9BY3Rpb249UHJlTG9naW4mUmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgKSB7CgogICAgICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1JbnZhbGlkU2Vzc2lvbklEJlJlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgbG9naW4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICRTZXNzaW9uT2JqZWN0LT5TZXNzaW9uSURFcnJvck1lc3NhZ2UoKSApLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgc2Vzc2lvbiBkYXRhCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSwKICAgICAgICApOwoKICAgICAgICAkVXNlckRhdGF7VXNlclRpbWVab25lfSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVVc2VyRGF0YSk7CgogICAgICAgICMgY2hlY2sgbmVlZGVkIGRhdGEKICAgICAgICBpZiAoICEkVXNlckRhdGF7VXNlcklEfSB8fCAhJFVzZXJEYXRhe1VzZXJMb2dpbn0gfHwgJFVzZXJEYXRhe1VzZXJUeXBlfSBuZSAnVXNlcicgKSB7CgogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpIC4gJz9SZWFzb249U3lzdGVtRXJyb3InLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luIHNjcmVlbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiBUcmFuc2xhdGFibGUoJ0Vycm9yOiBpbnZhbGlkIHNlc3Npb24uJyksCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIG1vZHVsZSByZWdpc3RyeQogICAgICAgIG15ICRNb2R1bGVSZWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKS0+eyAkUGFyYW17QWN0aW9ufSB9OwogICAgICAgIGlmICggISRNb2R1bGVSZWcgKSB7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIk1vZHVsZSBLZXJuZWw6Ok1vZHVsZXM6OiRQYXJhbXtBY3Rpb259IG5vdCByZWdpc3RlcmVkIGluIEtlcm5lbC9Db25maWcucG0hIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIG1vZHVsZSBwZXJtaXNzb24gY2hlY2sKICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlZiAkTW9kdWxlUmVnLT57R3JvdXBSb30gZXEgJ0FSUkFZJwogICAgICAgICAgICAmJiAhc2NhbGFyIEB7ICRNb2R1bGVSZWctPntHcm91cFJvfSB9CiAgICAgICAgICAgICYmIHJlZiAkTW9kdWxlUmVnLT57R3JvdXB9IGVxICdBUlJBWScKICAgICAgICAgICAgJiYgIXNjYWxhciBAeyAkTW9kdWxlUmVnLT57R3JvdXB9IH0KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1JvfSA9IDE7CiAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSd30gPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbXkgJEdyb3VwT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyk7CgogICAgICAgICAgICBQRVJNSVNTSU9OOgogICAgICAgICAgICBmb3IgbXkgJFBlcm1pc3Npb24gKHF3KEdyb3VwUm8gR3JvdXApKSB7CiAgICAgICAgICAgICAgICBteSAkQWNjZXNzT2sgPSAwOwogICAgICAgICAgICAgICAgbXkgJEdyb3VwICAgID0gJE1vZHVsZVJlZy0+eyRQZXJtaXNzaW9ufTsKICAgICAgICAgICAgICAgIG5leHQgUEVSTUlTU0lPTiBpZiAhJEdyb3VwOwogICAgICAgICAgICAgICAgaWYgKCByZWYgJEdyb3VwIGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICAgICAgSU5ORVI6CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRHcm91cE5hbWUgKCBAeyRHcm91cH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgSU5ORVIgaWYgISRHcm91cE5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgSU5ORVIgaWYgISRHcm91cE9iamVjdC0+UGVybWlzc2lvbkNoZWNrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRVc2VyRGF0YXtVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0+ICRHcm91cE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJFBlcm1pc3Npb24gZXEgJ0dyb3VwUm8nID8gJ3JvJyA6ICdydycsCgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAkQWNjZXNzT2sgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0IElOTkVSOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIG15ICRIYXNQZXJtaXNzaW9uID0gJEdyb3VwT2JqZWN0LT5QZXJtaXNzaW9uQ2hlY2soCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0+ICRHcm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICRQZXJtaXNzaW9uIGVxICdHcm91cFJvJyA/ICdybycgOiAncncnLAoKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmICgkSGFzUGVybWlzc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgICAkQWNjZXNzT2sgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggJFBlcm1pc3Npb24gZXEgJ0dyb3VwJyAmJiAkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1JvfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1J3fSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoICRQZXJtaXNzaW9uIGVxICdHcm91cFJvJyAmJiAkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1JvfSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJFBhcmFte0FjY2Vzc1JvfSAmJiAhJFBhcmFte0FjY2Vzc1J3fSB8fCAhJFBhcmFte0FjY2Vzc1JvfSAmJiAkUGFyYW17QWNjZXNzUnd9ICkgewoKICAgICAgICAgICAgICAgICMgcHV0ICclUGFyYW0nIGFuZCAnJVVzZXJEYXRhJyBpbnRvIExheW91dE9iamVjdAogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVSZWcgPT4gJE1vZHVsZVJlZywKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHByaW50ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+Tm9QZXJtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBQZXJtaXNzaW9uIHRvIHVzZSB0aGlzIGZyb250ZW5kIG1vZHVsZSEnKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBwdXQgJyVQYXJhbScgYW5kICclVXNlckRhdGEnIGludG8gTGF5b3V0T2JqZWN0CiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0c0Rpc2NhcmQoIE9iamVjdHMgPT4gWydLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0J10gKTsKCiAgICAgICAgIyB1cGRhdGUgbGFzdCByZXF1ZXN0IHRpbWUKICAgICAgICBpZiAoICEkUGFyYW1PYmplY3QtPklzQUpBWFJlcXVlc3QoKSApIHsKICAgICAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgICAgICAkU2Vzc2lvbk9iamVjdC0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgICAgICAgICAgICAgS2V5ICAgICAgID0+ICdVc2VyTGFzdFJlcXVlc3QnLAogICAgICAgICAgICAgICAgVmFsdWUgICAgID0+ICREYXRlVGltZU9iamVjdC0+VG9FcG9jaCgpLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBPdmVycmlkZSB1c2VyIHNldHRpbmdzLgogICAgICAgIG15ICRIb21lID0gJENvbmZpZ09iamVjdC0+R2V0KCdIb21lJyk7CiAgICAgICAgbXkgJEZpbGUgPSAiJEhvbWUvS2VybmVsL0NvbmZpZy9GaWxlcy9Vc2VyLyRVc2VyRGF0YXtVc2VySUR9LnBtIjsKICAgICAgICBpZiAoIC1lICRGaWxlICkgewogICAgICAgICAgICBldmFsIHsKICAgICAgICAgICAgICAgIGlmICggcmVxdWlyZSAkRmlsZSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBQcmVwYXJlIGZpbGUuCiAgICAgICAgICAgICAgICAgICAgJEZpbGUgPX4gcy9cUSRIb21lXEUvL2c7CiAgICAgICAgICAgICAgICAgICAgJEZpbGUgPX4gcy9eXC8vL2c7CiAgICAgICAgICAgICAgICAgICAgJEZpbGUgPX4gcy9cL1wvL1wvL2c7CiAgICAgICAgICAgICAgICAgICAgJEZpbGUgPX4gcy9cLy86Oi9nOwogICAgICAgICAgICAgICAgICAgICRGaWxlID1+IHMvXC5wbSQvL2c7CiAgICAgICAgICAgICAgICAgICAgJEZpbGUtPkxvYWQoJENvbmZpZ09iamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkaWUgIkNhbm5vdCBsb2FkIGZpbGUgJEZpbGU6ICQhXG4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgIyBMb2cgZXJyb3IgYW5kIGNvbnRpbnVlLgogICAgICAgICAgICBpZiAoJEApIHsKICAgICAgICAgICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPSAkQDsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJEVycm9yTWVzc2FnZSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgcHJlIGFwcGxpY2F0aW9uIG1vZHVsZQogICAgICAgIG15ICRQcmVNb2R1bGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1ByZUFwcGxpY2F0aW9uTW9kdWxlJyk7CiAgICAgICAgaWYgKCRQcmVNb2R1bGUpIHsKICAgICAgICAgICAgbXkgJVByZU1vZHVsZUxpc3Q7CiAgICAgICAgICAgIGlmICggcmVmICRQcmVNb2R1bGUgZXEgJ0hBU0gnICkgewogICAgICAgICAgICAgICAgJVByZU1vZHVsZUxpc3QgPSAleyRQcmVNb2R1bGV9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFByZU1vZHVsZUxpc3R7SW5pdH0gPSAkUHJlTW9kdWxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBNT0RVTEU6CiAgICAgICAgICAgIGZvciBteSAkUHJlTW9kdWxlS2V5ICggc29ydCBrZXlzICVQcmVNb2R1bGVMaXN0ICkgewogICAgICAgICAgICAgICAgbXkgJFByZU1vZHVsZSA9ICRQcmVNb2R1bGVMaXN0eyRQcmVNb2R1bGVLZXl9OwogICAgICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRQcmVNb2R1bGU7CiAgICAgICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSgkUHJlTW9kdWxlKTsKCiAgICAgICAgICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJQcmVBcHBsaWNhdGlvbiBtb2R1bGUgJFByZU1vZHVsZSBpcyB1c2VkLiIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgICAgICMgdXNlIG1vZHVsZQogICAgICAgICAgICAgICAgbXkgJFByZU1vZHVsZU9iamVjdCA9ICRQcmVNb2R1bGUtPm5ldygKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkUHJlTW9kdWxlT2JqZWN0LT5QcmVSdW4oKTsKICAgICAgICAgICAgICAgIGlmICgkT3V0cHV0KSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoIE91dHB1dCA9PiBcJE91dHB1dCApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gLiAnLT5uZXcnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJEZyb250ZW5kT2JqZWN0ID0gKCAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gKS0+bmV3KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgIERlYnVnICAgICA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICApOwoKICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gLiAnLT5ydW4nLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyAtPlJ1biAkQWN0aW9uIHdpdGggJEZyb250ZW5kT2JqZWN0CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5QcmludCggT3V0cHV0ID0+IFwkRnJvbnRlbmRPYmplY3QtPlJ1bigpICk7CgogICAgICAgICMgbG9nIHJlcXVlc3QgdGltZQogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdQZXJmb3JtYW5jZUxvZycpICkgewogICAgICAgICAgICBpZiAoICggISRRdWVyeVN0cmluZyAmJiAkUGFyYW17QWN0aW9ufSApIHx8ICRRdWVyeVN0cmluZyAhfiAvQWN0aW9uPS8gKSB7CiAgICAgICAgICAgICAgICAkUXVlcnlTdHJpbmcgPSAnQWN0aW9uPScgLiAkUGFyYW17QWN0aW9ufSAuICcmU3ViYWN0aW9uPScgLiAkUGFyYW17U3ViYWN0aW9ufTsKICAgICAgICAgICAgfQogICAgICAgICAgICBteSAkRmlsZSA9ICRDb25maWdPYmplY3QtPkdldCgnUGVyZm9ybWFuY2VMb2c6OkZpbGUnKTsKCiAgICAgICAgICAgICMgV3JpdGUgdG8gUGVyZm9ybWFuY2VMb2cgZmlsZSBvbmx5IGlmIGl0IGlzIHNtYWxsZXIgdGhhbiBzaXplIGxpbWl0IChzZWUgYnVnIzE0NzQ3KS4KICAgICAgICAgICAgaWYgKCAtcyAkRmlsZSA8ICggMTAyNCAqIDEwMjQgKiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BlcmZvcm1hbmNlTG9nOjpGaWxlTWF4JykgKSApIHsKCiAgICAgICAgICAgICAgICAjIyBubyBjcml0aWMKICAgICAgICAgICAgICAgIGlmICggb3BlbiBteSAkT3V0LCAnPj4nLCAkRmlsZSApIHsKICAgICAgICAgICAgICAgICAgICAjIyB1c2UgY3JpdGljCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJE91dCB0aW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgLiAnOjpBZ2VudDo6JwogICAgICAgICAgICAgICAgICAgICAgICAuICggdGltZSgpIC0gJFNlbGYtPntQZXJmb3JtYW5jZUxvZ1N0YXJ0fSApCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIjo6JFVzZXJEYXRhe1VzZXJMb2dpbn06OiRRdWVyeVN0cmluZ1xuIjsKICAgICAgICAgICAgICAgICAgICBjbG9zZSAkT3V0OwoKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2RlYnVnJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlJlc3BvbnNlOjpBZ2VudDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAoIHRpbWUoKSAtICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAicyB0YWtlbiAoVVJMOiRRdWVyeVN0cmluZzokVXNlckRhdGF7VXNlckxvZ2lufSkiLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IHdyaXRlICRGaWxlOiAkISIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAiUGVyZm9ybWFuY2VMb2cgZmlsZSAnJEZpbGUnIGlzIHRvbyBsYXJnZSwgeW91IG5lZWQgdG8gcmVzZXQgaXQgaW4gUGVyZm9ybWFuY2VMb2cgcGFnZSEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIHByaW50IGFuIGVycm9yIHNjcmVlbgogICAgbXkgJURhdGEgPSAkU2Vzc2lvbk9iamVjdC0+R2V0U2Vzc2lvbklERGF0YSgKICAgICAgICBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0sCiAgICApOwogICAgJERhdGF7VXNlclRpbWVab25lfSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVEYXRhKTsKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICVEYXRhLAogICAgICAgIH0sCiAgICApOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5GYXRhbEVycm9yKAogICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICk7CiAgICByZXR1cm47Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1oZWFkMiBfVXNlclRpbWVab25lR2V0KCkKCkdldCB0aW1lIHpvbmUgZm9yIHRoZSBjdXJyZW50IHVzZXIuIFRoaXMgZnVuY3Rpb24gd2lsbCB2YWxpZGF0ZSBwYXNzZWQgdGltZSB6b25lIHBhcmFtZXRlciBhbmQgcmV0dXJuIGRlZmF1bHQgdXNlciB0aW1lCnpvbmUgaWYgaXQncyBub3QgdmFsaWQuCgogICAgbXkgJFVzZXJUaW1lWm9uZSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KAogICAgICAgIFVzZXJUaW1lWm9uZSA9PiAnRXVyb3BlL0JlcmxpbicsCiAgICApOwoKPWN1dAoKc3ViIF9Vc2VyVGltZVpvbmVHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkVXNlclRpbWVab25lOwoKICAgICMgUmV0dXJuIHBhc3NlZCB0aW1lIHpvbmUgb25seSBpZiBpdCdzIHZhbGlkLiBJdCBjYW4gaGFwcGVuIHRoYXQgdXNlciBwcmVmZXJlbmNlcyBvciBzZXNzaW9uIHN0b3JlIGFuIG9sZC1zdHlsZQogICAgIyAgIG9mZnNldCB3aGljaCBpcyBub3QgdmFsaWQgYW55bW9yZS4gSW4gdGhpcyBjYXNlLCByZXR1cm4gdGhlIGRlZmF1bHQgdmFsdWUuCiAgICAjICAgUGxlYXNlIHNlZSBidWcjMTMzNzQgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICBpZiAoCiAgICAgICAgJFBhcmFte1VzZXJUaW1lWm9uZX0KICAgICAgICAmJiBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUtPklzVGltZVpvbmVWYWxpZCggVGltZVpvbmUgPT4gJFBhcmFte1VzZXJUaW1lWm9uZX0gKQogICAgICAgICkKICAgIHsKICAgICAgICAkVXNlclRpbWVab25lID0gJFBhcmFte1VzZXJUaW1lWm9uZX07CiAgICB9CgogICAgJFVzZXJUaW1lWm9uZSB8fD0gS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lLT5Vc2VyRGVmYXVsdFRpbWVab25lR2V0KCk7CgogICAgcmV0dXJuICRVc2VyVGltZVpvbmU7Cn0KCj1lbmQgSW50ZXJuYWw6Cgo9Y3V0CgpzdWIgREVTVFJPWSB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgICMgZGVidWcgaW5mbwogICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2RlYnVnJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0dsb2JhbCBoYW5kbGUgc3RvcHBlZC4nLAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCjE7Cgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHBzOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMy4wLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="Custom/Kernel/System/Web/InterfaceCustomer.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxIFpudW55IEdtYkgsIGh0dHBzOi8vem51bnkub3JnLwojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXI7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lOwp1c2UgS2VybmVsOjpTeXN0ZW06OkVtYWlsOwp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoSXNBcnJheVJlZldpdGhEYXRhIElzSGFzaFJlZldpdGhEYXRhKTsKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckF1dGgnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6REInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycsCiAgICAnS2VybmVsOjpTeXN0ZW06Ok1haW4nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpTY2hlZHVsZXInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcsCiAgICAnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcsCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXIgLSB0aGUgY3VzdG9tZXIgd2ViIGludGVyZmFjZQoKPWhlYWQxIERFU0NSSVBUSU9OCgp0aGUgZ2xvYmFsIGN1c3RvbWVyIHdlYiBpbnRlcmZhY2UgKGF1dGhlbnRpY2F0aW9uLCBzZXNzaW9uIGhhbmRsaW5nLCAuLi4pCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPWhlYWQyIG5ldygpCgpjcmVhdGUgY3VzdG9tZXIgd2ViIGludGVyZmFjZSBvYmplY3QKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXI7CgogICAgbXkgJERlYnVnID0gMDsKICAgIG15ICRJbnRlcmZhY2VDdXN0b21lciA9IEtlcm5lbDo6U3lzdGVtOjpXZWI6OkludGVyZmFjZUN1c3RvbWVyLT5uZXcoCiAgICAgICAgRGVidWcgICAgICA9PiAkRGVidWcsCiAgICAgICAgV2ViUmVxdWVzdCA9PiBDR0k6OkZhc3QtPm5ldygpLCAjIG9wdGlvbmFsLCBlLiBnLiBpZiBmYXN0IGNnaSBpcyB1c2VkLCB0aGUgQ0dJIG9iamVjdCBpcyBhbHJlYWR5IHByb3ZpZGVkCiAgICApOwoKPWN1dAoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7fTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjIGdldCBkZWJ1ZyBsZXZlbAogICAgJFNlbGYtPntEZWJ1Z30gPSAkUGFyYW17RGVidWd9IHx8IDA7CgogICAgIyBwZXJmb3JtYW5jZSBsb2cKICAgICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gPSB0aW1lKCk7CgogICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJyA9PiB7CiAgICAgICAgICAgIExvZ1ByZWZpeCA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0NHSUxvZ1ByZWZpeCcpLAogICAgICAgIH0sCiAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnID0+IHsKICAgICAgICAgICAgV2ViUmVxdWVzdCA9PiAkUGFyYW17V2ViUmVxdWVzdH0gfHwgMCwKICAgICAgICB9LAogICAgKTsKCiAgICAjIGRlYnVnIGluZm8KICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdHbG9iYWwgaGFuZGxlIHN0YXJ0ZWQuLi4nLAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aGVhZDIgUnVuKCkKCmV4ZWN1dGUgdGhlIG9iamVjdAoKICAgICRJbnRlcmZhY2VDdXN0b21lci0+UnVuKCk7Cgo9Y3V0CgpzdWIgUnVuIHsKICAgIG15ICRTZWxmID0gc2hpZnQ7CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJFF1ZXJ5U3RyaW5nID0gJEVOVntRVUVSWV9TVFJJTkd9IHx8ICcnOwoKICAgICMgQ2hlY2sgaWYgaHR0cHMgZm9yY2luZyBpcyBhY3RpdmUsIGFuZCByZWRpcmVjdCBpZiBuZWVkZWQuCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSFRUUFNGb3JjZVJlZGlyZWN0JykgKSB7CgogICAgICAgICMgU29tZSB3ZWIgc2VydmVycyBkbyBub3Qgc2V0IEhUVFBTIGVudmlyb25tZW50IHZhcmlhYmxlLCBzbyBpdCdzIG5vdCBwb3NzaWJsZSB0byBlYXNpbHkga25vdyBpZiB3ZSBhcmUgdXNpbmcKICAgICAgICAjICAgaHR0cHMgcHJvdG9jb2wuIExvb2sgYWxzbyBmb3Igc2ltaWxhcmx5IG5hbWVkIGtleXMgaW4gZW52aXJvbm1lbnQgaGFzaCwgc2luY2UgdGhpcyBzaG91bGQgcHJldmVudCBsb29wcyBpbgogICAgICAgICMgICBjZXJ0YWluIGNhc2VzLgogICAgICAgIGlmICgKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgIWRlZmluZWQgJEVOVntIVFRQU30KICAgICAgICAgICAgICAgICYmICFncmVwIHsvXkhUVFBTKD86X3wkKS99IGtleXMgJUVOVgogICAgICAgICAgICApCiAgICAgICAgICAgIHx8ICRFTlZ7SFRUUFN9IG5lICdvbicKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbXkgJEhvc3QgPSAkRU5We0hUVFBfSE9TVH0gfHwgJENvbmZpZ09iamVjdC0+R2V0KCdGUUROJyk7CgogICAgICAgICAgICAjIFJlZGlyZWN0IHdpdGggMzAxIGNvZGUuIEFkZCB0d28gbmV3IGxpbmVzIGF0IHRoZSBlbmQsIHNvIEhUVFAgaGVhZGVycyBhcmUgdmFsaWRhdGVkIGNvcnJlY3RseS4KICAgICAgICAgICAgcHJpbnQgIlN0YXR1czogMzAxIE1vdmVkIFBlcm1hbmVudGx5XG5Mb2NhdGlvbjogaHR0cHM6Ly8kSG9zdCRFTlZ7UkVRVUVTVF9VUkl9XG5cbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIG15ICVQYXJhbTsKCiAgICAjIGdldCBzZXNzaW9uIGlkCiAgICAkUGFyYW17U2Vzc2lvbk5hbWV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsU2Vzc2lvbk5hbWUnKSAgICAgICAgIHx8ICdDU0lEJzsKICAgICRQYXJhbXtTZXNzaW9uSUR9ICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9ICkgfHwgJyc7CgogICAgIyBkcm9wIG9sZCBzZXNzaW9uIGlkIChpZiBleGlzdHMpCiAgICAkUXVlcnlTdHJpbmcgPX4gcy8oXD98Jnw7fCkkUGFyYW17U2Vzc2lvbk5hbWV9KD0mfD07fD0uKz8mfD0uKz8kKS87L2c7CgogICAgIyBkZWZpbmUgZnJhbWV3b3JrIHBhcmFtcwogICAgbXkgJEZyYW1ld29ya1BhcmFtcyA9IHsKICAgICAgICBMYW5nICAgICAgICAgPT4gJycsCiAgICAgICAgQWN0aW9uICAgICAgID0+ICcnLAogICAgICAgIFN1YmFjdGlvbiAgICA9PiAnJywKICAgICAgICBSZXF1ZXN0ZWRVUkwgPT4gJFF1ZXJ5U3RyaW5nLAogICAgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JEZyYW1ld29ya1BhcmFtc30gKSB7CiAgICAgICAgJFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApCiAgICAgICAgICAgIHx8ICRGcmFtZXdvcmtQYXJhbXMtPnskS2V5fTsKICAgIH0KCiAgICAjIHZhbGlkYXRlIGxhbmd1YWdlCiAgICBpZiAoICRQYXJhbXtMYW5nfSAmJiAkUGFyYW17TGFuZ30gIX4gbXtcQVthLXpdezJ9KD86X1tBLVpdezJ9KT9cen14bXMgKSB7CiAgICAgICAgZGVsZXRlICRQYXJhbXtMYW5nfTsKICAgIH0KCiAgICBteSAkQnJvd3Nlckhhc0Nvb2tpZSA9IDA7CgogICAgIyBDaGVjayBpZiB0aGUgYnJvd3NlciBzZW5kcyB0aGUgU2Vzc2lvbklEIGNvb2tpZSBhbmQgc2V0IHRoZSBTZXNzaW9uSUQtY29va2llCiAgICAjIGFzIFNlc3Npb25JRCEgR0VUIG9yIFBPU1QgU2Vzc2lvbklEIGhhdmUgdGhlIGxvd2VzdCBwcmlvcml0eS4KICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llJykgKSB7CiAgICAgICAgJFBhcmFte1Nlc3Npb25JRENvb2tpZX0gPSAkUGFyYW1PYmplY3QtPkdldENvb2tpZSggS2V5ID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0gKTsKICAgICAgICBpZiAoICRQYXJhbXtTZXNzaW9uSURDb29raWV9ICkgewogICAgICAgICAgICAkUGFyYW17U2Vzc2lvbklEfSA9ICRQYXJhbXtTZXNzaW9uSURDb29raWV9OwogICAgICAgIH0KICAgIH0KCiAgICBteSAkQ29va2llU2VjdXJlQXR0cmlidXRlOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0h0dHBUeXBlJykgZXEgJ2h0dHBzJyApIHsKCiAgICAgICAgIyBSZXN0cmljdCBDb29raWUgdG8gSFRUUFMgaWYgaXQgaXMgdXNlZC4KICAgICAgICAkQ29va2llU2VjdXJlQXR0cmlidXRlID0gMTsKICAgIH0KCiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgTGFuZyA9PiAkUGFyYW17TGFuZ30sCiAgICAgICAgfSwKICAgICAgICAnS2VybmVsOjpMYW5ndWFnZScgPT4gewogICAgICAgICAgICBVc2VyTGFuZ3VhZ2UgPT4gJFBhcmFte0xhbmd9LAogICAgICAgIH0sCiAgICApOwoKICAgIG15ICREQkNhbkNvbm5lY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+Q29ubmVjdCgpOwoKICAgIGlmICggISREQkNhbkNvbm5lY3QgfHwgJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgaWYgKCAhJERCQ2FuQ29ubmVjdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+Q3VzdG9tZXJGYXRhbEVycm9yKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICggJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRQYXJhbU9iamVjdC0+RXJyb3IoKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkVXNlck9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKICAgIG15ICRTZXNzaW9uT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyk7CgogICAgIyBnZXQgY29tbW9uIGFwcGxpY2F0aW9uIGFuZCBhZGQgb24gYXBwbGljYXRpb24gcGFyYW1zCiAgICBteSAlQ29tbW9uT2JqZWN0UGFyYW0gPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6OkNvbW1vblBhcmFtJykgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVDb21tb25PYmplY3RQYXJhbSApIHsKICAgICAgICAkUGFyYW17JEtleX0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkS2V5ICkgfHwgJENvbW1vbk9iamVjdFBhcmFteyRLZXl9OwogICAgfQoKICAgICMgc2VjdXJpdHkgY2hlY2sgQWN0aW9uIFBhcmFtIChyZXBsYWNlIG5vbi13b3JkIGNoYXJzKQogICAgJFBhcmFte0FjdGlvbn0gPX4gcy9cVy8vZzsKCiAgICAjIGNoZWNrIHJlcXVlc3QgdHlwZQogICAgaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnUHJlTG9naW4nICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgbG9naW4gc2NyZWVuCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICBNb2RlICA9PiAnUHJlTG9naW4nLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0xvZ2luJyApIHsKCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgbXkgJFBvc3RVc2VyID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1VzZXInICkgfHwgJyc7CiAgICAgICAgbXkgJFBvc3RQdyAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSgKICAgICAgICAgICAgUGFyYW0gPT4gJ1Bhc3N3b3JkJywKICAgICAgICAgICAgUmF3ICAgPT4gMQogICAgICAgICkgfHwgJyc7CiAgICAgICAgbXkgJFBvc3RUd29GYWN0b3JUb2tlbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oCiAgICAgICAgICAgIFBhcmFtID0+ICdUd29GYWN0b3JUb2tlbicsCiAgICAgICAgICAgIFJhdyAgID0+IDEKICAgICAgICApIHx8ICcnOwoKCQkjIC0tCgkJIyBDdXN0b21lciBHb29nbGUgQ2FwdGNoYQoJCSMgLS0KICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QnKS0+e1Nob3dHb29nbGVDYXB0Y2hhfS0+e1RlbXBsYXRlc30tPntDdXN0b21lckxvZ2lufSApCgkJewoJCQl1c2UgQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMjsKICAgICAgICAgICAgbXkgJHJjID0gQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMi0+bmV3OwogICAgICAgICAgICBteSAkU2VjcmV0S2V5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdHb29nbGVDYXB0Y2hhOjpTZWNyZXRLZXknKTsJCQkKICAgICAgICAgICAgbXkgJHJlc3BvbnNlID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbShQYXJhbSA9PiAnZy1yZWNhcHRjaGEtcmVzcG9uc2UnKSB8fCAnJzsKICAgICAgICAgICAgbXkgJHJlc3VsdCA9ICRyYy0+dmVyaWZ5KCRTZWNyZXRLZXksICRyZXNwb25zZSk7CiAgICAKICAgICAgICAgICAgaWYgKCAhJHJlc3VsdC0+e3N1Y2Nlc3N9ICkgCiAgICAgICAgICAgIHsKCQkJCSNteSAkY19lcnJvciA9ICRyZXN1bHQtPntlcnJvcl9jb2Rlc30tPlswXTsKCQkJCSMgc2hvdyBuZWVkIHVzZXIgZGF0YSBlcnJvciBtZXNzYWdlCgkJCQkkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPlByaW50KAoJCQkJCU91dHB1dCA9PiBcJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5Mb2dpbigKCQkJCQkJVGl0bGUgICA9PiAnTG9naW4nLAoJCQkJCQlNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgicmVDQVBUQ0hBIGVudHJ5IGZhaWxlZC4gJHJlc3VsdC0+e2Vycm9yX2NvZGVzfS0+WzBdIiksCgkJCQkJCU1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCgkJCQkJKSwKCQkJCSk7CgkJCQoJCQkJcmV0dXJuOwogICAgICAgICAgICB9CgkJfSAKICAgICAgICAjIC0tCgkJCiAgICAgICAgIyBjcmVhdGUgQXV0aE9iamVjdAogICAgICAgIG15ICRBdXRoT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQXV0aCcpOwoKICAgICAgICAjIGNoZWNrIHN1Ym1pdHRlZCBkYXRhCiAgICAgICAgbXkgJFVzZXIgPSAkQXV0aE9iamVjdC0+QXV0aCgKICAgICAgICAgICAgVXNlciAgICAgICAgICAgPT4gJFBvc3RVc2VyLAogICAgICAgICAgICBQdyAgICAgICAgICAgICA9PiAkUG9zdFB3LAogICAgICAgICAgICBUd29GYWN0b3JUb2tlbiA9PiAkUG9zdFR3b0ZhY3RvclRva2VuLAogICAgICAgICk7CgogICAgICAgIG15ICRFeHBpcmVzID0gJysnIC4gJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uTWF4VGltZScpIC4gJ3MnOwogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZUFmdGVyQnJvd3NlckNsb3NlJykgKSB7CiAgICAgICAgICAgICRFeHBpcmVzID0gJyc7CiAgICAgICAgfQoKICAgICAgICAjIGxvZ2luIGlzIGludmFsaWQKICAgICAgICBpZiAoICEkVXNlciApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgT1RSU0Jyb3dzZXJIYXNDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAnT1RSU0Jyb3dzZXJIYXNDb29raWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICRFeHBpcmVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpICkgewogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1Mb2dpbkZhaWxlZDtSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICdJbmZvJywKICAgICAgICAgICAgICAgICAgICAgICAgV2hhdCA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgJEF1dGhPYmplY3QtPkdldExhc3RFcnJvck1lc3NhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICB8fCBUcmFuc2xhdGFibGUoJ0xvZ2luIGZhaWxlZCEgWW91ciB1c2VyIG5hbWUgb3IgcGFzc3dvcmQgd2FzIGVudGVyZWQgaW5jb3JyZWN0bHkuJyksCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICAgICAgPT4gJFBvc3RVc2VyLAogICAgICAgICAgICAgICAgICAgIExvZ2luRmFpbGVkID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBpcyBzdWNjZXNzZnVsCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgID0+ICRVc2VyLAogICAgICAgICAgICBWYWxpZCA9PiAxCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBjb29raWVzCiAgICAgICAgaWYgKCAkUGFyYW1PYmplY3QtPkdldENvb2tpZSggS2V5ID0+ICdPVFJTQnJvd3Nlckhhc0Nvb2tpZScgKSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICBCcm93c2VySGFzQ29va2llID0+IDEsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBuZWVkZWQgZGF0YQogICAgICAgIGlmICggISRVc2VyRGF0YXtVc2VySUR9IHx8ICEkVXNlckRhdGF7VXNlckxvZ2lufSApIHsKCiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKQogICAgICAgICAgICAgICAgICAgICAgICAuICc/UmVhc29uPVN5c3RlbUVycm9yJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyBuZWVkIHVzZXIgZGF0YSBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhlbnRpY2F0aW9uIHN1Y2NlZWRlZCwgYnV0IG5vIGN1c3RvbWVyIHJlY29yZCBpcyBmb3VuZCBpbiB0aGUgY3VzdG9tZXIgYmFja2VuZC4gUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJwogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgZGF0ZXRpbWUgb2JqZWN0CiAgICAgICAgbXkgJFNlc3Npb25EVE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICAjIFJlbW92ZSBjZXJ0YWluIHVzZXIgYXR0cmlidXRlcyB0aGF0IGFyZSBub3QgbmVlZGVkIHRvIGJlIHN0b3JlZCBpbiB0aGUgc2Vzc2lvbi4KICAgICAgICAjICAgLSBTTUlNRSBDZXJ0aWZpY2F0ZSBjb3VsZCBiZSBpbiBiaW5hcnkgZm9ybWF0LCBpZiBzZXNzaW9uIGJhY2tlbmQgaW4gREIgKGRlZmF1bHQpCiAgICAgICAgIyAgIGl0IHdvbnQgYmUgcG9zc2libGUgdG8gYmUgc2F2ZWQgaW4gY2VydGFpbiBkYXRhYmFzZXMgKHNlZSBidWcjMTQ0MDUpLgogICAgICAgIG15ICVVc2VyU2Vzc2lvbkRhdGEgPSAlVXNlckRhdGE7CiAgICAgICAgZGVsZXRlICRVc2VyU2Vzc2lvbkRhdGF7VXNlclNNSU1FQ2VydGlmaWNhdGV9OwoKICAgICAgICAjIGNyZWF0ZSBuZXcgc2Vzc2lvbiBpZAogICAgICAgIG15ICROZXdTZXNzaW9uSUQgPSAkU2Vzc2lvbk9iamVjdC0+Q3JlYXRlU2Vzc2lvbklEKAogICAgICAgICAgICAlVXNlclNlc3Npb25EYXRhLAogICAgICAgICAgICBVc2VyTGFzdFJlcXVlc3QgPT4gJFNlc3Npb25EVE9iamVjdC0+VG9FcG9jaCgpLAogICAgICAgICAgICBVc2VyVHlwZSAgICAgICAgPT4gJ0N1c3RvbWVyJywKICAgICAgICAgICAgU2Vzc2lvblNvdXJjZSAgID0+ICdDdXN0b21lckludGVyZmFjZScsCiAgICAgICAgKTsKCiAgICAgICAgIyBzaG93IGVycm9yIG1lc3NhZ2UgaWYgbm8gc2Vzc2lvbiBpZCBoYXMgYmVlbiBjcmVhdGVkCiAgICAgICAgaWYgKCAhJE5ld1Nlc3Npb25JRCApIHsKCiAgICAgICAgICAgICMgZ2V0IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgbXkgJEVycm9yID0gJFNlc3Npb25PYmplY3QtPlNlc3Npb25JREVycm9yTWVzc2FnZSgpIHx8ICcnOwoKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgb3V0cHV0IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJEVycm9yLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZXhlY3V0aW9uIGluIDIwIHNlY29uZHMKICAgICAgICBteSAkRXhlY3V0aW9uVGltZU9iaiA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgICRFeGVjdXRpb25UaW1lT2JqLT5BZGQoIFNlY29uZHMgPT4gMjAgKTsKCiAgICAgICAgIyBhZGQgYSBhc3luY2hyb25vdXMgZXhlY3V0b3Igc2NoZWR1bGVyIHRhc2sgdG8gY291bnQgdGhlIGNvbmN1cnJlbnQgdXNlcgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTY2hlZHVsZXInKS0+VGFza0FkZCgKICAgICAgICAgICAgRXhlY3V0aW9uVGltZSAgICAgICAgICAgID0+ICRFeGVjdXRpb25UaW1lT2JqLT5Ub1N0cmluZygpLAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgICAgICAgPT4gJ0FzeW5jaHJvbm91c0V4ZWN1dG9yJywKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgICAgICAgID0+ICdQbHVnaW5Bc3luY2hyb25vdXM6OkNvbmN1cnJlbnRVc2VyJywKICAgICAgICAgICAgTWF4aW11bVBhcmFsbGVsSW5zdGFuY2VzID0+IDEsCiAgICAgICAgICAgIERhdGEgICAgICAgICAgICAgICAgICAgICA9PiB7CiAgICAgICAgICAgICAgICBPYmplY3QgICA9PiAnS2VybmVsOjpTeXN0ZW06OlN1cHBvcnREYXRhQ29sbGVjdG9yOjpQbHVnaW5Bc3luY2hyb25vdXM6Ok9UUlM6OkNvbmN1cnJlbnRVc2VycycsCiAgICAgICAgICAgICAgICBGdW5jdGlvbiA9PiAnUnVuQXN5bmNocm9ub3VzJywKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBteSAkVXNlclRpbWVab25lID0gJFNlbGYtPl9Vc2VyVGltZVpvbmVHZXQoJVVzZXJEYXRhKTsKCiAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlclRpbWVab25lJywKICAgICAgICAgICAgVmFsdWUgICAgID0+ICRVc2VyVGltZVpvbmUsCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBpZiB0aGUgdGltZSB6b25lIG9mZnNldCByZXBvcnRlZCBieSB0aGUgdXNlcidzIGJyb3dzZXIgZGlmZmVycyBmcm9tIHRoYXQKICAgICAgICAjIG9mIHRoZSBPVFJTIHVzZXIncyB0aW1lIHpvbmUgb2Zmc2V0CiAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgKICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICBUaW1lWm9uZSA9PiAkVXNlclRpbWVab25lLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgbXkgJE9UUlNVc2VyVGltZVpvbmVPZmZzZXQgPSAkRGF0ZVRpbWVPYmplY3QtPkZvcm1hdCggRm9ybWF0ID0+ICcle29mZnNldH0nICkgLyA2MDsKICAgICAgICBteSAkQnJvd3NlclRpbWVab25lT2Zmc2V0ICA9ICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1RpbWVab25lT2Zmc2V0JyApIHx8IDAgKSAqIC0xOwoKICAgICAgICAjIFRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSBjb250YWlucyB0aGUgZGlmZmVyZW5jZSBvZiB0aGUgdGltZSB6b25lIG9mZnNldCBiZXR3ZWVuCiAgICAgICAgIyB0aGUgdXNlcidzIE9UUlMgdGltZSB6b25lIHNldHRpbmcgYW5kIHRoZSBvbmUgcmVwb3J0ZWQgYnkgdGhlIHVzZXIncyBicm93c2VyLgogICAgICAgICMgSWYgdGhlcmUgaXMgYSBkaWZmZXJlbmNlIGl0IGNhbiBiZSBldmFsdWF0ZWQgbGF0ZXIgdG8gZS4gZy4gc2hvdyBhIG1lc3NhZ2UKICAgICAgICAjIGZvciB0aGUgdXNlciB0byBjaGVjayBoaXMgT1RSUyB0aW1lIHpvbmUgc2V0dGluZy4KICAgICAgICBteSAkVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSA9IGFicyggJE9UUlNVc2VyVGltZVpvbmVPZmZzZXQgLSAkQnJvd3NlclRpbWVab25lT2Zmc2V0ICk7CiAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZScsCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSwKICAgICAgICApOwoKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uSURDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICRFeHBpcmVzLAogICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+IHNjYWxhciAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgT1RSU0Jyb3dzZXJIYXNDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICdPVFJTQnJvd3Nlckhhc0Nvb2tpZScsCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAnLTF5JywKICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFNlc3Npb25JRCAgID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgICAgICBTZXNzaW9uTmFtZSA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9LAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgcmVkaXJlY3Qgd2l0aCBuZXcgc2Vzc2lvbiBpZCBhbmQgb2xkIHBhcmFtcwogICAgICAgICMgcHJlcGFyZSBvbGQgcmVkaXJlY3QgVVJMIC0tIGRvIG5vdCByZWRpcmVjdCB0byBMb2dpbiBvciBMb2dvdXQgKGxvb3ApIQogICAgICAgIGlmICggJFBhcmFte1JlcXVlc3RlZFVSTH0gPX4gL0FjdGlvbj0oTG9nb3V0fExvZ2lufExvc3RQYXNzd29yZHxQcmVMb2dpbikvICkgewogICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICcnOwogICAgICAgIH0KCiAgICAgICAgIyByZWRpcmVjdCB3aXRoIG5ldyBzZXNzaW9uIGlkCiAgICAgICAgcHJpbnQgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5SZWRpcmVjdCgKICAgICAgICAgICAgT1AgICAgPT4gJFBhcmFte1JlcXVlc3RlZFVSTH0sCiAgICAgICAgICAgIExvZ2luID0+IDEsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIGxvZ291dAogICAgZWxzaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnTG9nb3V0JyApIHsKCiAgICAgICAgIyBjaGVjayBzZXNzaW9uIGlkCiAgICAgICAgaWYgKCAhJFNlc3Npb25PYmplY3QtPkNoZWNrU2Vzc2lvbklEKCBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0gKSApIHsKCiAgICAgICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKSApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIj9SZWFzb249SW52YWxpZFNlc3Npb25JRDtSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luIHNjcmVlbgogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9nb3V0JywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdTZXNzaW9uIGludmFsaWQuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJyksCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHNlc3Npb24gZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRTZXNzaW9uT2JqZWN0LT5HZXRTZXNzaW9uSUREYXRhKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0sCiAgICAgICAgKTsKCiAgICAgICAgJFVzZXJEYXRhe1VzZXJUaW1lWm9uZX0gPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglVXNlckRhdGEpOwoKICAgICAgICAjIGNyZWF0ZSBuZXcgTGF5b3V0T2JqZWN0IHdpdGggbmV3ICclUGFyYW0nIGFuZCAnJVVzZXJEYXRhJwogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgIFNldENvb2tpZXMgPT4gewogICAgICAgICAgICAgICAgICAgIFNlc3Npb25JRENvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICctMXknLAogICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+IHNjYWxhciAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RzRGlzY2FyZCggT2JqZWN0cyA9PiBbJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnXSApOwogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgcmVtb3ZlIHNlc3Npb24gaWQKICAgICAgICBpZiAoICEkU2Vzc2lvbk9iamVjdC0+UmVtb3ZlU2Vzc2lvbklEKCBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0gKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+Q3VzdG9tZXJGYXRhbEVycm9yKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dvdXRVUkwnKSApIHsKICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9nb3V0VVJMJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNob3cgbG9nb3V0IHNjcmVlbgogICAgICAgIG15ICRMb2dvdXRNZXNzYWdlID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdMb2dvdXQgc3VjY2Vzc2Z1bC4nKTsKCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dvdXQnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gJExvZ291dE1lc3NhZ2UsCiAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIEN1c3RvbWVyTG9zdFBhc3N3b3JkCiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdDdXN0b21lckxvc3RQYXNzd29yZCcgKSB7CgogICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIGNoZWNrIGZlYXR1cmUKICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb3N0UGFzc3dvcmQnKSApIHsKCiAgICAgICAgICAgICMgc2hvdyBub3JtYWwgbG9naW4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdGZWF0dXJlIG5vdCBhY3RpdmUhJyksCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICBteSAkVXNlciAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVXNlcicgKSAgfHwgJyc7CiAgICAgICAgbXkgJFRva2VuID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1Rva2VuJyApIHx8ICcnOwoKICAgICAgICAjIGdldCB1c2VyIGxvZ2luIGJ5IHRva2VuCiAgICAgICAgaWYgKCAhJFVzZXIgJiYgJFRva2VuICkgewoKICAgICAgICAgICAgIyBQcmV2ZW50IGV4dHJhY3RpbmcgcGFzc3dvcmQgcmVzZXQgdG9rZW4gY2hhcmFjdGVyLWJ5LWNoYXJhY3RlciB2aWEgd2lsZGNhcmQgaW5qZWN0aW9uCiAgICAgICAgICAgICMgVGhlIHdpbGQgY2FyZCBjaGFyYWN0ZXJzICIlIiBhbmQgIl8iIGNvdWxkIGJlIHVzZWQgdG8gbWF0Y2ggYXJiaXRyYXJ5IGNoYXJhY3Rlci4KICAgICAgICAgICAgaWYgKCAkVG9rZW4gIX4gbXtcQSAoPzogW2EtekEtWl0gfCBcZCApKyBcen14bXMgKSB7CgogICAgICAgICAgICAgICAgIyBTZWN1cml0eTogcHJldGVuZCB0aGF0IHBhc3N3b3JkIHJlc2V0IGluc3RydWN0aW9ucyB3ZXJlIGFjdHVhbGx5IHNlbnQgdG8KICAgICAgICAgICAgICAgICMgICBtYWtlIHN1cmUgdGhhdCB1c2VycyBjYW5ub3QgZmluZCBvdXQgdmFsaWQgdXNlcm5hbWVzIGJ5CiAgICAgICAgICAgICAgICAjICAganVzdCB0cnlpbmcgYW5kIGNoZWNraW5nIHRoZSByZXN1bHQgbWVzc2FnZS4KICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+IFRyYW5zbGF0YWJsZSgnU2VudCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicpLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJVVzZXJMaXN0ID0gJFVzZXJPYmplY3QtPlNlYXJjaFByZWZlcmVuY2VzKAogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ1VzZXJUb2tlbicsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkVG9rZW4sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIFVTRVJfSUQ6CiAgICAgICAgICAgIGZvciBteSAkVXNlcklEICggc29ydCBrZXlzICVVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgIG15ICVVc2VyRGF0YSA9ICRVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgID0+ICRVc2VySUQsCiAgICAgICAgICAgICAgICAgICAgVmFsaWQgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoJVVzZXJEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSAkVXNlckRhdGF7VXNlckxvZ2lufTsKICAgICAgICAgICAgICAgICAgICBsYXN0IFVTRVJfSUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IHVzZXIgZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRVc2VyICk7CgogICAgICAgICMgdmVyaWZ5IGN1c3RvbWVyIHVzZXIgaXMgdmFsaWQgd2hlbiByZXF1ZXN0aW5nIHBhc3N3b3JkIHJlc2V0CiAgICAgICAgbXkgQFZhbGlkSURzICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlZhbGlkJyktPlZhbGlkSURzR2V0KCk7CiAgICAgICAgbXkgJFVzZXJJc1ZhbGlkID0gZ3JlcCB7ICRVc2VyRGF0YXtWYWxpZElEfSAmJiAkVXNlckRhdGF7VmFsaWRJRH0gPT0gJF8gfSBAVmFsaWRJRHM7CiAgICAgICAgaWYgKCAhJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRVc2VySXNWYWxpZCApIHsKCiAgICAgICAgICAgICMgU2VjdXJpdHk6IHByZXRlbmQgdGhhdCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMgd2VyZSBhY3R1YWxseSBzZW50IHRvCiAgICAgICAgICAgICMgICBtYWtlIHN1cmUgdGhhdCB1c2VycyBjYW5ub3QgZmluZCBvdXQgdmFsaWQgdXNlcm5hbWVzIGJ5CiAgICAgICAgICAgICMgICBqdXN0IHRyeWluZyBhbmQgY2hlY2tpbmcgdGhlIHJlc3VsdCBtZXNzYWdlLgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+IFRyYW5zbGF0YWJsZSgnU2VudCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicpLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIGVtYWlsIG9iamVjdAogICAgICAgIG15ICRFbWFpbE9iamVjdCA9IEtlcm5lbDo6U3lzdGVtOjpFbWFpbC0+bmV3KCAleyRTZWxmfSApOwoKICAgICAgICAjIHNlbmQgcGFzc3dvcmQgcmVzZXQgdG9rZW4KICAgICAgICBpZiAoICEkVG9rZW4gKSB7CgogICAgICAgICAgICAjIGdlbmVyYXRlIHRva2VuCiAgICAgICAgICAgICRVc2VyRGF0YXtUb2tlbn0gPSAkVXNlck9iamVjdC0+VG9rZW5HZW5lcmF0ZSgKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2VuZCB0b2tlbiBub3RpZnkgZW1haWwgd2l0aCBsaW5rCiAgICAgICAgICAgIG15ICRCb2R5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQm9keUxvc3RQYXNzd29yZFRva2VuJykKICAgICAgICAgICAgICAgIHx8ICdFUlJPUjogQ3VzdG9tZXJQYW5lbEJvZHlMb3N0UGFzc3dvcmRUb2tlbiBpcyBtaXNzaW5nISc7CiAgICAgICAgICAgIG15ICRTdWJqZWN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsU3ViamVjdExvc3RQYXNzd29yZFRva2VuJykKICAgICAgICAgICAgICAgIHx8ICdFUlJPUjogQ3VzdG9tZXJQYW5lbFN1YmplY3RMb3N0UGFzc3dvcmRUb2tlbiBpcyBtaXNzaW5nISc7CiAgICAgICAgICAgIGZvciBteSAkVXNlcktleSAoIHNvcnQga2V5cyAlVXNlckRhdGEgKSB7CiAgICAgICAgICAgICAgICAkQm9keSA9fiBzLzxPVFJTXyRVc2VyS2V5Pi8kVXNlckRhdGF7JFVzZXJLZXl9L2dpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG15ICRTZW50ID0gJEVtYWlsT2JqZWN0LT5TZW5kKAogICAgICAgICAgICAgICAgVG8gICAgICAgPT4gJFVzZXJEYXRhe1VzZXJFbWFpbH0sCiAgICAgICAgICAgICAgICBTdWJqZWN0ICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgICAgIENoYXJzZXQgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgICAgICAgICBNaW1lVHlwZSA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICBCb2R5ICAgICA9PiAkQm9keQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkU2VudC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnU2VudCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicpLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gMTsKCiAgICAgICAgfQoKICAgICAgICAjIHJlc2V0IHBhc3N3b3JkCiAgICAgICAgIyBjaGVjayBpZiB0b2tlbiBpcyB2YWxpZAogICAgICAgIG15ICRUb2tlblZhbGlkID0gJFVzZXJPYmplY3QtPlRva2VuQ2hlY2soCiAgICAgICAgICAgIFRva2VuICA9PiAkVG9rZW4sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICApOwogICAgICAgIGlmICggISRUb2tlblZhbGlkICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ0ludmFsaWQgVG9rZW4hJyksCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbmV3IHBhc3N3b3JkCiAgICAgICAgJFVzZXJEYXRhe05ld1BXfSA9ICRVc2VyT2JqZWN0LT5HZW5lcmF0ZVJhbmRvbVBhc3N3b3JkKCk7CgogICAgICAgICMgdXBkYXRlIG5ldyBwYXNzd29yZAogICAgICAgIG15ICRTdWNjZXNzID0gJFVzZXJPYmplY3QtPlNldFBhc3N3b3JkKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJFVzZXIsCiAgICAgICAgICAgIFBXICAgICAgICA9PiAkVXNlckRhdGF7TmV3UFd9CiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnUmVzZXQgcGFzc3dvcmQgdW5zdWNjZXNzZnVsLiBQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgICAgICAgICBVc2VyICAgID0+ICRVc2VyLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBzZW5kIG5vdGlmeSBlbWFpbAogICAgICAgIG15ICRCb2R5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQm9keUxvc3RQYXNzd29yZCcpCiAgICAgICAgICAgIHx8ICdOZXcgUGFzc3dvcmQgaXM6IDxPVFJTX05FV1BXPic7CiAgICAgICAgbXkgJFN1YmplY3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxTdWJqZWN0TG9zdFBhc3N3b3JkJykKICAgICAgICAgICAgfHwgJ05ldyBQYXNzd29yZCEnOwogICAgICAgIGZvciBteSAkVXNlcktleSAoIHNvcnQga2V5cyAlVXNlckRhdGEgKSB7CiAgICAgICAgICAgICRCb2R5ID1+IHMvPE9UUlNfJFVzZXJLZXk+LyRVc2VyRGF0YXskVXNlcktleX0vZ2k7CiAgICAgICAgfQogICAgICAgIG15ICRTZW50ID0gJEVtYWlsT2JqZWN0LT5TZW5kKAogICAgICAgICAgICBUbyAgICAgICA9PiAkVXNlckRhdGF7VXNlckVtYWlsfSwKICAgICAgICAgICAgU3ViamVjdCAgPT4gJFN1YmplY3QsCiAgICAgICAgICAgIENoYXJzZXQgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgICAgIE1pbWVUeXBlID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgQm9keSAgICAgPT4gJEJvZHkKICAgICAgICApOwogICAgICAgIGlmICggISRTZW50LT57U3VjY2Vzc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKQogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIG15ICRNZXNzYWdlID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAnU2VudCBuZXcgcGFzc3dvcmQgdG8gJXMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicsCiAgICAgICAgICAgICRVc2VyRGF0YXtVc2VyRW1haWx9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgICAgIFVzZXIgICAgICAgID0+ICRVc2VyLAogICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICApLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBjcmVhdGUgbmV3IGN1c3RvbWVyIGFjY291bnQKICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0N1c3RvbWVyQ3JlYXRlQWNjb3VudCcgKSB7CgogICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIGNoZWNrIGZlYXR1cmUKICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxDcmVhdGVBY2NvdW50JykgKSB7CgogICAgICAgICAgICAjIHNob3cgbm9ybWFsIGxvZ2luCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnRmVhdHVyZSBub3QgYWN0aXZlIScpLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgbXkgJUdldFBhcmFtczsKICAgICAgICBmb3IgbXkgJEVudHJ5ICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclVzZXInKS0+e01hcH0gfSApIHsKICAgICAgICAgICAgJEdldFBhcmFtc3sgJEVudHJ5LT5bMF0gfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRFbnRyeS0+WzFdICkKICAgICAgICAgICAgICAgIHx8ICcnOwogICAgICAgIH0KICAgICAgICAkR2V0UGFyYW1ze1ZhbGlkSUR9ID0gMTsKCiAgICAgICAgIyBjaGVjayBuZWVkZWQgcGFyYW1zCiAgICAgICAgaWYgKCAhJEdldFBhcmFtc3tVc2VyQ3VzdG9tZXJJRH0gKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXN7VXNlckN1c3RvbWVySUR9ID0gJEdldFBhcmFtc3tVc2VyRW1haWx9OwogICAgICAgIH0KICAgICAgICBpZiAoICEkR2V0UGFyYW1ze1VzZXJMb2dpbn0gKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXN7VXNlckxvZ2lufSA9ICRHZXRQYXJhbXN7VXNlckVtYWlsfTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IG5ldyBwYXNzd29yZAogICAgICAgICRHZXRQYXJhbXN7VXNlclBhc3N3b3JkfSA9ICRVc2VyT2JqZWN0LT5HZW5lcmF0ZVJhbmRvbVBhc3N3b3JkKCk7CgogICAgICAgICMgZ2V0IHVzZXIgZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRHZXRQYXJhbXN7VXNlckxvZ2lufSApOwogICAgICAgIGlmICggJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRHZXRQYXJhbXN7VXNlckxvZ2lufSApIHsKCiAgICAgICAgICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgICAgIEtleSAgID0+ICdTaWdudXBFcnJvcicsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0YWJsZSgnVGhpcyBlLW1haWwgYWRkcmVzcyBhbHJlYWR5IGV4aXN0cy4gUGxlYXNlIGxvZyBpbiBvciByZXNldCB5b3VyIHBhc3N3b3JkLicpLAogICAgICAgICAgICAgICAgICAgIFVzZXJUaXRsZSAgICAgPT4gJEdldFBhcmFtc3tVc2VyVGl0bGV9LAogICAgICAgICAgICAgICAgICAgIFVzZXJGaXJzdG5hbWUgPT4gJEdldFBhcmFtc3tVc2VyRmlyc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyTGFzdG5hbWUgID0+ICRHZXRQYXJhbXN7VXNlckxhc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRW1haWwgICAgID0+ICRHZXRQYXJhbXN7VXNlckVtYWlsfSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgZm9yIG1haWwgYWRkcmVzcyByZXN0cmljdGlvbnMKICAgICAgICBteSBAV2hpdGVsaXN0ID0gQHsKICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQ3JlYXRlQWNjb3VudDo6TWFpbFJlc3RyaWN0aW9uczo6V2hpdGVsaXN0JykgLy8gW10KICAgICAgICB9OwogICAgICAgIG15IEBCbGFja2xpc3QgPSBAewogICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxDcmVhdGVBY2NvdW50OjpNYWlsUmVzdHJpY3Rpb25zOjpCbGFja2xpc3QnKSAvLyBbXQogICAgICAgIH07CgogICAgICAgIG15ICRXaGl0ZWxpc3RNYXRjaGVkOwogICAgICAgIGZvciBteSAkV2hpdGVsaXN0RW50cnkgKEBXaGl0ZWxpc3QpIHsKICAgICAgICAgICAgbXkgJFJlZ2V4ID0gZXZhbCB7cXIvJFdoaXRlbGlzdEVudHJ5L2l9OwogICAgICAgICAgICBpZiAoJEApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdUaGUgY3VzdG9tZXIgcGFuZWwgbWFpbCBhZGRyZXNzIHdoaXRlbGlzdCBjb250YWlucyB0aGUgaW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gJFdoaXRlbGlzdEVudHJ5LCBwbGVhc2UgY2hlY2sgYW5kIGNvcnJlY3QgaXQuJwogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRHZXRQYXJhbXN7VXNlckVtYWlsfSA9fiAkUmVnZXggKSB7CiAgICAgICAgICAgICAgICAkV2hpdGVsaXN0TWF0Y2hlZCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG15ICRCbGFja2xpc3RNYXRjaGVkOwogICAgICAgIGZvciBteSAkQmxhY2tsaXN0RW50cnkgKEBCbGFja2xpc3QpIHsKICAgICAgICAgICAgbXkgJFJlZ2V4ID0gZXZhbCB7cXIvJEJsYWNrbGlzdEVudHJ5L2l9OwogICAgICAgICAgICBpZiAoJEApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdUaGUgY3VzdG9tZXIgcGFuZWwgbWFpbCBhZGRyZXNzIGJsYWNrbGlzdCBjb250YWlucyB0aGUgaW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gJEJsYWNrbGlzdEVudHJ5LCBwbGVhc2UgY2hlY2sgYW5kIGNvcnJlY3QgaXQuJwogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRHZXRQYXJhbXN7VXNlckVtYWlsfSA9fiAkUmVnZXggKSB7CiAgICAgICAgICAgICAgICAkQmxhY2tsaXN0TWF0Y2hlZCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoICggQFdoaXRlbGlzdCAmJiAhJFdoaXRlbGlzdE1hdGNoZWQgKSB8fCAoIEBCbGFja2xpc3QgJiYgJEJsYWNrbGlzdE1hdGNoZWQgKSApIHsKCiAgICAgICAgICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgICAgIEtleSAgID0+ICdTaWdudXBFcnJvcicsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0YWJsZSgnVGhpcyBlbWFpbCBhZGRyZXNzIGlzIG5vdCBhbGxvd2VkIHRvIHJlZ2lzdGVyLiBQbGVhc2UgY29udGFjdCBzdXBwb3J0IHN0YWZmLicpLAogICAgICAgICAgICAgICAgICAgIFVzZXJUaXRsZSAgICAgPT4gJEdldFBhcmFtc3tVc2VyVGl0bGV9LAogICAgICAgICAgICAgICAgICAgIFVzZXJGaXJzdG5hbWUgPT4gJEdldFBhcmFtc3tVc2VyRmlyc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyTGFzdG5hbWUgID0+ICRHZXRQYXJhbXN7VXNlckxhc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRW1haWwgICAgID0+ICRHZXRQYXJhbXN7VXNlckVtYWlsfSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGNyZWF0ZSBhY2NvdW50CiAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgIG15ICROb3cgPSAkRGF0ZVRpbWVPYmplY3QtPlRvU3RyaW5nKCk7CgogICAgICAgIG15ICRBZGQgPSAkVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyQWRkKAogICAgICAgICAgICAlR2V0UGFyYW1zLAogICAgICAgICAgICBDb21tZW50ID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJ0FkZGVkIHZpYSBDdXN0b21lciBQYW5lbCAoJXMpJywgJE5vdyApLAogICAgICAgICAgICBWYWxpZElEID0+IDEsCiAgICAgICAgICAgIFVzZXJJRCAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsVXNlcklEJyksCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkQWRkICkgewoKICAgICAgICAgICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ1NpZ251cEVycm9yJywKICAgICAgICAgICAgICAgIFZhbHVlID0+IDEsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgICA9PiBUcmFuc2xhdGFibGUoJ0N1c3RvbWVyIHVzZXIgY2FuXCd0IGJlIGFkZGVkIScpLAogICAgICAgICAgICAgICAgICAgIFVzZXJUaXRsZSAgICAgPT4gJEdldFBhcmFtc3tVc2VyVGl0bGV9LAogICAgICAgICAgICAgICAgICAgIFVzZXJGaXJzdG5hbWUgPT4gJEdldFBhcmFtc3tVc2VyRmlyc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyTGFzdG5hbWUgID0+ICRHZXRQYXJhbXN7VXNlckxhc3RuYW1lfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRW1haWwgICAgID0+ICRHZXRQYXJhbXN7VXNlckVtYWlsfSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2VuZCBub3RpZnkgZW1haWwKICAgICAgICBteSAkRW1haWxPYmplY3QgPSBLZXJuZWw6OlN5c3RlbTo6RW1haWwtPm5ldyggJXskU2VsZn0gKTsKICAgICAgICBteSAkQm9keSAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxCb2R5TmV3QWNjb3VudCcpCiAgICAgICAgICAgIHx8ICdObyBDb25maWcgT3B0aW9uIGZvdW5kISc7CiAgICAgICAgbXkgJFN1YmplY3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxTdWJqZWN0TmV3QWNjb3VudCcpCiAgICAgICAgICAgIHx8ICdOZXcgT1RSUyBBY2NvdW50ISc7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJUdldFBhcmFtcyApIHsKICAgICAgICAgICAgJEJvZHkgPX4gcy88T1RSU18kS2V5Pi8kR2V0UGFyYW1zeyRLZXl9L2dpOwogICAgICAgIH0KCiAgICAgICAgIyBzZW5kIGFjY291bnQgaW5mbwogICAgICAgIG15ICRTZW50ID0gJEVtYWlsT2JqZWN0LT5TZW5kKAogICAgICAgICAgICBUbyAgICAgICA9PiAkR2V0UGFyYW1ze1VzZXJFbWFpbH0sCiAgICAgICAgICAgIFN1YmplY3QgID0+ICRTdWJqZWN0LAogICAgICAgICAgICBDaGFyc2V0ICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckNoYXJzZXR9LAogICAgICAgICAgICBNaW1lVHlwZSA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgIEJvZHkgICAgID0+ICRCb2R5CiAgICAgICAgKTsKICAgICAgICBpZiAoICEkU2VudC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+Q3VzdG9tZXJIZWFkZXIoCiAgICAgICAgICAgICAgICBBcmVhICA9PiAnQ29yZScsCiAgICAgICAgICAgICAgICBUaXRsZSA9PiAnRXJyb3InCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Q3VzdG9tZXJXYXJuaW5nKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ0NhblwndCBzZW5kIGFjY291bnQgaW5mbyEnKQogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRm9vdGVyKCk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KCBPdXRwdXQgPT4gXCRPdXRwdXQgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IHNlbnQgYWNjb3VudCBpbmZvCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpICkgewoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgLiAiP1JlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfTtVc2VyPSRHZXRQYXJhbXN7VXNlckxvZ2lufTsiCiAgICAgICAgICAgICAgICAgICAgLiAiRW1haWw9JEdldFBhcmFtc3tVc2VyRW1haWx9O1JlYXNvbj1OZXdBY2NvdW50Q3JlYXRlZCIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgbXkgJEFjY291bnRDcmVhdGVkTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgJ05ldyBhY2NvdW50IGNyZWF0ZWQuIFNlbnQgbG9naW4gaW5mb3JtYXRpb24gdG8gJXMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicsCiAgICAgICAgICAgICRHZXRQYXJhbXN7VXNlckVtYWlsfSwKICAgICAgICApOwoKICAgICAgICAjIGxvZ2luIHNjcmVlbgogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gJEFjY291bnRDcmVhdGVkTWVzc2FnZSwKICAgICAgICAgICAgICAgIFVzZXIgICAgICAgID0+ICRHZXRQYXJhbXN7VXNlckxvZ2lufSwKICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgc2hvdyBsb2dpbiBzaXRlCiAgICBlbHNpZiAoICEkUGFyYW17U2Vzc2lvbklEfSApIHsKCiAgICAgICAgIyBuZXcgbGF5b3V0IG9iamVjdAogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgY3JlYXRlIEF1dGhPYmplY3QKICAgICAgICBteSAkQXV0aE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckF1dGgnKTsKICAgICAgICBpZiAoICRBdXRoT2JqZWN0LT5HZXRPcHRpb24oIFdoYXQgPT4gJ1ByZUF1dGgnICkgKSB7CgogICAgICAgICAgICAjIGF1dG9tYXRpYyBsb2dpbgogICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4gIkFjdGlvbj1QcmVMb2dpbjtSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKSApIHsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKQogICAgICAgICAgICAgICAgICAgIC4gIj9SZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGxvZ2luIHNjcmVlbgogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBydW4gbW9kdWxlcyBpZiBhIHZlcnNpb24gdmFsdWUgZXhpc3RzCiAgICBlbHNpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoIktlcm5lbDo6TW9kdWxlczo6JFBhcmFte0FjdGlvbn0iKSApIHsKCiAgICAgICAgIyBjaGVjayBzZXNzaW9uIGlkCiAgICAgICAgaWYgKCAhJFNlc3Npb25PYmplY3QtPkNoZWNrU2Vzc2lvbklEKCBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0gKSApIHsKCiAgICAgICAgICAgICMgY3JlYXRlIG5ldyBMYXlvdXRPYmplY3Qgd2l0aCBuZXcgJyVQYXJhbScKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgU2Vzc2lvbklEQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwaXJlcyAgPT4gJy0xeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiBzY2FsYXIgJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0c0Rpc2NhcmQoIE9iamVjdHMgPT4gWydLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0J10gKTsKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgY3JlYXRlIEF1dGhPYmplY3QKICAgICAgICAgICAgbXkgJEF1dGhPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJBdXRoJyk7CiAgICAgICAgICAgIGlmICggJEF1dGhPYmplY3QtPkdldE9wdGlvbiggV2hhdCA9PiAnUHJlQXV0aCcgKSApIHsKCiAgICAgICAgICAgICAgICAjIGF1dG9tYXRpYyByZS1sb2dpbgogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgT1AgPT4gIj9BY3Rpb249UHJlTG9naW4mUmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgIGVsc2lmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKSApIHsKCiAgICAgICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1JbnZhbGlkU2Vzc2lvbklEO1JlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgbG9naW4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJFNlc3Npb25PYmplY3QtPlNlc3Npb25JREVycm9yTWVzc2FnZSgpICksCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgc2Vzc2lvbiBkYXRhCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSwKICAgICAgICApOwoKICAgICAgICAkVXNlckRhdGF7VXNlclRpbWVab25lfSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVVc2VyRGF0YSk7CgogICAgICAgICMgY2hlY2sgbmVlZGVkIGRhdGEKICAgICAgICBpZiAoICEkVXNlckRhdGF7VXNlcklEfSB8fCAhJFVzZXJEYXRhe1VzZXJMb2dpbn0gfHwgJFVzZXJEYXRhe1VzZXJUeXBlfSBuZSAnQ3VzdG9tZXInICkgewogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpICkgewogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1TeXN0ZW1FcnJvciIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgbG9naW4gc2NyZWVuCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnRXJyb3I6IGludmFsaWQgc2Vzc2lvbi4nKSwKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIG1vZHVsZSByZWdpc3RyeQogICAgICAgIG15ICRNb2R1bGVSZWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok1vZHVsZScpLT57ICRQYXJhbXtBY3Rpb259IH07CiAgICAgICAgaWYgKCAhJE1vZHVsZVJlZyApIHsKCiAgICAgICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJNb2R1bGUgS2VybmVsOjpNb2R1bGVzOjokUGFyYW17QWN0aW9ufSBub3QgcmVnaXN0ZXJlZCBpbiBLZXJuZWwvQ29uZmlnLnBtISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBtb2R1bGUgcGVybWlzc2lvbiBjaGVjayBmb3IgYWN0aW9uCiAgICAgICAgaWYgKAogICAgICAgICAgICByZWYgJE1vZHVsZVJlZy0+e0dyb3VwUm99IGVxICdBUlJBWScKICAgICAgICAgICAgJiYgIXNjYWxhciBAeyAkTW9kdWxlUmVnLT57R3JvdXBSb30gfQogICAgICAgICAgICAmJiByZWYgJE1vZHVsZVJlZy0+e0dyb3VwfSBlcSAnQVJSQVknCiAgICAgICAgICAgICYmICFzY2FsYXIgQHsgJE1vZHVsZVJlZy0+e0dyb3VwfSB9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAxOwogICAgICAgICAgICAkUGFyYW17QWNjZXNzUnd9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAoICRQYXJhbXtBY2Nlc3NSb30sICRQYXJhbXtBY2Nlc3NSd30gKSA9ICRTZWxmLT5fQ2hlY2tNb2R1bGVQZXJtaXNzaW9uKAogICAgICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICEkUGFyYW17QWNjZXNzUm99ICkgewoKICAgICAgICAgICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdObyBQZXJtaXNzaW9uIHRvIHVzZSB0aGlzIGZyb250ZW5kIGFjdGlvbiBtb2R1bGUhJwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgbXkgJE5hdmlnYXRpb25Db25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok5hdmlnYXRpb24nKS0+eyAkUGFyYW17QWN0aW9ufSB9OwoKICAgICAgICAjIG1vZHVsZSBwZXJtaXNzaW9uIGNoZWNrIGZvciBzdWJtZW51IGl0ZW0KICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCROYXZpZ2F0aW9uQ29uZmlnKSApIHsKCiAgICAgICAgICAgIEtFWToKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskTmF2aWdhdGlvbkNvbmZpZ30gKSB7CiAgICAgICAgICAgICAgICBuZXh0IEtFWSBpZiAkS2V5ICAgICAgICAgICAgICAgICAhfiBtL15cZCsvaTsKICAgICAgICAgICAgICAgIG5leHQgS0VZIGlmICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICF+IG0vU3ViYWN0aW9uL2k7CgogICAgICAgICAgICAgICAgbXkgQE1vZHVsZU5hdmlnYXRpb25Db25maWdzOwoKICAgICAgICAgICAgICAgICMgRklYTUU6IFN1cHBvcnQgYm90aCBvbGQgKEhBU0gpIGFuZCBuZXcgKEFSUkFZIG9mIEhBU0gpIG5hdmlnYXRpb24gY29uZmlndXJhdGlvbnMsIGZvciByZWFzb25zIG9mCiAgICAgICAgICAgICAgICAjICAgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuIE9uY2Ugd2UgYXJlIHN1cmUgZXZlcnl0aGluZyBoYXMgYmVlbiBtaWdyYXRlZCBjb3JyZWN0bHksIHN1cHBvcnQgZm9yCiAgICAgICAgICAgICAgICAjICAgSEFTSC1vbmx5IGNvbmZpZ3VyYXRpb24gY2FuIGJlIGRyb3BwZWQgaW4gZnV0dXJlIG1ham9yIHJlbGVhc2UuCiAgICAgICAgICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkTmF2aWdhdGlvbkNvbmZpZy0+eyRLZXl9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBATW9kdWxlTmF2aWdhdGlvbkNvbmZpZ3MsICROYXZpZ2F0aW9uQ29uZmlnLT57JEtleX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSggJE5hdmlnYXRpb25Db25maWctPnskS2V5fSApICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQE1vZHVsZU5hdmlnYXRpb25Db25maWdzLCBAeyAkTmF2aWdhdGlvbkNvbmZpZy0+eyRLZXl9IH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBTa2lwIGluY29tcGF0aWJsZSBjb25maWd1cmF0aW9uLgogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBLRVk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgSVRFTToKICAgICAgICAgICAgICAgIGZvciBteSAkSXRlbSAoQE1vZHVsZU5hdmlnYXRpb25Db25maWdzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAkSXRlbS0+e0xpbmt9ID1+IG0vU3ViYWN0aW9uPS9pCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRJdGVtLT57TGlua30gIX4gbS8kUGFyYW17U3ViYWN0aW9ufS9pCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgSVRFTTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1JvfSA9IDA7CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1J3fSA9IDA7CgogICAgICAgICAgICAgICAgICAgICMgbW9kdWxlIHBlcm1pc3Npb24gY2hlY2sgZm9yIHN1Ym1lbnUgaXRlbQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgcmVmICRJdGVtLT57R3JvdXBSb30gZXEgJ0FSUkFZJwogICAgICAgICAgICAgICAgICAgICAgICAmJiAhc2NhbGFyIEB7ICRJdGVtLT57R3JvdXBSb30gfQogICAgICAgICAgICAgICAgICAgICAgICAmJiByZWYgJEl0ZW0tPntHcm91cH0gZXEgJ0FSUkFZJwogICAgICAgICAgICAgICAgICAgICAgICAmJiAhc2NhbGFyIEB7ICRJdGVtLT57R3JvdXB9IH0KICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1JvfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSd30gPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICggJFBhcmFte0FjY2Vzc1JvfSwgJFBhcmFte0FjY2Vzc1J3fSApID0gJFNlbGYtPl9DaGVja01vZHVsZVBlcm1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVSZWcgPT4gJEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEkUGFyYW17QWNjZXNzUm99ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdObyBQZXJtaXNzaW9uIHRvIHVzZSB0aGlzIGZyb250ZW5kIHN1YmFjdGlvbiBtb2R1bGUhJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIG5ldyBMYXlvdXRPYmplY3Qgd2l0aCBuZXcgJyVQYXJhbScgYW5kICclVXNlckRhdGEnCiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdHNEaXNjYXJkKCBPYmplY3RzID0+IFsnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCddICk7CiAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgIyB1cGRhdGUgbGFzdCByZXF1ZXN0IHRpbWUKICAgICAgICBpZiAoICEkUGFyYW1PYmplY3QtPklzQUpBWFJlcXVlc3QoKSApIHsKICAgICAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgICAgICAkU2Vzc2lvbk9iamVjdC0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgICAgICAgICAgICAgS2V5ICAgICAgID0+ICdVc2VyTGFzdFJlcXVlc3QnLAogICAgICAgICAgICAgICAgVmFsdWUgICAgID0+ICREYXRlVGltZU9iamVjdC0+VG9FcG9jaCgpLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBwcmUgYXBwbGljYXRpb24gbW9kdWxlCiAgICAgICAgbXkgJFByZU1vZHVsZSA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbFByZUFwcGxpY2F0aW9uTW9kdWxlJyk7CiAgICAgICAgaWYgKCRQcmVNb2R1bGUpIHsKICAgICAgICAgICAgbXkgJVByZU1vZHVsZUxpc3Q7CiAgICAgICAgICAgIGlmICggcmVmICRQcmVNb2R1bGUgZXEgJ0hBU0gnICkgewogICAgICAgICAgICAgICAgJVByZU1vZHVsZUxpc3QgPSAleyRQcmVNb2R1bGV9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFByZU1vZHVsZUxpc3R7SW5pdH0gPSAkUHJlTW9kdWxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBNT0RVTEU6CiAgICAgICAgICAgIGZvciBteSAkUHJlTW9kdWxlS2V5ICggc29ydCBrZXlzICVQcmVNb2R1bGVMaXN0ICkgewogICAgICAgICAgICAgICAgbXkgJFByZU1vZHVsZSA9ICRQcmVNb2R1bGVMaXN0eyRQcmVNb2R1bGVLZXl9OwogICAgICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRQcmVNb2R1bGU7CiAgICAgICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSgkUHJlTW9kdWxlKTsKCiAgICAgICAgICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDdXN0b21lclBhbmVsUHJlQXBwbGljYXRpb24gbW9kdWxlICRQcmVNb2R1bGUgaXMgdXNlZC4iLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyB1c2UgbW9kdWxlCiAgICAgICAgICAgICAgICBteSAkUHJlTW9kdWxlT2JqZWN0ID0gJFByZU1vZHVsZS0+bmV3KAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlVXNlckRhdGEsCgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkUHJlTW9kdWxlT2JqZWN0LT5QcmVSdW4oKTsKICAgICAgICAgICAgICAgIGlmICgkT3V0cHV0KSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoIE91dHB1dCA9PiBcJE91dHB1dCApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gLiAnLT5uZXcnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJEZyb250ZW5kT2JqZWN0ID0gKCAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gKS0+bmV3KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgIERlYnVnICAgICA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICApOwoKICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnS2VybmVsOjpNb2R1bGVzOjonIC4gJFBhcmFte0FjdGlvbn0gLiAnLT5ydW4nLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyAtPlJ1biAkQWN0aW9uIHdpdGggJEZyb250ZW5kT2JqZWN0CiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoIE91dHB1dCA9PiBcJEZyb250ZW5kT2JqZWN0LT5SdW4oKSApOwoKICAgICAgICAjIGxvZyByZXF1ZXN0IHRpbWUKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnUGVyZm9ybWFuY2VMb2cnKSApIHsKICAgICAgICAgICAgaWYgKCAoICEkUXVlcnlTdHJpbmcgJiYgJFBhcmFte0FjdGlvbn0gKSB8fCAkUXVlcnlTdHJpbmcgIX4gL0FjdGlvbj0vICkgewogICAgICAgICAgICAgICAgJFF1ZXJ5U3RyaW5nID0gJ0FjdGlvbj0nIC4gJFBhcmFte0FjdGlvbn0gLiAnO1N1YmFjdGlvbj0nIC4gJFBhcmFte1N1YmFjdGlvbn07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbXkgJEZpbGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BlcmZvcm1hbmNlTG9nOjpGaWxlJyk7CiAgICAgICAgICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICBpZiAoIG9wZW4gbXkgJE91dCwgJz4+JywgJEZpbGUgKSB7CiAgICAgICAgICAgICAgICAjIyB1c2UgY3JpdGljCiAgICAgICAgICAgICAgICBwcmludCAkT3V0IHRpbWUoKQogICAgICAgICAgICAgICAgICAgIC4gJzo6Q3VzdG9tZXI6OicKICAgICAgICAgICAgICAgICAgICAuICggdGltZSgpIC0gJFNlbGYtPntQZXJmb3JtYW5jZUxvZ1N0YXJ0fSApCiAgICAgICAgICAgICAgICAgICAgLiAiOjokVXNlckRhdGF7VXNlckxvZ2lufTo6JFF1ZXJ5U3RyaW5nXG4iOwogICAgICAgICAgICAgICAgY2xvc2UgJE91dDsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1Jlc3BvbnNlOjpDdXN0b21lcjogJwogICAgICAgICAgICAgICAgICAgICAgICAuICggdGltZSgpIC0gJFNlbGYtPntQZXJmb3JtYW5jZUxvZ1N0YXJ0fSApCiAgICAgICAgICAgICAgICAgICAgICAgIC4gInMgdGFrZW4gKFVSTDokUXVlcnlTdHJpbmc6JFVzZXJEYXRhe1VzZXJMb2dpbn0pIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCB3cml0ZSAkRmlsZTogJCEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIHByaW50IGFuIGVycm9yIHNjcmVlbgogICAgbXkgJURhdGEgPSAkU2Vzc2lvbk9iamVjdC0+R2V0U2Vzc2lvbklERGF0YSgKICAgICAgICBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0sCiAgICApOwogICAgJERhdGF7VXNlclRpbWVab25lfSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVEYXRhKTsKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICVEYXRhLAogICAgICAgIH0sCiAgICApOwogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICApOwogICAgcmV0dXJuOwp9Cgo9YmVnaW4gSW50ZXJuYWw6Cgo9aGVhZDIgX0NoZWNrTW9kdWxlUGVybWlzc2lvbigpCgptb2R1bGUgcGVybWlzc2lvbiBjaGVjawoKICAgICgkQWNjZXNzUm8sICRBY2Nlc3NSdyA9ICRBdXRvUmVzcG9uc2VPYmplY3QtPl9DaGVja01vZHVsZVBlcm1pc3Npb24oCiAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgJVVzZXJEYXRhLAogICAgKTsKCj1jdXQKCnN1YiBfQ2hlY2tNb2R1bGVQZXJtaXNzaW9uIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEFjY2Vzc1JvID0gMDsKICAgIG15ICRBY2Nlc3NSdyA9IDA7CgogICAgUEVSTUlTU0lPTjoKICAgIGZvciBteSAkUGVybWlzc2lvbiAocXcoR3JvdXBSbyBHcm91cCkpIHsKICAgICAgICBteSAkQWNjZXNzT2sgPSAwOwogICAgICAgIG15ICRHcm91cCAgICA9ICRQYXJhbXtNb2R1bGVSZWd9LT57JFBlcm1pc3Npb259OwoKICAgICAgICBuZXh0IFBFUk1JU1NJT04gaWYgISRHcm91cDsKCiAgICAgICAgbXkgJEdyb3VwT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyR3JvdXAnKTsKCiAgICAgICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoJEdyb3VwKSApIHsKICAgICAgICAgICAgR1JPVVA6CiAgICAgICAgICAgIGZvciBteSAkSXRlbSAoIEB7JEdyb3VwfSApIHsKICAgICAgICAgICAgICAgIG5leHQgR1JPVVAgaWYgISRJdGVtOwogICAgICAgICAgICAgICAgbmV4dCBHUk9VUCBpZiAhJEdyb3VwT2JqZWN0LT5QZXJtaXNzaW9uQ2hlY2soCiAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9PiAkSXRlbSwKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJFBlcm1pc3Npb24gZXEgJ0dyb3VwUm8nID8gJ3JvJyA6ICdydycsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICRBY2Nlc3NPayA9IDE7CiAgICAgICAgICAgICAgICBsYXN0IEdST1VQOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBteSAkSGFzUGVybWlzc2lvbiA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkNoZWNrKAogICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICAgICAgR3JvdXBOYW1lID0+ICRHcm91cCwKICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAkUGVybWlzc2lvbiBlcSAnR3JvdXBSbycgPyAncm8nIDogJ3J3JywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRIYXNQZXJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgICAkQWNjZXNzT2sgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggJFBlcm1pc3Npb24gZXEgJ0dyb3VwJyAmJiAkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICRBY2Nlc3NSbyA9IDE7CiAgICAgICAgICAgICRBY2Nlc3NSdyA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFBlcm1pc3Npb24gZXEgJ0dyb3VwUm8nICYmICRBY2Nlc3NPayApIHsKICAgICAgICAgICAgJEFjY2Vzc1JvID0gMTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICggJEFjY2Vzc1JvLCAkQWNjZXNzUncgKTsKfQoKPWhlYWQyIF9Vc2VyVGltZVpvbmVHZXQoKQoKR2V0IHRpbWUgem9uZSBmb3IgdGhlIGN1cnJlbnQgdXNlci4gVGhpcyBmdW5jdGlvbiB3aWxsIHZhbGlkYXRlIHBhc3NlZCB0aW1lIHpvbmUgcGFyYW1ldGVyIGFuZCByZXR1cm4gZGVmYXVsdCB1c2VyIHRpbWUKem9uZSBpZiBpdCdzIG5vdCB2YWxpZC4KCiAgICBteSAkVXNlclRpbWVab25lID0gJFNlbGYtPl9Vc2VyVGltZVpvbmVHZXQoCiAgICAgICAgVXNlclRpbWVab25lID0+ICdFdXJvcGUvQmVybGluJywKICAgICk7Cgo9Y3V0CgpzdWIgX1VzZXJUaW1lWm9uZUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRVc2VyVGltZVpvbmU7CgogICAgIyBSZXR1cm4gcGFzc2VkIHRpbWUgem9uZSBvbmx5IGlmIGl0J3MgdmFsaWQuIEl0IGNhbiBoYXBwZW4gdGhhdCB1c2VyIHByZWZlcmVuY2VzIG9yIHNlc3Npb24gc3RvcmUgYW4gb2xkLXN0eWxlCiAgICAjICAgb2Zmc2V0IHdoaWNoIGlzIG5vdCB2YWxpZCBhbnltb3JlLiBJbiB0aGlzIGNhc2UsIHJldHVybiB0aGUgZGVmYXVsdCB2YWx1ZS4KICAgICMgICBQbGVhc2Ugc2VlIGJ1ZyMxMzM3NCBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICAgIGlmICgKICAgICAgICAkUGFyYW17VXNlclRpbWVab25lfQogICAgICAgICYmIEtlcm5lbDo6U3lzdGVtOjpEYXRlVGltZS0+SXNUaW1lWm9uZVZhbGlkKCBUaW1lWm9uZSA9PiAkUGFyYW17VXNlclRpbWVab25lfSApCiAgICAgICAgKQogICAgewogICAgICAgICRVc2VyVGltZVpvbmUgPSAkUGFyYW17VXNlclRpbWVab25lfTsKICAgIH0KCiAgICAkVXNlclRpbWVab25lIHx8PSBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUtPlVzZXJEZWZhdWx0VGltZVpvbmVHZXQoKTsKCiAgICByZXR1cm4gJFVzZXJUaW1lWm9uZTsKfQoKPWVuZCBJbnRlcm5hbDoKCj1jdXQKCnN1YiBERVNUUk9ZIHsKICAgIG15ICRTZWxmID0gc2hpZnQ7CgogICAgIyBkZWJ1ZyBpbmZvCiAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnR2xvYmFsIGhhbmRsZSBzdG9wcGVkLicsCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKMTsKCj1oZWFkMSBURVJNUyBBTkQgQ09ORElUSU9OUwoKVGhpcyBzb2Z0d2FyZSBpcyBwYXJ0IG9mIHRoZSBPVFJTIHByb2plY3QgKEw8aHR0cHM6Ly9vdHJzLm9yZy8+KS4KClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCnRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQpkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgTDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0Pi4KCj1jdXQK</File>
    </Filelist>
</otrs_package>