<?xml version="1.0" encoding="utf-8" ?>
<otrs_package version="1.1">
    <Name>Znuny-Google-Captcha</Name>
    <Version>7.0.3</Version>
    <Vendor>mo-azfar</Vendor>
    <URL>https://github.com/mo-azfar/OTRS-Google-Captcha-for-Login-Form</URL>
    <License>GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007</License>
    <ChangeLog Date="2023-08-21 00:00:01" Version="7.0.1">New package.</ChangeLog>
    <ChangeLog Date="2023-09-01 00:10:00" Version="7.0.2">Add required cpan module.</ChangeLog>
	<ChangeLog Date="2023-12-18 00:10:00" Version="7.0.3">change plugin asynchronous initial name from OTRS to Znuny for bug https://github.com/znuny/Znuny/issues/524.</ChangeLog>
    <Description Lang="en">Google reCaptcha at Znuny agent portal and customer portal (login form).</Description>
    <Framework>7.0.x</Framework>
    <IntroInstall Lang="en" Title="Install Information" Type="pre">
        &lt;br&gt;
        &lt;b&gt;WELCOME&lt;/b&gt;
        &lt;br&gt;
        &lt;br&gt;
        You are about to install the package Znuny-Google-Captcha. Make sure cpan module &lt;b&gt;Captcha::reCAPTCHA::V2&lt;/b&gt; is installed first.&lt;br/&gt;&lt;br/&gt;Check &lt;a href='https://github.com/mo-azfar/OTRS-Google-Captcha-for-Login-Form' target='_blank'&gt;README&lt;/a&gt;&lt;br&gt;
        &lt;br&gt;
        &lt;br&gt;
		DO RESTART YOUR WEBSERVER AFTERWARDS
		&lt;br&gt;
        ((enjoy))&lt;br&gt;
        &lt;br&gt;
    </IntroInstall>
    <ModuleRequired>Captcha::reCAPTCHA::V2</ModuleRequired>
    <BuildDate>2023-12-18 14:51:15</BuildDate>
    <BuildHost>app.wsl.my</BuildHost>
    <Filelist>
        <File Location="Kernel/Config/Files/XML/ZZZGoogleCaptcha.xml" Permission="660" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxvdHJzX2NvbmZpZyB2ZXJzaW9uPSIyLjAiIGluaXQ9IkNvbmZpZyI+DQogICAgPFNldHRpbmcgTmFtZT0iRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QjIyNTaG93R29vZ2xlQ2FwdGNoYSIgUmVxdWlyZWQ9IjAiIFZhbGlkPSIxIj4NCiAgICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+TW9kdWxlIHRvIHNob3cgZ29vZ2xlIGNhcGN0aGEuPC9EZXNjcmlwdGlvbj4NCiAgICAgICAgPE5hdmlnYXRpb24+RnJvbnRlbmQ6OkJhc2U6Ok91dHB1dEZpbHRlcjwvTmF2aWdhdGlvbj4NCiAgICAgICAgPFZhbHVlPg0KICAgICAgICAgICAgPEhhc2g+DQogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJNb2R1bGUiPktlcm5lbDo6T3V0cHV0OjpIVE1MOjpGaWx0ZXJFbGVtZW50UG9zdDo6U2hvd0dvb2dsZUNhcHRjaGE8L0l0ZW0+DQogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJUZW1wbGF0ZXMiPg0KICAgICAgICAgICAgICAgICAgICA8SGFzaD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxJdGVtIEtleT0iTG9naW4iPjA8L0l0ZW0+DQoJCQkJCQk8SXRlbSBLZXk9IkN1c3RvbWVyTG9naW4iPjA8L0l0ZW0+DQogICAgICAgICAgICAgICAgICAgIDwvSGFzaD4NCiAgICAgICAgICAgICAgICA8L0l0ZW0+DQogICAgICAgICAgICA8L0hhc2g+DQogICAgICAgIDwvVmFsdWU+DQogICAgPC9TZXR0aW5nPg0KCTxTZXR0aW5nIE5hbWU9Ikdvb2dsZUNhcHRjaGE6OlNpdGVLZXkiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMSI+DQogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPkRlZmluZXMgdGhlIGdvb2dsZSByZWNhcHRjaGEgc2l0ZSBrZXk8L0Rlc2NyaXB0aW9uPg0KICAgICAgICA8TmF2aWdhdGlvbj5Hb29nbGVDYXB0Y2hhPC9OYXZpZ2F0aW9uPg0KICAgICAgICA8VmFsdWU+DQogICAgICAgICAgICA8SXRlbSBWYWx1ZVR5cGU9IlN0cmluZyIgVmFsdWVSZWdleD0iIj5TSVRFX0tFWV9IRVJFPC9JdGVtPg0KICAgICAgICA8L1ZhbHVlPg0KICAgIDwvU2V0dGluZz4NCiAgICA8U2V0dGluZyBOYW1lPSJHb29nbGVDYXB0Y2hhOjpTZWNyZXRLZXkiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMSI+DQogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPkRlZmluZXMgdGhlIGdvb2dsZSByZWNhcHRjaGEgc2VjcmV0IGtleTwvRGVzY3JpcHRpb24+DQogICAgICAgIDxOYXZpZ2F0aW9uPkdvb2dsZUNhcHRjaGE8L05hdmlnYXRpb24+DQogICAgICAgIDxWYWx1ZT4NCiAgICAgICAgICAgIDxJdGVtIFZhbHVlVHlwZT0iU3RyaW5nIiBWYWx1ZVJlZ2V4PSIiPlNFQ1JFVF9LRVlfSEVSRTwvSXRlbT4NCiAgICAgICAgPC9WYWx1ZT4NCiAgICA8L1NldHRpbmc+DQo8L290cnNfY29uZmlnPg0K</File>
        <File Location="Custom/Kernel/Output/HTML/FilterElementPost/ShowGoogleCaptcha.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkZpbHRlckVsZW1lbnRQb3N0OjpTaG93R29vZ2xlQ2FwdGNoYTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnLAopOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJENvbmZpZ09iamVjdCAgICAgICAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgI215ICRQYXJhbU9iamVjdCAgICAgICAgICAgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoJCgkjIC0tCgkjIEFnZW50IEdvb2dsZSBDYXB0Y2hhCgkjIC0tCglpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9IGVxICdMb2dpbicpCiAgICB7CgkJdXNlIENhcHRjaGE6OnJlQ0FQVENIQTo6VjI7CiAgICAgICAgbXkgJFNpdGVLZXkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0dvb2dsZUNhcHRjaGE6OlNpdGVLZXknKTsJCQogICAgICAgIG15ICRyYyA9IENhcHRjaGE6OnJlQ0FQVENIQTo6VjItPm5ldzsKCQlteSAkY2FwdGNoYWZpZWxkID0gJHJjLT5odG1sKCRTaXRlS2V5LCB7IHRoZW1lID0+ICdkYXJrJyB9LCB7IHNpemUgPT4gJ2NvbXBhY3QnIH0sIHsgdHlwZSA9PiAnaW1hZ2UnIH0pOwoJCW15ICRGaWVsZCA9IHFxfgoJCTxkaXY+JGNhcHRjaGFmaWVsZDwvZGl2PgoJCX47CgkgICAgICAgICAgICAKCQlteSAkU2VhcmNoRmllbGQgPSBxdW90ZW1ldGEgIjxkaXYgY2xhc3M9XCJGaWVsZFwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBpZD1cIkxvZ2luQnV0dG9uXCIgY2xhc3M9XCJidG4tbWFpbiBidG4tcHJpbWFyeVwiIHZhbHVlPVwiTG9naW5cIiBkaXNhYmxlZD1cImRpc2FibGVkXCI+PHNwYW4+TG9naW48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IjsKCQoJCW15ICRSZXR1cm5GaWVsZCA9IHFxfjxkaXYgY2xhc3M9IkZpZWxkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGlkPSJMb2dpbkJ1dHRvbiIgY2xhc3M9ImJ0bi1tYWluIGJ0bi1wcmltYXJ5IiB2YWx1ZT0iTG9naW4iIGRpc2FibGVkPSJkaXNhYmxlZCI+PHNwYW4+TG9naW48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgkJfjsKCQoJCSNzZWFyY2ggYW5kIHJlcGxhY2UJIAoJCSR7ICRQYXJhbXtEYXRhfSB9ID1+IHN7JFNlYXJjaEZpZWxkfXskRmllbGQgJFJldHVybkZpZWxkfTsKCQkKICAgIH0gIAoJIyAtLQoJCgkjIC0tCgkjIEN1c3RvbWVyIEdvb2dsZSBDYXB0Y2hhCgkjIC0tCglpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9IGVxICdDdXN0b21lckxvZ2luJykKICAgIHsKCQl1c2UgQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMjsKICAgICAgICBteSAkU2l0ZUtleSA9ICRDb25maWdPYmplY3QtPkdldCgnR29vZ2xlQ2FwdGNoYTo6U2l0ZUtleScpOwkJCiAgICAgICAgbXkgJHJjID0gQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMi0+bmV3OwoJCW15ICRjYXB0Y2hhZmllbGQgPSAkcmMtPmh0bWwoJFNpdGVLZXksIHsgdGhlbWUgPT4gJ2RhcmsnIH0sIHsgc2l6ZSA9PiAnY29tcGFjdCcgfSwgeyB0eXBlID0+ICdpbWFnZScgfSk7CgkJbXkgJEZpZWxkID0gcXF+CgkJPGRpdj4kY2FwdGNoYWZpZWxkPC9kaXY+CgkJfjsKCSAgICAgICAgICAgIAoJCW15ICRTZWFyY2hGaWVsZCA9IHF1b3RlbWV0YSAiPGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIkxvZyBJblwiIGNsYXNzPVwiYnRuLW1haW4gYnRuLXByaW1hcnlcIiBkaXNhYmxlZD1cImRpc2FibGVkXCI+TG9nIEluPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4iOwoJCgkJbXkgJFJldHVybkZpZWxkID0gcXF+PGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgdmFsdWU9IkxvZyBJbiIgY2xhc3M9ImJ0bi1tYWluIGJ0bi1wcmltYXJ5IiBkaXNhYmxlZD0iZGlzYWJsZWQiPkxvZyBJbjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CgkJfjsKCQoJCSNzZWFyY2ggYW5kIHJlcGxhY2UJIAoJCSR7ICRQYXJhbXtEYXRhfSB9ID1+IHN7JFNlYXJjaEZpZWxkfXskRmllbGQgJFJldHVybkZpZWxkfTsKCQkKICAgIH0gIAoJIyAtLQoJCiAgICByZXR1cm4gMTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/Web/InterfaceAgent.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxIFpudW55IEdtYkgsIGh0dHBzOi8vem51bnkub3JnLwojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQWdlbnQ7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwp1c2UgS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJywKICAgICdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEQicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkVtYWlsJywKICAgICdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6U2NoZWR1bGVyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnLAopOwoKPWhlYWQxIE5BTUUKCktlcm5lbDo6U3lzdGVtOjpXZWI6OkludGVyZmFjZUFnZW50IC0gdGhlIGFnZW50IHdlYiBpbnRlcmZhY2UKCj1oZWFkMSBERVNDUklQVElPTgoKdGhlIGdsb2JhbCBhZ2VudCB3ZWIgaW50ZXJmYWNlIChhdXRoZW50aWNhdGlvbiwgc2Vzc2lvbiBoYW5kbGluZywgLi4uKQoKPWhlYWQxIFBVQkxJQyBJTlRFUkZBQ0UKCj1oZWFkMiBuZXcoKQoKY3JlYXRlIGFnZW50IHdlYiBpbnRlcmZhY2Ugb2JqZWN0LiBEbyBub3QgdXNlIGl0IGRpcmVjdGx5LCBpbnN0ZWFkIHVzZToKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXI7CiAgICBteSAkRGVidWcgPSAwLAogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpJbnRlcmZhY2VBZ2VudCcgPT4gewogICAgICAgICAgICBEZWJ1ZyAgID0+IDAsCiAgICAgICAgICAgIFdlYlJlcXVlc3QgPT4gQ0dJOjpGYXN0LT5uZXcoKSwgIyBvcHRpb25hbCwgZS4gZy4gaWYgZmFzdCBjZ2kgaXMgdXNlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRoZSBDR0kgb2JqZWN0IGlzIGFscmVhZHkgcHJvdmlkZWQKICAgICAgICB9CiAgICApOwogICAgbXkgJEludGVyZmFjZUFnZW50ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQWdlbnQnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBQZXJmb3JtYW5jZSBsb2cKICAgICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gPSB0aW1lKCk7CgogICAgIyBnZXQgZGVidWcgbGV2ZWwKICAgICRTZWxmLT57RGVidWd9ID0gJFBhcmFte0RlYnVnfSB8fCAwOwoKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycgPT4gewogICAgICAgICAgICBMb2dQcmVmaXggPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDR0lMb2dQcmVmaXgnKSwKICAgICAgICB9LAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyA9PiB7CiAgICAgICAgICAgIFdlYlJlcXVlc3QgPT4gJFBhcmFte1dlYlJlcXVlc3R9IHx8IDAsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBkZWJ1ZyBpbmZvCiAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnR2xvYmFsIGhhbmRsZSBzdGFydGVkLi4uJywKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAkU2VsZjsKfQoKPWhlYWQyIFJ1bigpCgpleGVjdXRlIHRoZSBvYmplY3QKCiAgICAkSW50ZXJmYWNlQWdlbnQtPlJ1bigpOwoKPWN1dAoKc3ViIFJ1biB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRRdWVyeVN0cmluZyA9ICRFTlZ7UVVFUllfU1RSSU5HfSB8fCAnJzsKCiAgICAjIENoZWNrIGlmIGh0dHBzIGZvcmNpbmcgaXMgYWN0aXZlLCBhbmQgcmVkaXJlY3QgaWYgbmVlZGVkLgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hUVFBTRm9yY2VSZWRpcmVjdCcpICkgewoKICAgICAgICAjIFNvbWUgd2ViIHNlcnZlcnMgZG8gbm90IHNldCBIVFRQUyBlbnZpcm9ubWVudCB2YXJpYWJsZSwgc28gaXQncyBub3QgcG9zc2libGUgdG8gZWFzaWx5IGtub3cgaWYgd2UgYXJlIHVzaW5nCiAgICAgICAgIyAgIGh0dHBzIHByb3RvY29sLiBMb29rIGFsc28gZm9yIHNpbWlsYXJseSBuYW1lZCBrZXlzIGluIGVudmlyb25tZW50IGhhc2gsIHNpbmNlIHRoaXMgc2hvdWxkIHByZXZlbnQgbG9vcHMgaW4KICAgICAgICAjICAgY2VydGFpbiBjYXNlcy4KICAgICAgICBpZiAoCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICFkZWZpbmVkICRFTlZ7SFRUUFN9CiAgICAgICAgICAgICAgICAmJiAhZ3JlcCB7L15IVFRQUyg/Ol98JCkvfSBrZXlzICVFTlYKICAgICAgICAgICAgKQogICAgICAgICAgICB8fCAkRU5We0hUVFBTfSBuZSAnb24nCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICRIb3N0ID0gJEVOVntIVFRQX0hPU1R9IHx8ICRDb25maWdPYmplY3QtPkdldCgnRlFETicpOwoKICAgICAgICAgICAgIyBSZWRpcmVjdCB3aXRoIDMwMSBjb2RlLiBBZGQgdHdvIG5ldyBsaW5lcyBhdCB0aGUgZW5kLCBzbyBIVFRQIGhlYWRlcnMgYXJlIHZhbGlkYXRlZCBjb3JyZWN0bHkuCiAgICAgICAgICAgIHByaW50ICJTdGF0dXM6IDMwMSBNb3ZlZCBQZXJtYW5lbnRseVxuTG9jYXRpb246IGh0dHBzOi8vJEhvc3QkRU5We1JFUVVFU1RfVVJJfVxuXG4iOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRQYXJhbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICBteSAlUGFyYW07CgogICAgIyBnZXQgc2Vzc2lvbiBpZAogICAgJFBhcmFte1Nlc3Npb25OYW1lfSA9ICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvbk5hbWUnKSAgICAgICAgICAgICAgICAgICAgICB8fCAnU2Vzc2lvbklEJzsKICAgICRQYXJhbXtTZXNzaW9uSUR9ICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9ICkgfHwgJyc7CgogICAgIyBkcm9wIG9sZCBzZXNzaW9uIGlkIChpZiBleGlzdHMpCiAgICAkUXVlcnlTdHJpbmcgPX4gcy8oXD98Jnw7fCkkUGFyYW17U2Vzc2lvbk5hbWV9KD0mfD07fD0uKz8mfD0uKz8kKS87L2c7CgogICAgIyBkZWZpbmUgZnJhbWV3b3JrIHBhcmFtcwogICAgbXkgJEZyYW1ld29ya1BhcmFtcyA9IHsKICAgICAgICBMYW5nICAgICAgICAgPT4gJycsCiAgICAgICAgQWN0aW9uICAgICAgID0+ICcnLAogICAgICAgIFN1YmFjdGlvbiAgICA9PiAnJywKICAgICAgICBSZXF1ZXN0ZWRVUkwgPT4gJFF1ZXJ5U3RyaW5nLAogICAgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JEZyYW1ld29ya1BhcmFtc30gKSB7CiAgICAgICAgJFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApCiAgICAgICAgICAgIHx8ICRGcmFtZXdvcmtQYXJhbXMtPnskS2V5fTsKICAgIH0KCiAgICAjIHZhbGlkYXRlIGxhbmd1YWdlCiAgICBpZiAoICRQYXJhbXtMYW5nfSAmJiAkUGFyYW17TGFuZ30gIX4gbXtcQVthLXpdezJ9KD86X1tBLVpdezJ9KT9cen14bXMgKSB7CiAgICAgICAgZGVsZXRlICRQYXJhbXtMYW5nfTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHRoZSBicm93c2VyIHNlbmRzIHRoZSBTZXNzaW9uSUQgY29va2llIGFuZCBzZXQgdGhlIFNlc3Npb25JRC1jb29raWUKICAgICMgYXMgU2Vzc2lvbklEISBHRVQgb3IgUE9TVCBTZXNzaW9uSUQgaGF2ZSB0aGUgbG93ZXN0IHByaW9yaXR5LgogICAgbXkgJEJyb3dzZXJIYXNDb29raWUgPSAwOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25Vc2VDb29raWUnKSApIHsKICAgICAgICAkUGFyYW17U2Vzc2lvbklEQ29va2llfSA9ICRQYXJhbU9iamVjdC0+R2V0Q29va2llKCBLZXkgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSApOwogICAgICAgIGlmICggJFBhcmFte1Nlc3Npb25JRENvb2tpZX0gKSB7CiAgICAgICAgICAgICRQYXJhbXtTZXNzaW9uSUR9ID0gJFBhcmFte1Nlc3Npb25JRENvb2tpZX07CiAgICAgICAgfQogICAgfQoKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICBMYW5nICAgICAgICAgPT4gJFBhcmFte0xhbmd9LAogICAgICAgICAgICBVc2VyTGFuZ3VhZ2UgPT4gJFBhcmFte0xhbmd9LAogICAgICAgIH0sCiAgICAgICAgJ0tlcm5lbDo6TGFuZ3VhZ2UnID0+IHsKICAgICAgICAgICAgVXNlckxhbmd1YWdlID0+ICRQYXJhbXtMYW5nfQogICAgICAgIH0sCiAgICApOwoKICAgIG15ICRDb29raWVTZWN1cmVBdHRyaWJ1dGU7CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSHR0cFR5cGUnKSBlcSAnaHR0cHMnICkgewoKICAgICAgICAjIFJlc3RyaWN0IENvb2tpZSB0byBIVFRQUyBpZiBpdCBpcyB1c2VkLgogICAgICAgICRDb29raWVTZWN1cmVBdHRyaWJ1dGUgPSAxOwogICAgfQoKICAgIG15ICREQkNhbkNvbm5lY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+Q29ubmVjdCgpOwoKICAgIGlmICggISREQkNhbkNvbm5lY3QgfHwgJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgaWYgKCAhJERCQ2FuQ29ubmVjdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+RXJyb3IoKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFBhcmFtT2JqZWN0LT5FcnJvcigpLAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGNvbW1vbiBhcHBsaWNhdGlvbiBhbmQgYWRkLW9uIGFwcGxpY2F0aW9uIHBhcmFtcwogICAgbXkgJUNvbW1vbk9iamVjdFBhcmFtID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6Q29tbW9uUGFyYW0nKSB9OwogICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJUNvbW1vbk9iamVjdFBhcmFtICkgewogICAgICAgICRQYXJhbXskS2V5fSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRLZXkgKSB8fCAkQ29tbW9uT2JqZWN0UGFyYW17JEtleX07CiAgICB9CgogICAgIyBzZWN1cml0eSBjaGVjayBBY3Rpb24gUGFyYW0gKHJlcGxhY2Ugbm9uIHdvcmQgY2hhcnMpCiAgICAkUGFyYW17QWN0aW9ufSA9fiBzL1xXLy9nOwoKICAgIG15ICRTZXNzaW9uT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyk7CiAgICBteSAkVXNlck9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyk7CgogICAgIyBjaGVjayByZXF1ZXN0IHR5cGUKICAgIGlmICggJFBhcmFte0FjdGlvbn0gZXEgJ1ByZUxvZ2luJyApIHsKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJFBhcmFte1JlcXVlc3RlZFVSTH0gfHwgIkFjdGlvbj1BZ2VudERhc2hib2FyZCI7CgogICAgICAgICMgbG9naW4gc2NyZWVuCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgTW9kZSAgPT4gJ1ByZUxvZ2luJywKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdMb2dpbicgKSB7CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgIG15ICRQb3N0VXNlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdVc2VyJyApIHx8ICcnOwogICAgICAgIG15ICRQb3N0UHcgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oCiAgICAgICAgICAgIFBhcmFtID0+ICdQYXNzd29yZCcsCiAgICAgICAgICAgIFJhdyAgID0+IDEKICAgICAgICApIHx8ICcnOwogICAgICAgIG15ICRQb3N0VHdvRmFjdG9yVG9rZW4gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKAogICAgICAgICAgICBQYXJhbSA9PiAnVHdvRmFjdG9yVG9rZW4nLAogICAgICAgICAgICBSYXcgICA9PiAxCiAgICAgICAgKSB8fCAnJzsKCQkKCQkjIC0tCgkJIyBBZ2VudCBHb29nbGUgQ2FwdGNoYQoJCSMgLS0KICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QnKS0+e1Nob3dHb29nbGVDYXB0Y2hhfS0+e1RlbXBsYXRlc30tPntMb2dpbn0gKQoJCXsKCQkJdXNlIENhcHRjaGE6OnJlQ0FQVENIQTo6VjI7CiAgICAgICAgICAgIG15ICRyYyA9IENhcHRjaGE6OnJlQ0FQVENIQTo6VjItPm5ldzsKICAgICAgICAgICAgbXkgJFNlY3JldEtleSA9ICRDb25maWdPYmplY3QtPkdldCgnR29vZ2xlQ2FwdGNoYTo6U2VjcmV0S2V5Jyk7CQkJCiAgICAgICAgICAgIG15ICRyZXNwb25zZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oUGFyYW0gPT4gJ2ctcmVjYXB0Y2hhLXJlc3BvbnNlJykgfHwgJyc7CiAgICAgICAgICAgIG15ICRyZXN1bHQgPSAkcmMtPnZlcmlmeSgkU2VjcmV0S2V5LCAkcmVzcG9uc2UpOwogICAgCiAgICAgICAgICAgIGlmICggISRyZXN1bHQtPntzdWNjZXNzfSApIAogICAgICAgICAgICB7CgkJCQkjbXkgJGNfZXJyb3IgPSAkcmVzdWx0LT57ZXJyb3JfY29kZXN9LT5bMF07CgkJCQkjIHNob3cgbmVlZCB1c2VyIGRhdGEgZXJyb3IgbWVzc2FnZQoJCQkJJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5QcmludCgKCQkJCQlPdXRwdXQgPT4gXCRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+TG9naW4oCgkJCQkJCVRpdGxlICAgPT4gJ0xvZ2luJywKCQkJCQkJTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoInJlQ0FQVENIQSBlbnRyeSBmYWlsZWQuICRyZXN1bHQtPntlcnJvcl9jb2Rlc30tPlswXSIpLAoJCQkJCQlNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAoJCQkJCSksCgkJCQkpOwoJCQkKCQkJCXJldHVybjsKICAgICAgICAgICAgfQoJCX0gCiAgICAgICAgIyAtLQoJCQogICAgICAgICMgY3JlYXRlIEF1dGhPYmplY3QKICAgICAgICBteSAkQXV0aE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpBdXRoJyk7CgogICAgICAgICMgY2hlY2sgc3VibWl0dGVkIGRhdGEKICAgICAgICBteSAkVXNlciA9ICRBdXRoT2JqZWN0LT5BdXRoKAogICAgICAgICAgICBVc2VyICAgICAgICAgICA9PiAkUG9zdFVzZXIsCiAgICAgICAgICAgIFB3ICAgICAgICAgICAgID0+ICRQb3N0UHcsCiAgICAgICAgICAgIFR3b0ZhY3RvclRva2VuID0+ICRQb3N0VHdvRmFjdG9yVG9rZW4sCiAgICAgICAgKTsKCiAgICAgICAgIyBsb2dpbiBpcyBpbnZhbGlkCiAgICAgICAgaWYgKCAhJFVzZXIgKSB7CgogICAgICAgICAgICBteSAkRXhwaXJlcyA9ICcrJyAuICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvbk1heFRpbWUnKSAuICdzJzsKICAgICAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llQWZ0ZXJCcm93c2VyQ2xvc2UnKSApIHsKICAgICAgICAgICAgICAgICRFeHBpcmVzID0gJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9UUlNCcm93c2VySGFzQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAkRXhwaXJlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+ICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnTG9naW5VUkwnKSApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1Mb2dpbkZhaWxlZCZSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5HZXRMb2dFbnRyeSgKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9PiAnSW5mbycsCiAgICAgICAgICAgICAgICAgICAgICAgIFdoYXQgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJEF1dGhPYmplY3QtPkdldExhc3RFcnJvck1lc3NhZ2UoKSApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IFRyYW5zbGF0YWJsZSgnTG9naW4gZmFpbGVkISBZb3VyIHVzZXIgbmFtZSBvciBwYXNzd29yZCB3YXMgZW50ZXJlZCBpbmNvcnJlY3RseS4nKSwKICAgICAgICAgICAgICAgICAgICBMb2dpbkZhaWxlZCA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICAgICAgPT4gJFVzZXIsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBpcyBzdWNjZXNzZnVsCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFVzZXJPYmplY3QtPkdldFVzZXJEYXRhKAogICAgICAgICAgICBVc2VyICAgICAgICAgID0+ICRVc2VyLAogICAgICAgICAgICBWYWxpZCAgICAgICAgID0+IDEsCiAgICAgICAgICAgIE5vT3V0T2ZPZmZpY2UgPT4gMSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGNvb2tpZXMKICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+R2V0Q29va2llKCBLZXkgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJyApICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgICAgIEJyb3dzZXJIYXNDb29raWUgPT4gMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIG5lZWRlZCBkYXRhCiAgICAgICAgaWYgKCAhJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRVc2VyRGF0YXtVc2VyTG9naW59ICkgewoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICBwcmludCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgLiAnP1JlYXNvbj1TeXN0ZW1FcnJvcicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyBzaG93IG5lZWQgdXNlciBkYXRhIGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdBdXRoZW50aWNhdGlvbiBzdWNjZWVkZWQsIGJ1dCBubyB1c2VyIGRhdGEgcmVjb3JkIGlzIGZvdW5kIGluIHRoZSBkYXRhYmFzZS4gUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJwogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbXkgJERhdGVUaW1lT2JqID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgICMgY3JlYXRlIG5ldyBzZXNzaW9uIGlkCiAgICAgICAgbXkgJE5ld1Nlc3Npb25JRCA9ICRTZXNzaW9uT2JqZWN0LT5DcmVhdGVTZXNzaW9uSUQoCiAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgVXNlckxhc3RSZXF1ZXN0ID0+ICREYXRlVGltZU9iai0+VG9FcG9jaCgpLAogICAgICAgICAgICBVc2VyVHlwZSAgICAgICAgPT4gJ1VzZXInLAogICAgICAgICAgICBTZXNzaW9uU291cmNlICAgPT4gJ0FnZW50SW50ZXJmYWNlJywKICAgICAgICApOwoKICAgICAgICAjIHNob3cgZXJyb3IgbWVzc2FnZSBpZiBubyBzZXNzaW9uIGlkIGhhcyBiZWVuIGNyZWF0ZWQKICAgICAgICBpZiAoICEkTmV3U2Vzc2lvbklEICkgewoKICAgICAgICAgICAgIyBnZXQgZXJyb3IgbWVzc2FnZQogICAgICAgICAgICBteSAkRXJyb3IgPSAkU2Vzc2lvbk9iamVjdC0+U2Vzc2lvbklERXJyb3JNZXNzYWdlKCkgfHwgJyc7CgogICAgICAgICAgICAjIG91dHB1dCBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+ICRFcnJvciwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZXhlY3V0aW9uIGluIDIwIHNlY29uZHMKICAgICAgICBteSAkRXhlY3V0aW9uVGltZU9iaiA9ICREYXRlVGltZU9iai0+Q2xvbmUoKTsKICAgICAgICAkRXhlY3V0aW9uVGltZU9iai0+QWRkKCBTZWNvbmRzID0+IDIwICk7CiAgICAgICAgbXkgJEV4ZWN1dGlvblRpbWUgPSAkRXhlY3V0aW9uVGltZU9iai0+VG9TdHJpbmcoKTsKCiAgICAgICAgIyBhZGQgYSBhc3ljaHJvbm91cyBleGVjdXRvciBzY2hlZHVsZXIgdGFzayB0byBjb3VudCB0aGUgY29uY3VycmVudCB1c2VyCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlNjaGVkdWxlcicpLT5UYXNrQWRkKAogICAgICAgICAgICBFeGVjdXRpb25UaW1lICAgICAgICAgICAgPT4gJEV4ZWN1dGlvblRpbWUsCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgICAgICAgICA9PiAnQXN5bmNocm9ub3VzRXhlY3V0b3InLAogICAgICAgICAgICBOYW1lICAgICAgICAgICAgICAgICAgICAgPT4gJ1BsdWdpbkFzeW5jaHJvbm91czo6Q29uY3VycmVudFVzZXInLAogICAgICAgICAgICBNYXhpbXVtUGFyYWxsZWxJbnN0YW5jZXMgPT4gMSwKICAgICAgICAgICAgRGF0YSAgICAgICAgICAgICAgICAgICAgID0+IHsKICAgICAgICAgICAgICAgIE9iamVjdCAgID0+ICdLZXJuZWw6OlN5c3RlbTo6U3VwcG9ydERhdGFDb2xsZWN0b3I6OlBsdWdpbkFzeW5jaHJvbm91czo6Wm51bnk6OkNvbmN1cnJlbnRVc2VycycsCiAgICAgICAgICAgICAgICBGdW5jdGlvbiA9PiAnUnVuQXN5bmNocm9ub3VzJywKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBteSAkVXNlclRpbWVab25lID0gJFNlbGYtPl9Vc2VyVGltZVpvbmVHZXQoJVVzZXJEYXRhKTsKCiAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlclRpbWVab25lJywKICAgICAgICAgICAgVmFsdWUgICAgID0+ICRVc2VyVGltZVpvbmUsCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBpZiB0aGUgdGltZSB6b25lIG9mZnNldCByZXBvcnRlZCBieSB0aGUgdXNlcidzIGJyb3dzZXIgZGlmZmVycyBmcm9tIHRoYXQKICAgICAgICAjIG9mIHRoZSBPVFJTIHVzZXIncyB0aW1lIHpvbmUgb2Zmc2V0CiAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgKICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICBUaW1lWm9uZSA9PiAkVXNlclRpbWVab25lLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgbXkgJE9UUlNVc2VyVGltZVpvbmVPZmZzZXQgPSAkRGF0ZVRpbWVPYmplY3QtPkZvcm1hdCggRm9ybWF0ID0+ICcle29mZnNldH0nICkgLyA2MDsKICAgICAgICBteSAkQnJvd3NlclRpbWVab25lT2Zmc2V0ICA9ICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1RpbWVab25lT2Zmc2V0JyApIHx8IDAgKSAqIC0xOwoKICAgICAgICAjIFRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSBjb250YWlucyB0aGUgZGlmZmVyZW5jZSBvZiB0aGUgdGltZSB6b25lIG9mZnNldCBiZXR3ZWVuCiAgICAgICAgIyB0aGUgdXNlcidzIE9UUlMgdGltZSB6b25lIHNldHRpbmcgYW5kIHRoZSBvbmUgcmVwb3J0ZWQgYnkgdGhlIHVzZXIncyBicm93c2VyLgogICAgICAgICMgSWYgdGhlcmUgaXMgYSBkaWZmZXJlbmNlIGl0IGNhbiBiZSBldmFsdWF0ZWQgbGF0ZXIgdG8gZS4gZy4gc2hvdyBhIG1lc3NhZ2UKICAgICAgICAjIGZvciB0aGUgdXNlciB0byBjaGVjayBoaXMgT1RSUyB0aW1lIHpvbmUgc2V0dGluZy4KICAgICAgICBteSAkVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSA9IGFicyggJE9UUlNVc2VyVGltZVpvbmVPZmZzZXQgLSAkQnJvd3NlclRpbWVab25lT2Zmc2V0ICk7CiAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZScsCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVXNlclRpbWVab25lT2Zmc2V0RGlmZmVyZW5jZSwKICAgICAgICApOwoKICAgICAgICAjIGNyZWF0ZSBhIG5ldyBMYXlvdXRPYmplY3Qgd2l0aCBTZXNzaW9uSURDb29raWUKICAgICAgICBteSAkRXhwaXJlcyA9ICcrJyAuICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvbk1heFRpbWUnKSAuICdzJzsKICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25Vc2VDb29raWVBZnRlckJyb3dzZXJDbG9zZScpICkgewogICAgICAgICAgICAkRXhwaXJlcyA9ICcnOwogICAgICAgIH0KCiAgICAgICAgbXkgJFNlY3VyZUF0dHJpYnV0ZTsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSHR0cFR5cGUnKSBlcSAnaHR0cHMnICkgewoKICAgICAgICAgICAgIyBSZXN0cmljdCBDb29raWUgdG8gSFRUUFMgaWYgaXQgaXMgdXNlZC4KICAgICAgICAgICAgJFNlY3VyZUF0dHJpYnV0ZSA9IDE7CiAgICAgICAgfQoKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uSURDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICROZXdTZXNzaW9uSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICRFeHBpcmVzLAogICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+IHNjYWxhciAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgT1RSU0Jyb3dzZXJIYXNDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICdPVFJTQnJvd3Nlckhhc0Nvb2tpZScsCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAnLTF5JywKICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgU2Vzc2lvbklEICAgPT4gJE5ld1Nlc3Npb25JRCwKICAgICAgICAgICAgICAgIFNlc3Npb25OYW1lID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgIyByZWRpcmVjdCB3aXRoIG5ldyBzZXNzaW9uIGlkIGFuZCBvbGQgcGFyYW1zCiAgICAgICAgIyBwcmVwYXJlIG9sZCByZWRpcmVjdCBVUkwgLS0gZG8gbm90IHJlZGlyZWN0IHRvIExvZ2luIG9yIExvZ291dCAobG9vcCkhCiAgICAgICAgaWYgKCAkUGFyYW17UmVxdWVzdGVkVVJMfSA9fiAvQWN0aW9uPShMb2dvdXR8TG9naW58TG9zdFBhc3N3b3JkfFByZUxvZ2luKS8gKSB7CiAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJyc7CiAgICAgICAgfQoKICAgICAgICAjIHJlZGlyZWN0IHdpdGggbmV3IHNlc3Npb24gaWQKICAgICAgICBwcmludCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPlJlZGlyZWN0KAogICAgICAgICAgICBPUCAgICA9PiAkUGFyYW17UmVxdWVzdGVkVVJMfSwKICAgICAgICAgICAgTG9naW4gPT4gMSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgbG9nb3V0CiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdMb2dvdXQnICkgewoKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIGNoZWNrIHNlc3Npb24gaWQKICAgICAgICBpZiAoICEkU2Vzc2lvbk9iamVjdC0+Q2hlY2tTZXNzaW9uSUQoIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSApICkgewoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIj9SZWFzb249SW52YWxpZFNlc3Npb25JRCZSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luIHNjcmVlbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0xvZ291dCcsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgc2Vzc2lvbiBkYXRhCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSwKICAgICAgICApOwoKICAgICAgICAkVXNlckRhdGF7VXNlclRpbWVab25lfSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVVc2VyRGF0YSk7CgogICAgICAgICMgY3JlYXRlIGEgbmV3IExheW91dE9iamVjdCB3aXRoICVVc2VyRGF0YQogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgIFNldENvb2tpZXMgPT4gewogICAgICAgICAgICAgICAgICAgIFNlc3Npb25JRENvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICctMXknLAogICAgICAgICAgICAgICAgICAgICAgICBQYXRoICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NjcmlwdEFsaWFzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+IHNjYWxhciAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdHNEaXNjYXJkKCBPYmplY3RzID0+IFsnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCddICk7CiAgICAgICAgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgIyBQcmV2ZW50IENTUkYgYXR0YWNrcwogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgIyByZW1vdmUgc2Vzc2lvbiBpZAogICAgICAgIGlmICggISRTZXNzaW9uT2JqZWN0LT5SZW1vdmVTZXNzaW9uSUQoIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSApICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ0NhbmB0IHJlbW92ZSBTZXNzaW9uSUQuJyksCiAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ291dFVSTCcpICkgewogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvZ291dFVSTCcpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICAgICMgc2hvdyBsb2dvdXQgc2NyZWVuCiAgICAgICAgbXkgJExvZ291dE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ0xvZ291dCBzdWNjZXNzZnVsLicpOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dvdXQnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gJExvZ291dE1lc3NhZ2UsCiAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIHVzZXIgbG9zdCBwYXNzd29yZAogICAgZWxzaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnTG9zdFBhc3N3b3JkJyApIHsKCiAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgIyBjaGVjayBmZWF0dXJlCiAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdMb3N0UGFzc3dvcmQnKSApIHsKCiAgICAgICAgICAgICMgc2hvdyBub3JtYWwgbG9naW4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdGZWF0dXJlIG5vdCBhY3RpdmUhJyksCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgIG15ICRVc2VyICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdVc2VyJyApICB8fCAnJzsKICAgICAgICBteSAkVG9rZW4gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVG9rZW4nICkgfHwgJyc7CgogICAgICAgICMgZ2V0IHVzZXIgbG9naW4gYnkgdG9rZW4KICAgICAgICBpZiAoICEkVXNlciAmJiAkVG9rZW4gKSB7CgogICAgICAgICAgICAjIFByZXZlbnQgZXh0cmFjdGluZyBwYXNzd29yZCByZXNldCB0b2tlbiBjaGFyYWN0ZXItYnktY2hhcmFjdGVyIHZpYSB3aWxkY2FyZCBpbmplY3Rpb24KICAgICAgICAgICAgIyBUaGUgd2lsZCBjYXJkIGNoYXJhY3RlcnMgIiUiIGFuZCAiXyIgY291bGQgYmUgdXNlZCB0byBtYXRjaCBhcmJpdHJhcnkgY2hhcmFjdGVyLgogICAgICAgICAgICBpZiAoICRUb2tlbiAhfiBte1xBICg/OiBbYS16QS1aXSB8IFxkICkrIFx6fXhtcyApIHsKCiAgICAgICAgICAgICAgICAjIFNlY3VyaXR5OiBwcmV0ZW5kIHRoYXQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zIHdlcmUgYWN0dWFsbHkgc2VudCB0bwogICAgICAgICAgICAgICAgIyAgIG1ha2Ugc3VyZSB0aGF0IHVzZXJzIGNhbm5vdCBmaW5kIG91dCB2YWxpZCB1c2VybmFtZXMgYnkKICAgICAgICAgICAgICAgICMgICBqdXN0IHRyeWluZyBhbmQgY2hlY2tpbmcgdGhlIHJlc3VsdCBtZXNzYWdlLgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdTZW50IHBhc3N3b3JkIHJlc2V0IGluc3RydWN0aW9ucy4gUGxlYXNlIGNoZWNrIHlvdXIgZW1haWwuJyksCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAlVXNlckxpc3QgPSAkVXNlck9iamVjdC0+U2VhcmNoUHJlZmVyZW5jZXMoCiAgICAgICAgICAgICAgICBLZXkgICA9PiAnVXNlclRva2VuJywKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRUb2tlbiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgVVNFUlM6CiAgICAgICAgICAgIGZvciBteSAkVXNlcklEICggc29ydCBrZXlzICVVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgIG15ICVVc2VyRGF0YSA9ICRVc2VyT2JqZWN0LT5HZXRVc2VyRGF0YSgKICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFVzZXJJRCwKICAgICAgICAgICAgICAgICAgICBWYWxpZCAgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoJVVzZXJEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSAkVXNlckRhdGF7VXNlckxvZ2lufTsKICAgICAgICAgICAgICAgICAgICBsYXN0IFVTRVJTOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkVXNlck9iamVjdC0+R2V0VXNlckRhdGEoCiAgICAgICAgICAgIFVzZXIgID0+ICRVc2VyLAogICAgICAgICAgICBWYWxpZCA9PiAxCiAgICAgICAgKTsKCiAgICAgICAgIyB2ZXJpZnkgdXNlciBpcyB2YWxpZCB3aGVuIHJlcXVlc3RpbmcgcGFzc3dvcmQgcmVzZXQKICAgICAgICBteSBAVmFsaWRJRHMgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKS0+VmFsaWRJRHNHZXQoKTsKICAgICAgICBteSAkVXNlcklzVmFsaWQgPSBncmVwIHsgJFVzZXJEYXRhe1ZhbGlkSUR9ICYmICRVc2VyRGF0YXtWYWxpZElEfSA9PSAkXyB9IEBWYWxpZElEczsKICAgICAgICBpZiAoICEkVXNlckRhdGF7VXNlcklEfSB8fCAhJFVzZXJJc1ZhbGlkICkgewoKICAgICAgICAgICAgIyBTZWN1cml0eTogcHJldGVuZCB0aGF0IHBhc3N3b3JkIHJlc2V0IGluc3RydWN0aW9ucyB3ZXJlIGFjdHVhbGx5IHNlbnQgdG8KICAgICAgICAgICAgIyAgIG1ha2Ugc3VyZSB0aGF0IHVzZXJzIGNhbm5vdCBmaW5kIG91dCB2YWxpZCB1c2VybmFtZXMgYnkKICAgICAgICAgICAgIyAgIGp1c3QgdHJ5aW5nIGFuZCBjaGVja2luZyB0aGUgcmVzdWx0IG1lc3NhZ2UuCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+IFRyYW5zbGF0YWJsZSgnU2VudCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicpLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGNyZWF0ZSBlbWFpbCBvYmplY3QKICAgICAgICBteSAkRW1haWxPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW1haWwnKTsKCiAgICAgICAgIyBzZW5kIHBhc3N3b3JkIHJlc2V0IHRva2VuCiAgICAgICAgaWYgKCAhJFRva2VuICkgewoKICAgICAgICAgICAgIyBnZW5lcmF0ZSB0b2tlbgogICAgICAgICAgICAkVXNlckRhdGF7VG9rZW59ID0gJFVzZXJPYmplY3QtPlRva2VuR2VuZXJhdGUoCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNlbmQgdG9rZW4gbm90aWZ5IGVtYWlsIHdpdGggbGluawogICAgICAgICAgICBteSAkQm9keSA9ICRDb25maWdPYmplY3QtPkdldCgnTm90aWZpY2F0aW9uQm9keUxvc3RQYXNzd29yZFRva2VuJykKICAgICAgICAgICAgICAgIHx8ICdFUlJPUjogTm90aWZpY2F0aW9uQm9keUxvc3RQYXNzd29yZFRva2VuIGlzIG1pc3NpbmchJzsKICAgICAgICAgICAgbXkgJFN1YmplY3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ05vdGlmaWNhdGlvblN1YmplY3RMb3N0UGFzc3dvcmRUb2tlbicpCiAgICAgICAgICAgICAgICB8fCAnRVJST1I6IE5vdGlmaWNhdGlvblN1YmplY3RMb3N0UGFzc3dvcmRUb2tlbiBpcyBtaXNzaW5nISc7CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVVc2VyRGF0YSApIHsKICAgICAgICAgICAgICAgICRCb2R5ID1+IHMvPE9UUlNfJEtleT4vJFVzZXJEYXRheyRLZXl9L2dpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG15ICRTZW50ID0gJEVtYWlsT2JqZWN0LT5TZW5kKAogICAgICAgICAgICAgICAgVG8gICAgICAgPT4gJFVzZXJEYXRhe1VzZXJFbWFpbH0sCiAgICAgICAgICAgICAgICBTdWJqZWN0ICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgICAgIENoYXJzZXQgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgICAgICAgICBNaW1lVHlwZSA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICBCb2R5ICAgICA9PiAkQm9keQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkU2VudC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+IFRyYW5zbGF0YWJsZSgnU2VudCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicpLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICAgICMgcmVzZXQgcGFzc3dvcmQKICAgICAgICAjIGNoZWNrIGlmIHRva2VuIGlzIHZhbGlkCiAgICAgICAgbXkgJFRva2VuVmFsaWQgPSAkVXNlck9iamVjdC0+VG9rZW5DaGVjaygKICAgICAgICAgICAgVG9rZW4gID0+ICRUb2tlbiwKICAgICAgICAgICAgVXNlcklEID0+ICRVc2VyRGF0YXtVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFRva2VuVmFsaWQgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+IFRyYW5zbGF0YWJsZSgnSW52YWxpZCBUb2tlbiEnKSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IG5ldyBwYXNzd29yZAogICAgICAgICRVc2VyRGF0YXtOZXdQV30gPSAkVXNlck9iamVjdC0+R2VuZXJhdGVSYW5kb21QYXNzd29yZCgpOwoKICAgICAgICAjIHVwZGF0ZSBuZXcgcGFzc3dvcmQKICAgICAgICAkVXNlck9iamVjdC0+U2V0UGFzc3dvcmQoCiAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkVXNlciwKICAgICAgICAgICAgUFcgICAgICAgID0+ICRVc2VyRGF0YXtOZXdQV30KICAgICAgICApOwoKICAgICAgICAjIHNlbmQgbm90aWZ5IGVtYWlsCiAgICAgICAgbXkgJEJvZHkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ05vdGlmaWNhdGlvbkJvZHlMb3N0UGFzc3dvcmQnKQogICAgICAgICAgICB8fCAnTmV3IFBhc3N3b3JkIGlzOiA8T1RSU19ORVdQVz4nOwogICAgICAgIG15ICRTdWJqZWN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdOb3RpZmljYXRpb25TdWJqZWN0TG9zdFBhc3N3b3JkJykKICAgICAgICAgICAgfHwgJ05ldyBQYXNzd29yZCEnOwogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVVc2VyRGF0YSApIHsKICAgICAgICAgICAgJEJvZHkgPX4gcy88T1RSU18kS2V5Pi8kVXNlckRhdGF7JEtleX0vZ2k7CiAgICAgICAgfQogICAgICAgIG15ICRTZW50ID0gJEVtYWlsT2JqZWN0LT5TZW5kKAogICAgICAgICAgICBUbyAgICAgICA9PiAkVXNlckRhdGF7VXNlckVtYWlsfSwKICAgICAgICAgICAgU3ViamVjdCAgPT4gJFN1YmplY3QsCiAgICAgICAgICAgIENoYXJzZXQgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgICAgIE1pbWVUeXBlID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgQm9keSAgICAgPT4gJEJvZHkKICAgICAgICApOwoKICAgICAgICBpZiAoICEkU2VudC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIG15ICRNZXNzYWdlID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAnU2VudCBuZXcgcGFzc3dvcmQgdG8gJXMuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsLicsCiAgICAgICAgICAgICRVc2VyRGF0YXtVc2VyRW1haWx9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICBVc2VyICAgICAgICA9PiAkVXNlciwKICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgc2hvdyBsb2dpbiBzaXRlCiAgICBlbHNpZiAoICEkUGFyYW17U2Vzc2lvbklEfSApIHsKCiAgICAgICAgIyBjcmVhdGUgQXV0aE9iamVjdAogICAgICAgIG15ICRBdXRoT2JqZWN0ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6QXV0aCcpOwogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgaWYgKCAkQXV0aE9iamVjdC0+R2V0T3B0aW9uKCBXaGF0ID0+ICdQcmVBdXRoJyApICkgewoKICAgICAgICAgICAgIyBhdXRvbWF0aWMgbG9naW4KICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+ICJBY3Rpb249UHJlTG9naW4mUmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRDb25maWdPYmplY3QtPkdldCgnTG9naW5VUkwnKSApIHsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgLiAiP1JlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgbG9naW4gc2NyZWVuCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+TG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgcnVuIG1vZHVsZXMgaWYgYSB2ZXJzaW9uIHZhbHVlIGV4aXN0cwogICAgZWxzaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCJLZXJuZWw6Ok1vZHVsZXM6OiRQYXJhbXtBY3Rpb259IikgKSB7CgogICAgICAgICMgY2hlY2sgc2Vzc2lvbiBpZAogICAgICAgIGlmICggISRTZXNzaW9uT2JqZWN0LT5DaGVja1Nlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CgogICAgICAgICAgICAjIHB1dCAnJVBhcmFtJyBpbnRvIExheW91dE9iamVjdAogICAgICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgICAgIFNldENvb2tpZXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBTZXNzaW9uSURDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAnLTF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyZSAgID0+IHNjYWxhciAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSFRUUE9ubHkgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0c0Rpc2NhcmQoIE9iamVjdHMgPT4gWydLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0J10gKTsKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgY3JlYXRlIEF1dGhPYmplY3QKICAgICAgICAgICAgbXkgJEF1dGhPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6QXV0aCcpOwogICAgICAgICAgICBpZiAoICRBdXRoT2JqZWN0LT5HZXRPcHRpb24oIFdoYXQgPT4gJ1ByZUF1dGgnICkgKSB7CgogICAgICAgICAgICAgICAgIyBhdXRvbWF0aWMgcmUtbG9naW4KICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIE9QID0+ICI/QWN0aW9uPVByZUxvZ2luJlJlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpICkgewoKICAgICAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIj9SZWFzb249SW52YWxpZFNlc3Npb25JRCZSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5Mb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkU2Vzc2lvbk9iamVjdC0+U2Vzc2lvbklERXJyb3JNZXNzYWdlKCkgKSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHNlc3Npb24gZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRTZXNzaW9uT2JqZWN0LT5HZXRTZXNzaW9uSUREYXRhKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0sCiAgICAgICAgKTsKCiAgICAgICAgJFVzZXJEYXRhe1VzZXJUaW1lWm9uZX0gPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglVXNlckRhdGEpOwoKICAgICAgICAjIGNoZWNrIG5lZWRlZCBkYXRhCiAgICAgICAgaWYgKCAhJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRVc2VyRGF0YXtVc2VyTG9naW59IHx8ICRVc2VyRGF0YXtVc2VyVHlwZX0gbmUgJ1VzZXInICkgewoKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdMb2dpblVSTCcpICkgewogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnTG9naW5VUkwnKSAuICc/UmVhc29uPVN5c3RlbUVycm9yJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyBsb2dpbiBzY3JlZW4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gVHJhbnNsYXRhYmxlKCdFcnJvcjogaW52YWxpZCBzZXNzaW9uLicpLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBtb2R1bGUgcmVnaXN0cnkKICAgICAgICBteSAkTW9kdWxlUmVnID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPnsgJFBhcmFte0FjdGlvbn0gfTsKICAgICAgICBpZiAoICEkTW9kdWxlUmVnICkgewoKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJNb2R1bGUgS2VybmVsOjpNb2R1bGVzOjokUGFyYW17QWN0aW9ufSBub3QgcmVnaXN0ZXJlZCBpbiBLZXJuZWwvQ29uZmlnLnBtISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBtb2R1bGUgcGVybWlzc29uIGNoZWNrCiAgICAgICAgaWYgKAogICAgICAgICAgICByZWYgJE1vZHVsZVJlZy0+e0dyb3VwUm99IGVxICdBUlJBWScKICAgICAgICAgICAgJiYgIXNjYWxhciBAeyAkTW9kdWxlUmVnLT57R3JvdXBSb30gfQogICAgICAgICAgICAmJiByZWYgJE1vZHVsZVJlZy0+e0dyb3VwfSBlcSAnQVJSQVknCiAgICAgICAgICAgICYmICFzY2FsYXIgQHsgJE1vZHVsZVJlZy0+e0dyb3VwfSB9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAxOwogICAgICAgICAgICAkUGFyYW17QWNjZXNzUnd9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG15ICRHcm91cE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpOwoKICAgICAgICAgICAgUEVSTUlTU0lPTjoKICAgICAgICAgICAgZm9yIG15ICRQZXJtaXNzaW9uIChxdyhHcm91cFJvIEdyb3VwKSkgewogICAgICAgICAgICAgICAgbXkgJEFjY2Vzc09rID0gMDsKICAgICAgICAgICAgICAgIG15ICRHcm91cCAgICA9ICRNb2R1bGVSZWctPnskUGVybWlzc2lvbn07CiAgICAgICAgICAgICAgICBuZXh0IFBFUk1JU1NJT04gaWYgISRHcm91cDsKICAgICAgICAgICAgICAgIGlmICggcmVmICRHcm91cCBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgICAgIElOTkVSOgogICAgICAgICAgICAgICAgICAgIGZvciBteSAkR3JvdXBOYW1lICggQHskR3JvdXB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IElOTkVSIGlmICEkR3JvdXBOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IElOTkVSIGlmICEkR3JvdXBPYmplY3QtPlBlcm1pc3Npb25DaGVjaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9PiAkR3JvdXBOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICRQZXJtaXNzaW9uIGVxICdHcm91cFJvJyA/ICdybycgOiAncncnLAoKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEFjY2Vzc09rID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCBJTk5FUjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBteSAkSGFzUGVybWlzc2lvbiA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkNoZWNrKAogICAgICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9PiAkR3JvdXAsCiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAkUGVybWlzc2lvbiBlcSAnR3JvdXBSbycgPyAncm8nIDogJ3J3JywKCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJEhhc1Blcm1pc3Npb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFjY2Vzc09rID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICRQZXJtaXNzaW9uIGVxICdHcm91cCcgJiYgJEFjY2Vzc09rICkgewogICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAxOwogICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSd30gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkUGVybWlzc2lvbiBlcSAnR3JvdXBSbycgJiYgJEFjY2Vzc09rICkgewogICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRQYXJhbXtBY2Nlc3NSb30gJiYgISRQYXJhbXtBY2Nlc3NSd30gfHwgISRQYXJhbXtBY2Nlc3NSb30gJiYgJFBhcmFte0FjY2Vzc1J3fSApIHsKCiAgICAgICAgICAgICAgICAjIHB1dCAnJVBhcmFtJyBhbmQgJyVVc2VyRGF0YScgaW50byBMYXlvdXRPYmplY3QKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRNb2R1bGVSZWcsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwcmludCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPk5vUGVybWlzc2lvbigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnTm8gUGVybWlzc2lvbiB0byB1c2UgdGhpcyBmcm9udGVuZCBtb2R1bGUhJykKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgcHV0ICclUGFyYW0nIGFuZCAnJVVzZXJEYXRhJyBpbnRvIExheW91dE9iamVjdAogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdHNEaXNjYXJkKCBPYmplY3RzID0+IFsnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCddICk7CgogICAgICAgICMgdXBkYXRlIGxhc3QgcmVxdWVzdCB0aW1lCiAgICAgICAgaWYgKCAhJFBhcmFtT2JqZWN0LT5Jc0FKQVhSZXF1ZXN0KCkgKSB7CiAgICAgICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSwKICAgICAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlckxhc3RSZXF1ZXN0JywKICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkRGF0ZVRpbWVPYmplY3QtPlRvRXBvY2goKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgT3ZlcnJpZGUgdXNlciBzZXR0aW5ncy4KICAgICAgICBteSAkSG9tZSA9ICRDb25maWdPYmplY3QtPkdldCgnSG9tZScpOwogICAgICAgIG15ICRGaWxlID0gIiRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvVXNlci8kVXNlckRhdGF7VXNlcklEfS5wbSI7CiAgICAgICAgaWYgKCAtZSAkRmlsZSApIHsKICAgICAgICAgICAgZXZhbCB7CiAgICAgICAgICAgICAgICBpZiAoIHJlcXVpcmUgJEZpbGUgKSB7CgogICAgICAgICAgICAgICAgICAgICMgUHJlcGFyZSBmaWxlLgogICAgICAgICAgICAgICAgICAgICRGaWxlID1+IHMvXFEkSG9tZVxFLy9nOwogICAgICAgICAgICAgICAgICAgICRGaWxlID1+IHMvXlwvLy9nOwogICAgICAgICAgICAgICAgICAgICRGaWxlID1+IHMvXC9cLy9cLy9nOwogICAgICAgICAgICAgICAgICAgICRGaWxlID1+IHMvXC8vOjovZzsKICAgICAgICAgICAgICAgICAgICAkRmlsZSA9fiBzL1wucG0kLy9nOwogICAgICAgICAgICAgICAgICAgICRGaWxlLT5Mb2FkKCRDb25maWdPYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGllICJDYW5ub3QgbG9hZCBmaWxlICRGaWxlOiAkIVxuIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICMgTG9nIGVycm9yIGFuZCBjb250aW51ZS4KICAgICAgICAgICAgaWYgKCRAKSB7CiAgICAgICAgICAgICAgICBteSAkRXJyb3JNZXNzYWdlID0gJEA7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRFcnJvck1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHByZSBhcHBsaWNhdGlvbiBtb2R1bGUKICAgICAgICBteSAkUHJlTW9kdWxlID0gJENvbmZpZ09iamVjdC0+R2V0KCdQcmVBcHBsaWNhdGlvbk1vZHVsZScpOwogICAgICAgIGlmICgkUHJlTW9kdWxlKSB7CiAgICAgICAgICAgIG15ICVQcmVNb2R1bGVMaXN0OwogICAgICAgICAgICBpZiAoIHJlZiAkUHJlTW9kdWxlIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgICVQcmVNb2R1bGVMaXN0ID0gJXskUHJlTW9kdWxlfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQcmVNb2R1bGVMaXN0e0luaXR9ID0gJFByZU1vZHVsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTU9EVUxFOgogICAgICAgICAgICBmb3IgbXkgJFByZU1vZHVsZUtleSAoIHNvcnQga2V5cyAlUHJlTW9kdWxlTGlzdCApIHsKICAgICAgICAgICAgICAgIG15ICRQcmVNb2R1bGUgPSAkUHJlTW9kdWxlTGlzdHskUHJlTW9kdWxlS2V5fTsKICAgICAgICAgICAgICAgIG5leHQgTU9EVUxFIGlmICEkUHJlTW9kdWxlOwogICAgICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoJFByZU1vZHVsZSk7CgogICAgICAgICAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiUHJlQXBwbGljYXRpb24gbW9kdWxlICRQcmVNb2R1bGUgaXMgdXNlZC4iLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICAgICAjIHVzZSBtb2R1bGUKICAgICAgICAgICAgICAgIG15ICRQcmVNb2R1bGVPYmplY3QgPSAkUHJlTW9kdWxlLT5uZXcoCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgICAgICAgICBNb2R1bGVSZWcgPT4gJE1vZHVsZVJlZywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJFByZU1vZHVsZU9iamVjdC0+UHJlUnVuKCk7CiAgICAgICAgICAgICAgICBpZiAoJE91dHB1dCkgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KCBPdXRwdXQgPT4gXCRPdXRwdXQgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259IC4gJy0+bmV3JywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRGcm9udGVuZE9iamVjdCA9ICggJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259ICktPm5ldygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICBEZWJ1ZyAgICAgPT4gJFNlbGYtPntEZWJ1Z30sCiAgICAgICAgKTsKCiAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259IC4gJy0+cnVuJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgLT5SdW4gJEFjdGlvbiB3aXRoICRGcm9udGVuZE9iamVjdAogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+UHJpbnQoIE91dHB1dCA9PiBcJEZyb250ZW5kT2JqZWN0LT5SdW4oKSApOwoKICAgICAgICAjIGxvZyByZXF1ZXN0IHRpbWUKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnUGVyZm9ybWFuY2VMb2cnKSApIHsKICAgICAgICAgICAgaWYgKCAoICEkUXVlcnlTdHJpbmcgJiYgJFBhcmFte0FjdGlvbn0gKSB8fCAkUXVlcnlTdHJpbmcgIX4gL0FjdGlvbj0vICkgewogICAgICAgICAgICAgICAgJFF1ZXJ5U3RyaW5nID0gJ0FjdGlvbj0nIC4gJFBhcmFte0FjdGlvbn0gLiAnJlN1YmFjdGlvbj0nIC4gJFBhcmFte1N1YmFjdGlvbn07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbXkgJEZpbGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BlcmZvcm1hbmNlTG9nOjpGaWxlJyk7CgogICAgICAgICAgICAjIFdyaXRlIHRvIFBlcmZvcm1hbmNlTG9nIGZpbGUgb25seSBpZiBpdCBpcyBzbWFsbGVyIHRoYW4gc2l6ZSBsaW1pdCAoc2VlIGJ1ZyMxNDc0NykuCiAgICAgICAgICAgIGlmICggLXMgJEZpbGUgPCAoIDEwMjQgKiAxMDI0ICogJENvbmZpZ09iamVjdC0+R2V0KCdQZXJmb3JtYW5jZUxvZzo6RmlsZU1heCcpICkgKSB7CgogICAgICAgICAgICAgICAgIyMgbm8gY3JpdGljCiAgICAgICAgICAgICAgICBpZiAoIG9wZW4gbXkgJE91dCwgJz4+JywgJEZpbGUgKSB7CiAgICAgICAgICAgICAgICAgICAgIyMgdXNlIGNyaXRpYwogICAgICAgICAgICAgICAgICAgIHByaW50ICRPdXQgdGltZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJzo6QWdlbnQ6OicKICAgICAgICAgICAgICAgICAgICAgICAgLiAoIHRpbWUoKSAtICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gKQogICAgICAgICAgICAgICAgICAgICAgICAuICI6OiRVc2VyRGF0YXtVc2VyTG9naW59OjokUXVlcnlTdHJpbmdcbiI7CiAgICAgICAgICAgICAgICAgICAgY2xvc2UgJE91dDsKCiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJSZXNwb25zZTo6QWdlbnQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gKCB0aW1lKCkgLSAkU2VsZi0+e1BlcmZvcm1hbmNlTG9nU3RhcnR9ICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gInMgdGFrZW4gKFVSTDokUXVlcnlTdHJpbmc6JFVzZXJEYXRhe1VzZXJMb2dpbn0pIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCB3cml0ZSAkRmlsZTogJCEiLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gIlBlcmZvcm1hbmNlTG9nIGZpbGUgJyRGaWxlJyBpcyB0b28gbGFyZ2UsIHlvdSBuZWVkIHRvIHJlc2V0IGl0IGluIFBlcmZvcm1hbmNlTG9nIHBhZ2UhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBwcmludCBhbiBlcnJvciBzY3JlZW4KICAgIG15ICVEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoCiAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgKTsKICAgICREYXRhe1VzZXJUaW1lWm9uZX0gPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglRGF0YSk7CiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAlRGF0YSwKICAgICAgICB9LAogICAgKTsKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+RmF0YWxFcnJvcigKICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICApOwogICAgcmV0dXJuOwp9Cgo9YmVnaW4gSW50ZXJuYWw6Cgo9aGVhZDIgX1VzZXJUaW1lWm9uZUdldCgpCgpHZXQgdGltZSB6b25lIGZvciB0aGUgY3VycmVudCB1c2VyLiBUaGlzIGZ1bmN0aW9uIHdpbGwgdmFsaWRhdGUgcGFzc2VkIHRpbWUgem9uZSBwYXJhbWV0ZXIgYW5kIHJldHVybiBkZWZhdWx0IHVzZXIgdGltZQp6b25lIGlmIGl0J3Mgbm90IHZhbGlkLgoKICAgIG15ICRVc2VyVGltZVpvbmUgPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCgKICAgICAgICBVc2VyVGltZVpvbmUgPT4gJ0V1cm9wZS9CZXJsaW4nLAogICAgKTsKCj1jdXQKCnN1YiBfVXNlclRpbWVab25lR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFVzZXJUaW1lWm9uZTsKCiAgICAjIFJldHVybiBwYXNzZWQgdGltZSB6b25lIG9ubHkgaWYgaXQncyB2YWxpZC4gSXQgY2FuIGhhcHBlbiB0aGF0IHVzZXIgcHJlZmVyZW5jZXMgb3Igc2Vzc2lvbiBzdG9yZSBhbiBvbGQtc3R5bGUKICAgICMgICBvZmZzZXQgd2hpY2ggaXMgbm90IHZhbGlkIGFueW1vcmUuIEluIHRoaXMgY2FzZSwgcmV0dXJuIHRoZSBkZWZhdWx0IHZhbHVlLgogICAgIyAgIFBsZWFzZSBzZWUgYnVnIzEzMzc0IGZvciBtb3JlIGluZm9ybWF0aW9uLgogICAgaWYgKAogICAgICAgICRQYXJhbXtVc2VyVGltZVpvbmV9CiAgICAgICAgJiYgS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lLT5Jc1RpbWVab25lVmFsaWQoIFRpbWVab25lID0+ICRQYXJhbXtVc2VyVGltZVpvbmV9ICkKICAgICAgICApCiAgICB7CiAgICAgICAgJFVzZXJUaW1lWm9uZSA9ICRQYXJhbXtVc2VyVGltZVpvbmV9OwogICAgfQoKICAgICRVc2VyVGltZVpvbmUgfHw9IEtlcm5lbDo6U3lzdGVtOjpEYXRlVGltZS0+VXNlckRlZmF1bHRUaW1lWm9uZUdldCgpOwoKICAgIHJldHVybiAkVXNlclRpbWVab25lOwp9Cgo9ZW5kIEludGVybmFsOgoKPWN1dAoKc3ViIERFU1RST1kgewogICAgbXkgJFNlbGYgPSBzaGlmdDsKCiAgICAjIGRlYnVnIGluZm8KICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdHbG9iYWwgaGFuZGxlIHN0b3BwZWQuJywKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAxOwp9CgoxOwoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwczovL290cnMub3JnLz4pLgoKVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQ+LgoKPWN1dAo=</File>
        <File Location="Custom/Kernel/System/Web/InterfaceCustomer.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxIFpudW55IEdtYkgsIGh0dHBzOi8vem51bnkub3JnLwojIENvcHlyaWdodCAoQykgMjAyMyBtby1hemZhcixodHRwczovL2dpdGh1Yi5jb20vbW8tYXpmYXIKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXI7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lOwp1c2UgS2VybmVsOjpTeXN0ZW06OkVtYWlsOwp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoSXNBcnJheVJlZldpdGhEYXRhIElzSGFzaFJlZldpdGhEYXRhKTsKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckF1dGgnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6REInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycsCiAgICAnS2VybmVsOjpTeXN0ZW06Ok1haW4nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpTY2hlZHVsZXInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcsCiAgICAnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcsCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXIgLSB0aGUgY3VzdG9tZXIgd2ViIGludGVyZmFjZQoKPWhlYWQxIERFU0NSSVBUSU9OCgp0aGUgZ2xvYmFsIGN1c3RvbWVyIHdlYiBpbnRlcmZhY2UgKGF1dGhlbnRpY2F0aW9uLCBzZXNzaW9uIGhhbmRsaW5nLCAuLi4pCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPWhlYWQyIG5ldygpCgpjcmVhdGUgY3VzdG9tZXIgd2ViIGludGVyZmFjZSBvYmplY3QKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06OldlYjo6SW50ZXJmYWNlQ3VzdG9tZXI7CgogICAgbXkgJERlYnVnID0gMDsKICAgIG15ICRJbnRlcmZhY2VDdXN0b21lciA9IEtlcm5lbDo6U3lzdGVtOjpXZWI6OkludGVyZmFjZUN1c3RvbWVyLT5uZXcoCiAgICAgICAgRGVidWcgICAgICA9PiAkRGVidWcsCiAgICAgICAgV2ViUmVxdWVzdCA9PiBDR0k6OkZhc3QtPm5ldygpLCAjIG9wdGlvbmFsLCBlLiBnLiBpZiBmYXN0IGNnaSBpcyB1c2VkLCB0aGUgQ0dJIG9iamVjdCBpcyBhbHJlYWR5IHByb3ZpZGVkCiAgICApOwoKPWN1dAoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7fTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjIGdldCBkZWJ1ZyBsZXZlbAogICAgJFNlbGYtPntEZWJ1Z30gPSAkUGFyYW17RGVidWd9IHx8IDA7CgogICAgIyBwZXJmb3JtYW5jZSBsb2cKICAgICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gPSB0aW1lKCk7CgogICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJyA9PiB7CiAgICAgICAgICAgIExvZ1ByZWZpeCA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0NHSUxvZ1ByZWZpeCcpLAogICAgICAgIH0sCiAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnID0+IHsKICAgICAgICAgICAgV2ViUmVxdWVzdCA9PiAkUGFyYW17V2ViUmVxdWVzdH0gfHwgMCwKICAgICAgICB9LAogICAgKTsKCiAgICAjIGRlYnVnIGluZm8KICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdkZWJ1ZycsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdHbG9iYWwgaGFuZGxlIHN0YXJ0ZWQuLi4nLAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aGVhZDIgUnVuKCkKCmV4ZWN1dGUgdGhlIG9iamVjdAoKICAgICRJbnRlcmZhY2VDdXN0b21lci0+UnVuKCk7Cgo9Y3V0CgpzdWIgUnVuIHsKICAgIG15ICRTZWxmID0gc2hpZnQ7CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJFF1ZXJ5U3RyaW5nID0gJEVOVntRVUVSWV9TVFJJTkd9IHx8ICcnOwoKICAgICMgQ2hlY2sgaWYgaHR0cHMgZm9yY2luZyBpcyBhY3RpdmUsIGFuZCByZWRpcmVjdCBpZiBuZWVkZWQuCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSFRUUFNGb3JjZVJlZGlyZWN0JykgKSB7CgogICAgICAgICMgU29tZSB3ZWIgc2VydmVycyBkbyBub3Qgc2V0IEhUVFBTIGVudmlyb25tZW50IHZhcmlhYmxlLCBzbyBpdCdzIG5vdCBwb3NzaWJsZSB0byBlYXNpbHkga25vdyBpZiB3ZSBhcmUgdXNpbmcKICAgICAgICAjICAgaHR0cHMgcHJvdG9jb2wuIExvb2sgYWxzbyBmb3Igc2ltaWxhcmx5IG5hbWVkIGtleXMgaW4gZW52aXJvbm1lbnQgaGFzaCwgc2luY2UgdGhpcyBzaG91bGQgcHJldmVudCBsb29wcyBpbgogICAgICAgICMgICBjZXJ0YWluIGNhc2VzLgogICAgICAgIGlmICgKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgIWRlZmluZWQgJEVOVntIVFRQU30KICAgICAgICAgICAgICAgICYmICFncmVwIHsvXkhUVFBTKD86X3wkKS99IGtleXMgJUVOVgogICAgICAgICAgICApCiAgICAgICAgICAgIHx8ICRFTlZ7SFRUUFN9IG5lICdvbicKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbXkgJEhvc3QgPSAkRU5We0hUVFBfSE9TVH0gfHwgJENvbmZpZ09iamVjdC0+R2V0KCdGUUROJyk7CgogICAgICAgICAgICAjIFJlZGlyZWN0IHdpdGggMzAxIGNvZGUuIEFkZCB0d28gbmV3IGxpbmVzIGF0IHRoZSBlbmQsIHNvIEhUVFAgaGVhZGVycyBhcmUgdmFsaWRhdGVkIGNvcnJlY3RseS4KICAgICAgICAgICAgcHJpbnQgIlN0YXR1czogMzAxIE1vdmVkIFBlcm1hbmVudGx5XG5Mb2NhdGlvbjogaHR0cHM6Ly8kSG9zdCRFTlZ7UkVRVUVTVF9VUkl9XG5cbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIG15ICVQYXJhbTsKCiAgICAjIGdldCBzZXNzaW9uIGlkCiAgICAkUGFyYW17U2Vzc2lvbk5hbWV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsU2Vzc2lvbk5hbWUnKSAgICAgICAgIHx8ICdDU0lEJzsKICAgICRQYXJhbXtTZXNzaW9uSUR9ICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9ICkgfHwgJyc7CgogICAgIyBkcm9wIG9sZCBzZXNzaW9uIGlkIChpZiBleGlzdHMpCiAgICAkUXVlcnlTdHJpbmcgPX4gcy8oXD98Jnw7fCkkUGFyYW17U2Vzc2lvbk5hbWV9KD0mfD07fD0uKz8mfD0uKz8kKS87L2c7CgogICAgIyBkZWZpbmUgZnJhbWV3b3JrIHBhcmFtcwogICAgbXkgJEZyYW1ld29ya1BhcmFtcyA9IHsKICAgICAgICBMYW5nICAgICAgICAgPT4gJycsCiAgICAgICAgQWN0aW9uICAgICAgID0+ICcnLAogICAgICAgIFN1YmFjdGlvbiAgICA9PiAnJywKICAgICAgICBSZXF1ZXN0ZWRVUkwgPT4gJFF1ZXJ5U3RyaW5nLAogICAgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JEZyYW1ld29ya1BhcmFtc30gKSB7CiAgICAgICAgJFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApCiAgICAgICAgICAgIHx8ICRGcmFtZXdvcmtQYXJhbXMtPnskS2V5fTsKICAgIH0KCiAgICAjIHZhbGlkYXRlIGxhbmd1YWdlCiAgICBpZiAoICRQYXJhbXtMYW5nfSAmJiAkUGFyYW17TGFuZ30gIX4gbXtcQVthLXpdezJ9KD86X1tBLVpdezJ9KT9cen14bXMgKSB7CiAgICAgICAgZGVsZXRlICRQYXJhbXtMYW5nfTsKICAgIH0KCiAgICBteSAkQnJvd3Nlckhhc0Nvb2tpZSA9IDA7CgogICAgIyBDaGVjayBpZiB0aGUgYnJvd3NlciBzZW5kcyB0aGUgU2Vzc2lvbklEIGNvb2tpZSBhbmQgc2V0IHRoZSBTZXNzaW9uSUQtY29va2llCiAgICAjIGFzIFNlc3Npb25JRCEgR0VUIG9yIFBPU1QgU2Vzc2lvbklEIGhhdmUgdGhlIGxvd2VzdCBwcmlvcml0eS4KICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llJykgKSB7CiAgICAgICAgJFBhcmFte1Nlc3Npb25JRENvb2tpZX0gPSAkUGFyYW1PYmplY3QtPkdldENvb2tpZSggS2V5ID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0gKTsKICAgICAgICBpZiAoICRQYXJhbXtTZXNzaW9uSURDb29raWV9ICkgewogICAgICAgICAgICAkUGFyYW17U2Vzc2lvbklEfSA9ICRQYXJhbXtTZXNzaW9uSURDb29raWV9OwogICAgICAgIH0KICAgIH0KCiAgICBteSAkQ29va2llU2VjdXJlQXR0cmlidXRlOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0h0dHBUeXBlJykgZXEgJ2h0dHBzJyApIHsKCiAgICAgICAgIyBSZXN0cmljdCBDb29raWUgdG8gSFRUUFMgaWYgaXQgaXMgdXNlZC4KICAgICAgICAkQ29va2llU2VjdXJlQXR0cmlidXRlID0gMTsKICAgIH0KCiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgTGFuZyA9PiAkUGFyYW17TGFuZ30sCiAgICAgICAgfSwKICAgICAgICAnS2VybmVsOjpMYW5ndWFnZScgPT4gewogICAgICAgICAgICBVc2VyTGFuZ3VhZ2UgPT4gJFBhcmFte0xhbmd9LAogICAgICAgIH0sCiAgICApOwoKICAgIG15ICREQkNhbkNvbm5lY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+Q29ubmVjdCgpOwoKICAgIGlmICggISREQkNhbkNvbm5lY3QgfHwgJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgaWYgKCAhJERCQ2FuQ29ubmVjdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+Q3VzdG9tZXJGYXRhbEVycm9yKAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICggJFBhcmFtT2JqZWN0LT5FcnJvcigpICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRQYXJhbU9iamVjdC0+RXJyb3IoKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkVXNlck9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKICAgIG15ICRTZXNzaW9uT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyk7CgogICAgIyBnZXQgY29tbW9uIGFwcGxpY2F0aW9uIGFuZCBhZGQgb24gYXBwbGljYXRpb24gcGFyYW1zCiAgICBteSAlQ29tbW9uT2JqZWN0UGFyYW0gPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6OkNvbW1vblBhcmFtJykgfTsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVDb21tb25PYmplY3RQYXJhbSApIHsKICAgICAgICAkUGFyYW17JEtleX0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkS2V5ICkgfHwgJENvbW1vbk9iamVjdFBhcmFteyRLZXl9OwogICAgfQoKICAgICMgc2VjdXJpdHkgY2hlY2sgQWN0aW9uIFBhcmFtIChyZXBsYWNlIG5vbi13b3JkIGNoYXJzKQogICAgJFBhcmFte0FjdGlvbn0gPX4gcy9cVy8vZzsKCiAgICAjIGNoZWNrIHJlcXVlc3QgdHlwZQogICAgaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnUHJlTG9naW4nICkgewogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgbG9naW4gc2NyZWVuCiAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICBNb2RlICA9PiAnUHJlTG9naW4nLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0xvZ2luJyApIHsKCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgbXkgJFBvc3RVc2VyID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1VzZXInICkgfHwgJyc7CiAgICAgICAgbXkgJFBvc3RQdyAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSgKICAgICAgICAgICAgUGFyYW0gPT4gJ1Bhc3N3b3JkJywKICAgICAgICAgICAgUmF3ICAgPT4gMQogICAgICAgICkgfHwgJyc7CiAgICAgICAgbXkgJFBvc3RUd29GYWN0b3JUb2tlbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oCiAgICAgICAgICAgIFBhcmFtID0+ICdUd29GYWN0b3JUb2tlbicsCiAgICAgICAgICAgIFJhdyAgID0+IDEKICAgICAgICApIHx8ICcnOwoKCQkjIC0tCgkJIyBDdXN0b21lciBHb29nbGUgQ2FwdGNoYQoJCSMgLS0KICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QnKS0+e1Nob3dHb29nbGVDYXB0Y2hhfS0+e1RlbXBsYXRlc30tPntDdXN0b21lckxvZ2lufSApCgkJewoJCQl1c2UgQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMjsKICAgICAgICAgICAgbXkgJHJjID0gQ2FwdGNoYTo6cmVDQVBUQ0hBOjpWMi0+bmV3OwogICAgICAgICAgICBteSAkU2VjcmV0S2V5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdHb29nbGVDYXB0Y2hhOjpTZWNyZXRLZXknKTsJCQkKICAgICAgICAgICAgbXkgJHJlc3BvbnNlID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbShQYXJhbSA9PiAnZy1yZWNhcHRjaGEtcmVzcG9uc2UnKSB8fCAnJzsKICAgICAgICAgICAgbXkgJHJlc3VsdCA9ICRyYy0+dmVyaWZ5KCRTZWNyZXRLZXksICRyZXNwb25zZSk7CiAgICAKICAgICAgICAgICAgaWYgKCAhJHJlc3VsdC0+e3N1Y2Nlc3N9ICkgCiAgICAgICAgICAgIHsKCQkJCSNteSAkY19lcnJvciA9ICRyZXN1bHQtPntlcnJvcl9jb2Rlc30tPlswXTsKCQkJCSMgc2hvdyBuZWVkIHVzZXIgZGF0YSBlcnJvciBtZXNzYWdlCgkJCQkkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPlByaW50KAoJCQkJCU91dHB1dCA9PiBcJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5Mb2dpbigKCQkJCQkJVGl0bGUgICA9PiAnTG9naW4nLAoJCQkJCQlNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgicmVDQVBUQ0hBIGVudHJ5IGZhaWxlZC4gJHJlc3VsdC0+e2Vycm9yX2NvZGVzfS0+WzBdIiksCgkJCQkJCU1lc3NhZ2VUeXBlID0+ICdFcnJvcicsCgkJCQkJKSwKCQkJCSk7CgkJCQoJCQkJcmV0dXJuOwogICAgICAgICAgICB9CgkJfSAKICAgICAgICAjIC0tCgkJCiAgICAgICAgIyBjcmVhdGUgQXV0aE9iamVjdAogICAgICAgIG15ICRBdXRoT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQXV0aCcpOwoKICAgICAgICAjIGNoZWNrIHN1Ym1pdHRlZCBkYXRhCiAgICAgICAgbXkgJFVzZXIgPSAkQXV0aE9iamVjdC0+QXV0aCgKICAgICAgICAgICAgVXNlciAgICAgICAgICAgPT4gJFBvc3RVc2VyLAogICAgICAgICAgICBQdyAgICAgICAgICAgICA9PiAkUG9zdFB3LAogICAgICAgICAgICBUd29GYWN0b3JUb2tlbiA9PiAkUG9zdFR3b0ZhY3RvclRva2VuLAogICAgICAgICk7CgogICAgICAgIG15ICRFeHBpcmVzID0gJysnIC4gJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uTWF4VGltZScpIC4gJ3MnOwogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZUFmdGVyQnJvd3NlckNsb3NlJykgKSB7CiAgICAgICAgICAgICRFeHBpcmVzID0gJyc7CiAgICAgICAgfQoKICAgICAgICAjIGxvZ2luIGlzIGludmFsaWQKICAgICAgICBpZiAoICEkVXNlciApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgT1RSU0Jyb3dzZXJIYXNDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAnT1RSU0Jyb3dzZXJIYXNDb29raWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICRFeHBpcmVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUVFBPbmx5ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpICkgewogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAgICAgLiAiP1JlYXNvbj1Mb2dpbkZhaWxlZDtSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICdJbmZvJywKICAgICAgICAgICAgICAgICAgICAgICAgV2hhdCA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgJEF1dGhPYmplY3QtPkdldExhc3RFcnJvck1lc3NhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICB8fCBUcmFuc2xhdGFibGUoJ0xvZ2luIGZhaWxlZCEgWW91ciB1c2VyIG5hbWUgb3IgcGFzc3dvcmQgd2FzIGVudGVyZWQgaW5jb3JyZWN0bHkuJyksCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICAgICAgPT4gJFBvc3RVc2VyLAogICAgICAgICAgICAgICAgICAgIExvZ2luRmFpbGVkID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBpcyBzdWNjZXNzZnVsCiAgICAgICAgbXkgJVVzZXJEYXRhID0gJFVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgID0+ICRVc2VyLAogICAgICAgICAgICBWYWxpZCA9PiAxCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBjb29raWVzCiAgICAgICAgaWYgKCAkUGFyYW1PYmplY3QtPkdldENvb2tpZSggS2V5ID0+ICdPVFJTQnJvd3Nlckhhc0Nvb2tpZScgKSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICBCcm93c2VySGFzQ29va2llID0+IDEsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBuZWVkZWQgZGF0YQogICAgICAgIGlmICggISRVc2VyRGF0YXtVc2VySUR9IHx8ICEkVXNlckRhdGF7VXNlckxvZ2lufSApIHsKCiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKQogICAgICAgICAgICAgICAgICAgICAgICAuICc/UmVhc29uPVN5c3RlbUVycm9yJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyBuZWVkIHVzZXIgZGF0YSBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhlbnRpY2F0aW9uIHN1Y2NlZWRlZCwgYnV0IG5vIGN1c3RvbWVyIHJlY29yZCBpcyBmb3VuZCBpbiB0aGUgY3VzdG9tZXIgYmFja2VuZC4gUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJwogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgZGF0ZXRpbWUgb2JqZWN0CiAgICAgICAgbXkgJFNlc3Npb25EVE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICAjIFJlbW92ZSBjZXJ0YWluIHVzZXIgYXR0cmlidXRlcyB0aGF0IGFyZSBub3QgbmVlZGVkIHRvIGJlIHN0b3JlZCBpbiB0aGUgc2Vzc2lvbi4KICAgICAgICAjICAgLSBTTUlNRSBDZXJ0aWZpY2F0ZSBjb3VsZCBiZSBpbiBiaW5hcnkgZm9ybWF0LCBpZiBzZXNzaW9uIGJhY2tlbmQgaW4gREIgKGRlZmF1bHQpCiAgICAgICAgIyAgIGl0IHdvbnQgYmUgcG9zc2libGUgdG8gYmUgc2F2ZWQgaW4gY2VydGFpbiBkYXRhYmFzZXMgKHNlZSBidWcjMTQ0MDUpLgogICAgICAgIG15ICVVc2VyU2Vzc2lvbkRhdGEgPSAlVXNlckRhdGE7CiAgICAgICAgZGVsZXRlICRVc2VyU2Vzc2lvbkRhdGF7VXNlclNNSU1FQ2VydGlmaWNhdGV9OwoKICAgICAgICAjIGNyZWF0ZSBuZXcgc2Vzc2lvbiBpZAogICAgICAgIG15ICROZXdTZXNzaW9uSUQgPSAkU2Vzc2lvbk9iamVjdC0+Q3JlYXRlU2Vzc2lvbklEKAogICAgICAgICAgICAlVXNlclNlc3Npb25EYXRhLAogICAgICAgICAgICBVc2VyTGFzdFJlcXVlc3QgPT4gJFNlc3Npb25EVE9iamVjdC0+VG9FcG9jaCgpLAogICAgICAgICAgICBVc2VyVHlwZSAgICAgICAgPT4gJ0N1c3RvbWVyJywKICAgICAgICAgICAgU2Vzc2lvblNvdXJjZSAgID0+ICdDdXN0b21lckludGVyZmFjZScsCiAgICAgICAgKTsKCiAgICAgICAgIyBzaG93IGVycm9yIG1lc3NhZ2UgaWYgbm8gc2Vzc2lvbiBpZCBoYXMgYmVlbiBjcmVhdGVkCiAgICAgICAgaWYgKCAhJE5ld1Nlc3Npb25JRCApIHsKCiAgICAgICAgICAgICMgZ2V0IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgbXkgJEVycm9yID0gJFNlc3Npb25PYmplY3QtPlNlc3Npb25JREVycm9yTWVzc2FnZSgpIHx8ICcnOwoKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgb3V0cHV0IGVycm9yIG1lc3NhZ2UKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJEVycm9yLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZXhlY3V0aW9uIGluIDIwIHNlY29uZHMKICAgICAgICBteSAkRXhlY3V0aW9uVGltZU9iaiA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgICRFeGVjdXRpb25UaW1lT2JqLT5BZGQoIFNlY29uZHMgPT4gMjAgKTsKCiAgICAgICAgIyBhZGQgYSBhc3luY2hyb25vdXMgZXhlY3V0b3Igc2NoZWR1bGVyIHRhc2sgdG8gY291bnQgdGhlIGNvbmN1cnJlbnQgdXNlcgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTY2hlZHVsZXInKS0+VGFza0FkZCgKICAgICAgICAgICAgRXhlY3V0aW9uVGltZSAgICAgICAgICAgID0+ICRFeGVjdXRpb25UaW1lT2JqLT5Ub1N0cmluZygpLAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgICAgICAgPT4gJ0FzeW5jaHJvbm91c0V4ZWN1dG9yJywKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgICAgICAgID0+ICdQbHVnaW5Bc3luY2hyb25vdXM6OkNvbmN1cnJlbnRVc2VyJywKICAgICAgICAgICAgTWF4aW11bVBhcmFsbGVsSW5zdGFuY2VzID0+IDEsCiAgICAgICAgICAgIERhdGEgICAgICAgICAgICAgICAgICAgICA9PiB7CiAgICAgICAgICAgICAgICBPYmplY3QgICA9PiAnS2VybmVsOjpTeXN0ZW06OlN1cHBvcnREYXRhQ29sbGVjdG9yOjpQbHVnaW5Bc3luY2hyb25vdXM6OlpudW55OjpDb25jdXJyZW50VXNlcnMnLAogICAgICAgICAgICAgICAgRnVuY3Rpb24gPT4gJ1J1bkFzeW5jaHJvbm91cycsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJFVzZXJUaW1lWm9uZSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KCVVc2VyRGF0YSk7CgogICAgICAgICRTZXNzaW9uT2JqZWN0LT5VcGRhdGVTZXNzaW9uSUQoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICBLZXkgICAgICAgPT4gJ1VzZXJUaW1lWm9uZScsCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVXNlclRpbWVab25lLAogICAgICAgICk7CgogICAgICAgICMgY2hlY2sgaWYgdGhlIHRpbWUgem9uZSBvZmZzZXQgcmVwb3J0ZWQgYnkgdGhlIHVzZXIncyBicm93c2VyIGRpZmZlcnMgZnJvbSB0aGF0CiAgICAgICAgIyBvZiB0aGUgT1RSUyB1c2VyJ3MgdGltZSB6b25lIG9mZnNldAogICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgICAgICAgICBPYmplY3RQYXJhbXMgPT4gewogICAgICAgICAgICAgICAgVGltZVpvbmUgPT4gJFVzZXJUaW1lWm9uZSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgICAgIG15ICRPVFJTVXNlclRpbWVab25lT2Zmc2V0ID0gJERhdGVUaW1lT2JqZWN0LT5Gb3JtYXQoIEZvcm1hdCA9PiAnJXtvZmZzZXR9JyApIC8gNjA7CiAgICAgICAgbXkgJEJyb3dzZXJUaW1lWm9uZU9mZnNldCAgPSAoICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUaW1lWm9uZU9mZnNldCcgKSB8fCAwICkgKiAtMTsKCiAgICAgICAgIyBUaW1lWm9uZU9mZnNldERpZmZlcmVuY2UgY29udGFpbnMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlIHRpbWUgem9uZSBvZmZzZXQgYmV0d2VlbgogICAgICAgICMgdGhlIHVzZXIncyBPVFJTIHRpbWUgem9uZSBzZXR0aW5nIGFuZCB0aGUgb25lIHJlcG9ydGVkIGJ5IHRoZSB1c2VyJ3MgYnJvd3Nlci4KICAgICAgICAjIElmIHRoZXJlIGlzIGEgZGlmZmVyZW5jZSBpdCBjYW4gYmUgZXZhbHVhdGVkIGxhdGVyIHRvIGUuIGcuIHNob3cgYSBtZXNzYWdlCiAgICAgICAgIyBmb3IgdGhlIHVzZXIgdG8gY2hlY2sgaGlzIE9UUlMgdGltZSB6b25lIHNldHRpbmcuCiAgICAgICAgbXkgJFVzZXJUaW1lWm9uZU9mZnNldERpZmZlcmVuY2UgPSBhYnMoICRPVFJTVXNlclRpbWVab25lT2Zmc2V0IC0gJEJyb3dzZXJUaW1lWm9uZU9mZnNldCApOwogICAgICAgICRTZXNzaW9uT2JqZWN0LT5VcGRhdGVTZXNzaW9uSUQoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICBLZXkgICAgICAgPT4gJ1VzZXJUaW1lWm9uZU9mZnNldERpZmZlcmVuY2UnLAogICAgICAgICAgICBWYWx1ZSAgICAgPT4gJFVzZXJUaW1lWm9uZU9mZnNldERpZmZlcmVuY2UsCiAgICAgICAgKTsKCiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2Vzc2lvbklEQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAkUGFyYW17U2Vzc2lvbk5hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAkRXhwaXJlcywKICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiBzY2FsYXIgJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgSFRUUE9ubHkgPT4gMSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIE9UUlNCcm93c2VySGFzQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAnT1RSU0Jyb3dzZXJIYXNDb29raWUnLAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgRXhwaXJlcyAgPT4gJy0xeScsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgSFRUUE9ubHkgPT4gMSwKICAgICAgICAgICAgICAgICAgICApLAoKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTZXNzaW9uSUQgICA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICAgICAgU2Vzc2lvbk5hbWUgPT4gJFBhcmFte1Nlc3Npb25OYW1lfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIHJlZGlyZWN0IHdpdGggbmV3IHNlc3Npb24gaWQgYW5kIG9sZCBwYXJhbXMKICAgICAgICAjIHByZXBhcmUgb2xkIHJlZGlyZWN0IFVSTCAtLSBkbyBub3QgcmVkaXJlY3QgdG8gTG9naW4gb3IgTG9nb3V0IChsb29wKSEKICAgICAgICBpZiAoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID1+IC9BY3Rpb249KExvZ291dHxMb2dpbnxMb3N0UGFzc3dvcmR8UHJlTG9naW4pLyApIHsKICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAnJzsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3Qgd2l0aCBuZXcgc2Vzc2lvbiBpZAogICAgICAgIHByaW50ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+UmVkaXJlY3QoCiAgICAgICAgICAgIE9QICAgID0+ICRQYXJhbXtSZXF1ZXN0ZWRVUkx9LAogICAgICAgICAgICBMb2dpbiA9PiAxLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBsb2dvdXQKICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0xvZ291dCcgKSB7CgogICAgICAgICMgY2hlY2sgc2Vzc2lvbiBpZAogICAgICAgIGlmICggISRTZXNzaW9uT2JqZWN0LT5DaGVja1Nlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CgogICAgICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKQogICAgICAgICAgICAgICAgICAgICAgICAuICI/UmVhc29uPUludmFsaWRTZXNzaW9uSUQ7UmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyBsb2dpbiBzY3JlZW4KICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0xvZ291dCcsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnU2Vzc2lvbiBpbnZhbGlkLiBQbGVhc2UgbG9nIGluIGFnYWluLicpLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGdldCBzZXNzaW9uIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkU2Vzc2lvbk9iamVjdC0+R2V0U2Vzc2lvbklERGF0YSgKICAgICAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgICAgICk7CgogICAgICAgICRVc2VyRGF0YXtVc2VyVGltZVpvbmV9ID0gJFNlbGYtPl9Vc2VyVGltZVpvbmVHZXQoJVVzZXJEYXRhKTsKCiAgICAgICAgIyBjcmVhdGUgbmV3IExheW91dE9iamVjdCB3aXRoIG5ldyAnJVBhcmFtJyBhbmQgJyVVc2VyRGF0YScKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICBTZXRDb29raWVzID0+IHsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uSURDb29raWUgPT4gJFBhcmFtT2JqZWN0LT5TZXRDb29raWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICBFeHBpcmVzICA9PiAnLTF5JywKICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiBzY2FsYXIgJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgSFRUUE9ubHkgPT4gMSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAkS2VybmVsOjpPTS0+T2JqZWN0c0Rpc2NhcmQoIE9iamVjdHMgPT4gWydLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0J10gKTsKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIHJlbW92ZSBzZXNzaW9uIGlkCiAgICAgICAgaWYgKCAhJFNlc3Npb25PYmplY3QtPlJlbW92ZVNlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyRmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKQogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9nb3V0VVJMJykgKSB7CiAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ291dFVSTCcpLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGxvZ291dCBzY3JlZW4KICAgICAgICBteSAkTG9nb3V0TWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnTG9nb3V0IHN1Y2Nlc3NmdWwuJyk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9nb3V0JywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+ICRMb2dvdXRNZXNzYWdlLAogICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICApLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBDdXN0b21lckxvc3RQYXNzd29yZAogICAgZWxzaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnQ3VzdG9tZXJMb3N0UGFzc3dvcmQnICkgewoKICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgIyBjaGVjayBmZWF0dXJlCiAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9zdFBhc3N3b3JkJykgKSB7CgogICAgICAgICAgICAjIHNob3cgbm9ybWFsIGxvZ2luCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnRmVhdHVyZSBub3QgYWN0aXZlIScpLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgbXkgJFVzZXIgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1VzZXInICkgIHx8ICcnOwogICAgICAgIG15ICRUb2tlbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUb2tlbicgKSB8fCAnJzsKCiAgICAgICAgIyBnZXQgdXNlciBsb2dpbiBieSB0b2tlbgogICAgICAgIGlmICggISRVc2VyICYmICRUb2tlbiApIHsKCiAgICAgICAgICAgICMgUHJldmVudCBleHRyYWN0aW5nIHBhc3N3b3JkIHJlc2V0IHRva2VuIGNoYXJhY3Rlci1ieS1jaGFyYWN0ZXIgdmlhIHdpbGRjYXJkIGluamVjdGlvbgogICAgICAgICAgICAjIFRoZSB3aWxkIGNhcmQgY2hhcmFjdGVycyAiJSIgYW5kICJfIiBjb3VsZCBiZSB1c2VkIHRvIG1hdGNoIGFyYml0cmFyeSBjaGFyYWN0ZXIuCiAgICAgICAgICAgIGlmICggJFRva2VuICF+IG17XEEgKD86IFthLXpBLVpdIHwgXGQgKSsgXHp9eG1zICkgewoKICAgICAgICAgICAgICAgICMgU2VjdXJpdHk6IHByZXRlbmQgdGhhdCBwYXNzd29yZCByZXNldCBpbnN0cnVjdGlvbnMgd2VyZSBhY3R1YWxseSBzZW50IHRvCiAgICAgICAgICAgICAgICAjICAgbWFrZSBzdXJlIHRoYXQgdXNlcnMgY2Fubm90IGZpbmQgb3V0IHZhbGlkIHVzZXJuYW1lcyBieQogICAgICAgICAgICAgICAgIyAgIGp1c3QgdHJ5aW5nIGFuZCBjaGVja2luZyB0aGUgcmVzdWx0IG1lc3NhZ2UuCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkxvZ2luKAogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiBUcmFuc2xhdGFibGUoJ1NlbnQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICVVc2VyTGlzdCA9ICRVc2VyT2JqZWN0LT5TZWFyY2hQcmVmZXJlbmNlcygKICAgICAgICAgICAgICAgIEtleSAgID0+ICdVc2VyVG9rZW4nLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJFRva2VuLAogICAgICAgICAgICApOwogICAgICAgICAgICBVU0VSX0lEOgogICAgICAgICAgICBmb3IgbXkgJFVzZXJJRCAoIHNvcnQga2V5cyAlVXNlckxpc3QgKSB7CiAgICAgICAgICAgICAgICBteSAlVXNlckRhdGEgPSAkVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VyICA9PiAkVXNlcklELAogICAgICAgICAgICAgICAgICAgIFZhbGlkID0+IDEsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCVVc2VyRGF0YSkgewogICAgICAgICAgICAgICAgICAgICRVc2VyID0gJFVzZXJEYXRhe1VzZXJMb2dpbn07CiAgICAgICAgICAgICAgICAgICAgbGFzdCBVU0VSX0lEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCggVXNlciA9PiAkVXNlciApOwoKICAgICAgICAjIHZlcmlmeSBjdXN0b21lciB1c2VyIGlzIHZhbGlkIHdoZW4gcmVxdWVzdGluZyBwYXNzd29yZCByZXNldAogICAgICAgIG15IEBWYWxpZElEcyAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZElEc0dldCgpOwogICAgICAgIG15ICRVc2VySXNWYWxpZCA9IGdyZXAgeyAkVXNlckRhdGF7VmFsaWRJRH0gJiYgJFVzZXJEYXRhe1ZhbGlkSUR9ID09ICRfIH0gQFZhbGlkSURzOwogICAgICAgIGlmICggISRVc2VyRGF0YXtVc2VySUR9IHx8ICEkVXNlcklzVmFsaWQgKSB7CgogICAgICAgICAgICAjIFNlY3VyaXR5OiBwcmV0ZW5kIHRoYXQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zIHdlcmUgYWN0dWFsbHkgc2VudCB0bwogICAgICAgICAgICAjICAgbWFrZSBzdXJlIHRoYXQgdXNlcnMgY2Fubm90IGZpbmQgb3V0IHZhbGlkIHVzZXJuYW1lcyBieQogICAgICAgICAgICAjICAganVzdCB0cnlpbmcgYW5kIGNoZWNraW5nIHRoZSByZXN1bHQgbWVzc2FnZS4KICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICAgICA9PiBUcmFuc2xhdGFibGUoJ1NlbnQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nKSwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGNyZWF0ZSBlbWFpbCBvYmplY3QKICAgICAgICBteSAkRW1haWxPYmplY3QgPSBLZXJuZWw6OlN5c3RlbTo6RW1haWwtPm5ldyggJXskU2VsZn0gKTsKCiAgICAgICAgIyBzZW5kIHBhc3N3b3JkIHJlc2V0IHRva2VuCiAgICAgICAgaWYgKCAhJFRva2VuICkgewoKICAgICAgICAgICAgIyBnZW5lcmF0ZSB0b2tlbgogICAgICAgICAgICAkVXNlckRhdGF7VG9rZW59ID0gJFVzZXJPYmplY3QtPlRva2VuR2VuZXJhdGUoCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNlbmQgdG9rZW4gbm90aWZ5IGVtYWlsIHdpdGggbGluawogICAgICAgICAgICBteSAkQm9keSA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbEJvZHlMb3N0UGFzc3dvcmRUb2tlbicpCiAgICAgICAgICAgICAgICB8fCAnRVJST1I6IEN1c3RvbWVyUGFuZWxCb2R5TG9zdFBhc3N3b3JkVG9rZW4gaXMgbWlzc2luZyEnOwogICAgICAgICAgICBteSAkU3ViamVjdCA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbFN1YmplY3RMb3N0UGFzc3dvcmRUb2tlbicpCiAgICAgICAgICAgICAgICB8fCAnRVJST1I6IEN1c3RvbWVyUGFuZWxTdWJqZWN0TG9zdFBhc3N3b3JkVG9rZW4gaXMgbWlzc2luZyEnOwogICAgICAgICAgICBmb3IgbXkgJFVzZXJLZXkgKCBzb3J0IGtleXMgJVVzZXJEYXRhICkgewogICAgICAgICAgICAgICAgJEJvZHkgPX4gcy88T1RSU18kVXNlcktleT4vJFVzZXJEYXRheyRVc2VyS2V5fS9naTsKICAgICAgICAgICAgfQogICAgICAgICAgICBteSAkU2VudCA9ICRFbWFpbE9iamVjdC0+U2VuZCgKICAgICAgICAgICAgICAgIFRvICAgICAgID0+ICRVc2VyRGF0YXtVc2VyRW1haWx9LAogICAgICAgICAgICAgICAgU3ViamVjdCAgPT4gJFN1YmplY3QsCiAgICAgICAgICAgICAgICBDaGFyc2V0ICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckNoYXJzZXR9LAogICAgICAgICAgICAgICAgTWltZVR5cGUgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAgICAgQm9keSAgICAgPT4gJEJvZHkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAhJFNlbnQtPntTdWNjZXNzfSApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ1NlbnQgcGFzc3dvcmQgcmVzZXQgaW5zdHJ1Y3Rpb25zLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nKSwKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVR5cGUgPT4gJ1N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuIDE7CgogICAgICAgIH0KCiAgICAgICAgIyByZXNldCBwYXNzd29yZAogICAgICAgICMgY2hlY2sgaWYgdG9rZW4gaXMgdmFsaWQKICAgICAgICBteSAkVG9rZW5WYWxpZCA9ICRVc2VyT2JqZWN0LT5Ub2tlbkNoZWNrKAogICAgICAgICAgICBUb2tlbiAgPT4gJFRva2VuLAogICAgICAgICAgICBVc2VySUQgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkVG9rZW5WYWxpZCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdJbnZhbGlkIFRva2VuIScpLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IG5ldyBwYXNzd29yZAogICAgICAgICRVc2VyRGF0YXtOZXdQV30gPSAkVXNlck9iamVjdC0+R2VuZXJhdGVSYW5kb21QYXNzd29yZCgpOwoKICAgICAgICAjIHVwZGF0ZSBuZXcgcGFzc3dvcmQKICAgICAgICBteSAkU3VjY2VzcyA9ICRVc2VyT2JqZWN0LT5TZXRQYXNzd29yZCgKICAgICAgICAgICAgVXNlckxvZ2luID0+ICRVc2VyLAogICAgICAgICAgICBQVyAgICAgICAgPT4gJFVzZXJEYXRhe05ld1BXfQogICAgICAgICk7CgogICAgICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ1Jlc2V0IHBhc3N3b3JkIHVuc3VjY2Vzc2Z1bC4gUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICA9PiAkVXNlciwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2VuZCBub3RpZnkgZW1haWwKICAgICAgICBteSAkQm9keSA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbEJvZHlMb3N0UGFzc3dvcmQnKQogICAgICAgICAgICB8fCAnTmV3IFBhc3N3b3JkIGlzOiA8T1RSU19ORVdQVz4nOwogICAgICAgIG15ICRTdWJqZWN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsU3ViamVjdExvc3RQYXNzd29yZCcpCiAgICAgICAgICAgIHx8ICdOZXcgUGFzc3dvcmQhJzsKICAgICAgICBmb3IgbXkgJFVzZXJLZXkgKCBzb3J0IGtleXMgJVVzZXJEYXRhICkgewogICAgICAgICAgICAkQm9keSA9fiBzLzxPVFJTXyRVc2VyS2V5Pi8kVXNlckRhdGF7JFVzZXJLZXl9L2dpOwogICAgICAgIH0KICAgICAgICBteSAkU2VudCA9ICRFbWFpbE9iamVjdC0+U2VuZCgKICAgICAgICAgICAgVG8gICAgICAgPT4gJFVzZXJEYXRhe1VzZXJFbWFpbH0sCiAgICAgICAgICAgIFN1YmplY3QgID0+ICRTdWJqZWN0LAogICAgICAgICAgICBDaGFyc2V0ICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckNoYXJzZXR9LAogICAgICAgICAgICBNaW1lVHlwZSA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgIEJvZHkgICAgID0+ICRCb2R5CiAgICAgICAgKTsKICAgICAgICBpZiAoICEkU2VudC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJykKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBteSAkTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgJ1NlbnQgbmV3IHBhc3N3b3JkIHRvICVzLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nLAogICAgICAgICAgICAkVXNlckRhdGF7VXNlckVtYWlsfSwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICBUaXRsZSAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICBVc2VyICAgICAgICA9PiAkVXNlciwKICAgICAgICAgICAgICAgIE1lc3NhZ2VUeXBlID0+ICdTdWNjZXNzJywKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgY3JlYXRlIG5ldyBjdXN0b21lciBhY2NvdW50CiAgICBlbHNpZiAoICRQYXJhbXtBY3Rpb259IGVxICdDdXN0b21lckNyZWF0ZUFjY291bnQnICkgewoKICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgIyBjaGVjayBmZWF0dXJlCiAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQ3JlYXRlQWNjb3VudCcpICkgewoKICAgICAgICAgICAgIyBzaG93IG5vcm1hbCBsb2dpbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ0ZlYXR1cmUgbm90IGFjdGl2ZSEnKSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgIG15ICVHZXRQYXJhbXM7CiAgICAgICAgZm9yIG15ICRFbnRyeSAoIEB7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJVc2VyJyktPntNYXB9IH0gKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXN7ICRFbnRyeS0+WzBdIH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkRW50cnktPlsxXSApCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgICAgICB9CiAgICAgICAgJEdldFBhcmFtc3tWYWxpZElEfSA9IDE7CgogICAgICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgICAgIGlmICggISRHZXRQYXJhbXN7VXNlckN1c3RvbWVySUR9ICkgewogICAgICAgICAgICAkR2V0UGFyYW1ze1VzZXJDdXN0b21lcklEfSA9ICRHZXRQYXJhbXN7VXNlckVtYWlsfTsKICAgICAgICB9CiAgICAgICAgaWYgKCAhJEdldFBhcmFtc3tVc2VyTG9naW59ICkgewogICAgICAgICAgICAkR2V0UGFyYW1ze1VzZXJMb2dpbn0gPSAkR2V0UGFyYW1ze1VzZXJFbWFpbH07CiAgICAgICAgfQoKICAgICAgICAjIGdldCBuZXcgcGFzc3dvcmQKICAgICAgICAkR2V0UGFyYW1ze1VzZXJQYXNzd29yZH0gPSAkVXNlck9iamVjdC0+R2VuZXJhdGVSYW5kb21QYXNzd29yZCgpOwoKICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCggVXNlciA9PiAkR2V0UGFyYW1ze1VzZXJMb2dpbn0gKTsKICAgICAgICBpZiAoICRVc2VyRGF0YXtVc2VySUR9IHx8ICEkR2V0UGFyYW1ze1VzZXJMb2dpbn0gKSB7CgogICAgICAgICAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgICAgICBLZXkgICA9PiAnU2lnbnVwRXJyb3InLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gMSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoJ1RoaXMgZS1tYWlsIGFkZHJlc3MgYWxyZWFkeSBleGlzdHMuIFBsZWFzZSBsb2cgaW4gb3IgcmVzZXQgeW91ciBwYXNzd29yZC4nKSwKICAgICAgICAgICAgICAgICAgICBVc2VyVGl0bGUgICAgID0+ICRHZXRQYXJhbXN7VXNlclRpdGxlfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRmlyc3RuYW1lID0+ICRHZXRQYXJhbXN7VXNlckZpcnN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckxhc3RuYW1lICA9PiAkR2V0UGFyYW1ze1VzZXJMYXN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckVtYWlsICAgICA9PiAkR2V0UGFyYW1ze1VzZXJFbWFpbH0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGZvciBtYWlsIGFkZHJlc3MgcmVzdHJpY3Rpb25zCiAgICAgICAgbXkgQFdoaXRlbGlzdCA9IEB7CiAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbENyZWF0ZUFjY291bnQ6Ok1haWxSZXN0cmljdGlvbnM6OldoaXRlbGlzdCcpIC8vIFtdCiAgICAgICAgfTsKICAgICAgICBteSBAQmxhY2tsaXN0ID0gQHsKICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQ3JlYXRlQWNjb3VudDo6TWFpbFJlc3RyaWN0aW9uczo6QmxhY2tsaXN0JykgLy8gW10KICAgICAgICB9OwoKICAgICAgICBteSAkV2hpdGVsaXN0TWF0Y2hlZDsKICAgICAgICBmb3IgbXkgJFdoaXRlbGlzdEVudHJ5IChAV2hpdGVsaXN0KSB7CiAgICAgICAgICAgIG15ICRSZWdleCA9IGV2YWwge3FyLyRXaGl0ZWxpc3RFbnRyeS9pfTsKICAgICAgICAgICAgaWYgKCRAKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnVGhlIGN1c3RvbWVyIHBhbmVsIG1haWwgYWRkcmVzcyB3aGl0ZWxpc3QgY29udGFpbnMgdGhlIGludmFsaWQgcmVndWxhciBleHByZXNzaW9uICRXaGl0ZWxpc3RFbnRyeSwgcGxlYXNlIGNoZWNrIGFuZCBjb3JyZWN0IGl0LicKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkR2V0UGFyYW1ze1VzZXJFbWFpbH0gPX4gJFJlZ2V4ICkgewogICAgICAgICAgICAgICAgJFdoaXRlbGlzdE1hdGNoZWQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBteSAkQmxhY2tsaXN0TWF0Y2hlZDsKICAgICAgICBmb3IgbXkgJEJsYWNrbGlzdEVudHJ5IChAQmxhY2tsaXN0KSB7CiAgICAgICAgICAgIG15ICRSZWdleCA9IGV2YWwge3FyLyRCbGFja2xpc3RFbnRyeS9pfTsKICAgICAgICAgICAgaWYgKCRAKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnVGhlIGN1c3RvbWVyIHBhbmVsIG1haWwgYWRkcmVzcyBibGFja2xpc3QgY29udGFpbnMgdGhlIGludmFsaWQgcmVndWxhciBleHByZXNzaW9uICRCbGFja2xpc3RFbnRyeSwgcGxlYXNlIGNoZWNrIGFuZCBjb3JyZWN0IGl0LicKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkR2V0UGFyYW1ze1VzZXJFbWFpbH0gPX4gJFJlZ2V4ICkgewogICAgICAgICAgICAgICAgJEJsYWNrbGlzdE1hdGNoZWQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCAoIEBXaGl0ZWxpc3QgJiYgISRXaGl0ZWxpc3RNYXRjaGVkICkgfHwgKCBAQmxhY2tsaXN0ICYmICRCbGFja2xpc3RNYXRjaGVkICkgKSB7CgogICAgICAgICAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgICAgICBLZXkgICA9PiAnU2lnbnVwRXJyb3InLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gMSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoJ1RoaXMgZW1haWwgYWRkcmVzcyBpcyBub3QgYWxsb3dlZCB0byByZWdpc3Rlci4gUGxlYXNlIGNvbnRhY3Qgc3VwcG9ydCBzdGFmZi4nKSwKICAgICAgICAgICAgICAgICAgICBVc2VyVGl0bGUgICAgID0+ICRHZXRQYXJhbXN7VXNlclRpdGxlfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRmlyc3RuYW1lID0+ICRHZXRQYXJhbXN7VXNlckZpcnN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckxhc3RuYW1lICA9PiAkR2V0UGFyYW1ze1VzZXJMYXN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckVtYWlsICAgICA9PiAkR2V0UGFyYW1ze1VzZXJFbWFpbH0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgYWNjb3VudAogICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICBteSAkTm93ID0gJERhdGVUaW1lT2JqZWN0LT5Ub1N0cmluZygpOwoKICAgICAgICBteSAkQWRkID0gJFVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckFkZCgKICAgICAgICAgICAgJUdldFBhcmFtcywKICAgICAgICAgICAgQ29tbWVudCA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICdBZGRlZCB2aWEgQ3VzdG9tZXIgUGFuZWwgKCVzKScsICROb3cgKSwKICAgICAgICAgICAgVmFsaWRJRCA9PiAxLAogICAgICAgICAgICBVc2VySUQgID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbFVzZXJJRCcpLAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJEFkZCApIHsKCiAgICAgICAgICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgICAgIEtleSAgID0+ICdTaWdudXBFcnJvcicsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+UHJpbnQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gXCRMYXlvdXRPYmplY3QtPkN1c3RvbWVyTG9naW4oCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgICA9PiAnTG9naW4nLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgICAgPT4gVHJhbnNsYXRhYmxlKCdDdXN0b21lciB1c2VyIGNhblwndCBiZSBhZGRlZCEnKSwKICAgICAgICAgICAgICAgICAgICBVc2VyVGl0bGUgICAgID0+ICRHZXRQYXJhbXN7VXNlclRpdGxlfSwKICAgICAgICAgICAgICAgICAgICBVc2VyRmlyc3RuYW1lID0+ICRHZXRQYXJhbXN7VXNlckZpcnN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckxhc3RuYW1lICA9PiAkR2V0UGFyYW1ze1VzZXJMYXN0bmFtZX0sCiAgICAgICAgICAgICAgICAgICAgVXNlckVtYWlsICAgICA9PiAkR2V0UGFyYW1ze1VzZXJFbWFpbH0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAjIHNlbmQgbm90aWZ5IGVtYWlsCiAgICAgICAgbXkgJEVtYWlsT2JqZWN0ID0gS2VybmVsOjpTeXN0ZW06OkVtYWlsLT5uZXcoICV7JFNlbGZ9ICk7CiAgICAgICAgbXkgJEJvZHkgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsQm9keU5ld0FjY291bnQnKQogICAgICAgICAgICB8fCAnTm8gQ29uZmlnIE9wdGlvbiBmb3VuZCEnOwogICAgICAgIG15ICRTdWJqZWN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsU3ViamVjdE5ld0FjY291bnQnKQogICAgICAgICAgICB8fCAnTmV3IE9UUlMgQWNjb3VudCEnOwogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVHZXRQYXJhbXMgKSB7CiAgICAgICAgICAgICRCb2R5ID1+IHMvPE9UUlNfJEtleT4vJEdldFBhcmFtc3skS2V5fS9naTsKICAgICAgICB9CgogICAgICAgICMgc2VuZCBhY2NvdW50IGluZm8KICAgICAgICBteSAkU2VudCA9ICRFbWFpbE9iamVjdC0+U2VuZCgKICAgICAgICAgICAgVG8gICAgICAgPT4gJEdldFBhcmFtc3tVc2VyRW1haWx9LAogICAgICAgICAgICBTdWJqZWN0ICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgQ2hhcnNldCAgPT4gJExheW91dE9iamVjdC0+e1VzZXJDaGFyc2V0fSwKICAgICAgICAgICAgTWltZVR5cGUgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICBCb2R5ICAgICA9PiAkQm9keQogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFNlbnQtPntTdWNjZXNzfSApIHsKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkN1c3RvbWVySGVhZGVyKAogICAgICAgICAgICAgICAgQXJlYSAgPT4gJ0NvcmUnLAogICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0Vycm9yJwogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkN1c3RvbWVyV2FybmluZygKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdDYW5cJ3Qgc2VuZCBhY2NvdW50IGluZm8hJykKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZvb3RlcigpOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCggT3V0cHV0ID0+IFwkT3V0cHV0ICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2hvdyBzZW50IGFjY291bnQgaW5mbwogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKSApIHsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgcHJpbnQgJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBFeHRVUkwgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKQogICAgICAgICAgICAgICAgICAgIC4gIj9SZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH07VXNlcj0kR2V0UGFyYW1ze1VzZXJMb2dpbn07IgogICAgICAgICAgICAgICAgICAgIC4gIkVtYWlsPSRHZXRQYXJhbXN7VXNlckVtYWlsfTtSZWFzb249TmV3QWNjb3VudENyZWF0ZWQiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICAgIG15ICRBY2NvdW50Q3JlYXRlZE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICdOZXcgYWNjb3VudCBjcmVhdGVkLiBTZW50IGxvZ2luIGluZm9ybWF0aW9uIHRvICVzLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbC4nLAogICAgICAgICAgICAkR2V0UGFyYW1ze1VzZXJFbWFpbH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBsb2dpbiBzY3JlZW4KICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgID0+ICRBY2NvdW50Q3JlYXRlZE1lc3NhZ2UsCiAgICAgICAgICAgICAgICBVc2VyICAgICAgICA9PiAkR2V0UGFyYW1ze1VzZXJMb2dpbn0sCiAgICAgICAgICAgICAgICBNZXNzYWdlVHlwZSA9PiAnU3VjY2VzcycsCiAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIHNob3cgbG9naW4gc2l0ZQogICAgZWxzaWYgKCAhJFBhcmFte1Nlc3Npb25JRH0gKSB7CgogICAgICAgICMgbmV3IGxheW91dCBvYmplY3QKICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICAgICAjIGNyZWF0ZSBBdXRoT2JqZWN0CiAgICAgICAgbXkgJEF1dGhPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJBdXRoJyk7CiAgICAgICAgaWYgKCAkQXV0aE9iamVjdC0+R2V0T3B0aW9uKCBXaGF0ID0+ICdQcmVBdXRoJyApICkgewoKICAgICAgICAgICAgIyBhdXRvbWF0aWMgbG9naW4KICAgICAgICAgICAgJFBhcmFte1JlcXVlc3RlZFVSTH0gPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCAkUGFyYW17UmVxdWVzdGVkVVJMfSApOwogICAgICAgICAgICBwcmludCAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+ICJBY3Rpb249UHJlTG9naW47UmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykgKSB7CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICAkUGFyYW17UmVxdWVzdGVkVVJMfSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ICk7CiAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgRXh0VVJMID0+ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykKICAgICAgICAgICAgICAgICAgICAuICI/UmVxdWVzdGVkVVJMPSRQYXJhbXtSZXF1ZXN0ZWRVUkx9IiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBsb2dpbiBzY3JlZW4KICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgVGl0bGUgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgICMgcnVuIG1vZHVsZXMgaWYgYSB2ZXJzaW9uIHZhbHVlIGV4aXN0cwogICAgZWxzaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCJLZXJuZWw6Ok1vZHVsZXM6OiRQYXJhbXtBY3Rpb259IikgKSB7CgogICAgICAgICMgY2hlY2sgc2Vzc2lvbiBpZAogICAgICAgIGlmICggISRTZXNzaW9uT2JqZWN0LT5DaGVja1Nlc3Npb25JRCggU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9ICkgKSB7CgogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgTGF5b3V0T2JqZWN0IHdpdGggbmV3ICclUGFyYW0nCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU2V0Q29va2llcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNlc3Npb25JRENvb2tpZSA9PiAkUGFyYW1PYmplY3QtPlNldENvb2tpZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRQYXJhbXtTZXNzaW9uTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICctMXknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VjdXJlICAgPT4gc2NhbGFyICRDb29raWVTZWN1cmVBdHRyaWJ1dGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdHNEaXNjYXJkKCBPYmplY3RzID0+IFsnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCddICk7CiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICAgICAjIGNyZWF0ZSBBdXRoT2JqZWN0CiAgICAgICAgICAgIG15ICRBdXRoT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQXV0aCcpOwogICAgICAgICAgICBpZiAoICRBdXRoT2JqZWN0LT5HZXRPcHRpb24oIFdoYXQgPT4gJ1ByZUF1dGgnICkgKSB7CgogICAgICAgICAgICAgICAgIyBhdXRvbWF0aWMgcmUtbG9naW4KICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIE9QID0+ICI/QWN0aW9uPVByZUxvZ2luJlJlcXVlc3RlZFVSTD0kUGFyYW17UmVxdWVzdGVkVVJMfSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlZGlyZWN0IHRvIGFsdGVybmF0ZSBsb2dpbgogICAgICAgICAgICBlbHNpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvZ2luVVJMJykgKSB7CgogICAgICAgICAgICAgICAgIyByZWRpcmVjdCB0byBhbHRlcm5hdGUgbG9naW4KICAgICAgICAgICAgICAgICRQYXJhbXtSZXF1ZXN0ZWRVUkx9ID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSggJFBhcmFte1JlcXVlc3RlZFVSTH0gKTsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIj9SZWFzb249SW52YWxpZFNlc3Npb25JRDtSZXF1ZXN0ZWRVUkw9JFBhcmFte1JlcXVlc3RlZFVSTH0iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+IFwkTGF5b3V0T2JqZWN0LT5DdXN0b21lckxvZ2luKAogICAgICAgICAgICAgICAgICAgIFRpdGxlID0+ICdMb2dpbicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICRTZXNzaW9uT2JqZWN0LT5TZXNzaW9uSURFcnJvck1lc3NhZ2UoKSApLAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHNlc3Npb24gZGF0YQogICAgICAgIG15ICVVc2VyRGF0YSA9ICRTZXNzaW9uT2JqZWN0LT5HZXRTZXNzaW9uSUREYXRhKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJFBhcmFte1Nlc3Npb25JRH0sCiAgICAgICAgKTsKCiAgICAgICAgJFVzZXJEYXRhe1VzZXJUaW1lWm9uZX0gPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglVXNlckRhdGEpOwoKICAgICAgICAjIGNoZWNrIG5lZWRlZCBkYXRhCiAgICAgICAgaWYgKCAhJFVzZXJEYXRhe1VzZXJJRH0gfHwgISRVc2VyRGF0YXtVc2VyTG9naW59IHx8ICRVc2VyRGF0YXtVc2VyVHlwZX0gbmUgJ0N1c3RvbWVyJyApIHsKICAgICAgICAgICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAgICAgICAgICMgcmVkaXJlY3QgdG8gYWx0ZXJuYXRlIGxvZ2luCiAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclBhbmVsTG9naW5VUkwnKSApIHsKICAgICAgICAgICAgICAgIHByaW50ICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgICAgIEV4dFVSTCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxMb2dpblVSTCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIj9SZWFzb249U3lzdGVtRXJyb3IiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGxvZ2luIHNjcmVlbgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5QcmludCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiBcJExheW91dE9iamVjdC0+Q3VzdG9tZXJMb2dpbigKICAgICAgICAgICAgICAgICAgICBUaXRsZSAgID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ0Vycm9yOiBpbnZhbGlkIHNlc3Npb24uJyksCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBtb2R1bGUgcmVnaXN0cnkKICAgICAgICBteSAkTW9kdWxlUmVnID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpNb2R1bGUnKS0+eyAkUGFyYW17QWN0aW9ufSB9OwogICAgICAgIGlmICggISRNb2R1bGVSZWcgKSB7CgogICAgICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAiTW9kdWxlIEtlcm5lbDo6TW9kdWxlczo6JFBhcmFte0FjdGlvbn0gbm90IHJlZ2lzdGVyZWQgaW4gS2VybmVsL0NvbmZpZy5wbSEiLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgbW9kdWxlIHBlcm1pc3Npb24gY2hlY2sgZm9yIGFjdGlvbgogICAgICAgIGlmICgKICAgICAgICAgICAgcmVmICRNb2R1bGVSZWctPntHcm91cFJvfSBlcSAnQVJSQVknCiAgICAgICAgICAgICYmICFzY2FsYXIgQHsgJE1vZHVsZVJlZy0+e0dyb3VwUm99IH0KICAgICAgICAgICAgJiYgcmVmICRNb2R1bGVSZWctPntHcm91cH0gZXEgJ0FSUkFZJwogICAgICAgICAgICAmJiAhc2NhbGFyIEB7ICRNb2R1bGVSZWctPntHcm91cH0gfQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkUGFyYW17QWNjZXNzUm99ID0gMTsKICAgICAgICAgICAgJFBhcmFte0FjY2Vzc1J3fSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgKCAkUGFyYW17QWNjZXNzUm99LCAkUGFyYW17QWNjZXNzUnd9ICkgPSAkU2VsZi0+X0NoZWNrTW9kdWxlUGVybWlzc2lvbigKICAgICAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFBhcmFte0FjY2Vzc1JvfSApIHsKCiAgICAgICAgICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnTm8gUGVybWlzc2lvbiB0byB1c2UgdGhpcyBmcm9udGVuZCBhY3Rpb24gbW9kdWxlIScKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIG15ICROYXZpZ2F0aW9uQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpOYXZpZ2F0aW9uJyktPnsgJFBhcmFte0FjdGlvbn0gfTsKCiAgICAgICAgIyBtb2R1bGUgcGVybWlzc2lvbiBjaGVjayBmb3Igc3VibWVudSBpdGVtCiAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkTmF2aWdhdGlvbkNvbmZpZykgKSB7CgogICAgICAgICAgICBLRVk6CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JE5hdmlnYXRpb25Db25maWd9ICkgewogICAgICAgICAgICAgICAgbmV4dCBLRVkgaWYgJEtleSAgICAgICAgICAgICAgICAgIX4gbS9eXGQrL2k7CiAgICAgICAgICAgICAgICBuZXh0IEtFWSBpZiAkUGFyYW17UmVxdWVzdGVkVVJMfSAhfiBtL1N1YmFjdGlvbi9pOwoKICAgICAgICAgICAgICAgIG15IEBNb2R1bGVOYXZpZ2F0aW9uQ29uZmlnczsKCiAgICAgICAgICAgICAgICAjIEZJWE1FOiBTdXBwb3J0IGJvdGggb2xkIChIQVNIKSBhbmQgbmV3IChBUlJBWSBvZiBIQVNIKSBuYXZpZ2F0aW9uIGNvbmZpZ3VyYXRpb25zLCBmb3IgcmVhc29ucyBvZgogICAgICAgICAgICAgICAgIyAgIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LiBPbmNlIHdlIGFyZSBzdXJlIGV2ZXJ5dGhpbmcgaGFzIGJlZW4gbWlncmF0ZWQgY29ycmVjdGx5LCBzdXBwb3J0IGZvcgogICAgICAgICAgICAgICAgIyAgIEhBU0gtb25seSBjb25maWd1cmF0aW9uIGNhbiBiZSBkcm9wcGVkIGluIGZ1dHVyZSBtYWpvciByZWxlYXNlLgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJE5hdmlnYXRpb25Db25maWctPnskS2V5fSApICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQE1vZHVsZU5hdmlnYXRpb25Db25maWdzLCAkTmF2aWdhdGlvbkNvbmZpZy0+eyRLZXl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoICROYXZpZ2F0aW9uQ29uZmlnLT57JEtleX0gKSApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBNb2R1bGVOYXZpZ2F0aW9uQ29uZmlncywgQHsgJE5hdmlnYXRpb25Db25maWctPnskS2V5fSB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgU2tpcCBpbmNvbXBhdGlibGUgY29uZmlndXJhdGlvbi4KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5leHQgS0VZOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIElURU06CiAgICAgICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKEBNb2R1bGVOYXZpZ2F0aW9uQ29uZmlncykgewogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgJEl0ZW0tPntMaW5rfSA9fiBtL1N1YmFjdGlvbj0vaQogICAgICAgICAgICAgICAgICAgICAgICAmJiAkSXRlbS0+e0xpbmt9ICF+IG0vJFBhcmFte1N1YmFjdGlvbn0vaQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IElURU07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAwOwogICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSd30gPSAwOwoKICAgICAgICAgICAgICAgICAgICAjIG1vZHVsZSBwZXJtaXNzaW9uIGNoZWNrIGZvciBzdWJtZW51IGl0ZW0KICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiAkSXRlbS0+e0dyb3VwUm99IGVxICdBUlJBWScKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIXNjYWxhciBAeyAkSXRlbS0+e0dyb3VwUm99IH0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgcmVmICRJdGVtLT57R3JvdXB9IGVxICdBUlJBWScKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIXNjYWxhciBAeyAkSXRlbS0+e0dyb3VwfSB9CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJhbXtBY2Nlc3NSb30gPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAkUGFyYW17QWNjZXNzUnd9ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICAoICRQYXJhbXtBY2Nlc3NSb30sICRQYXJhbXtBY2Nlc3NSd30gKSA9ICRTZWxmLT5fQ2hlY2tNb2R1bGVQZXJtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlUmVnID0+ICRJdGVtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFBhcmFte0FjY2Vzc1JvfSApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG5ldyBsYXlvdXQgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnTm8gUGVybWlzc2lvbiB0byB1c2UgdGhpcyBmcm9udGVuZCBzdWJhY3Rpb24gbW9kdWxlIScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGNyZWF0ZSBuZXcgTGF5b3V0T2JqZWN0IHdpdGggbmV3ICclUGFyYW0nIGFuZCAnJVVzZXJEYXRhJwogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICRLZXJuZWw6Ok9NLT5PYmplY3RzRGlzY2FyZCggT2JqZWN0cyA9PiBbJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnXSApOwogICAgICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgICAgICMgdXBkYXRlIGxhc3QgcmVxdWVzdCB0aW1lCiAgICAgICAgaWYgKCAhJFBhcmFtT2JqZWN0LT5Jc0FKQVhSZXF1ZXN0KCkgKSB7CiAgICAgICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICAgICAgJFNlc3Npb25PYmplY3QtPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkUGFyYW17U2Vzc2lvbklEfSwKICAgICAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlckxhc3RSZXF1ZXN0JywKICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkRGF0ZVRpbWVPYmplY3QtPlRvRXBvY2goKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgcHJlIGFwcGxpY2F0aW9uIG1vZHVsZQogICAgICAgIG15ICRQcmVNb2R1bGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxQcmVBcHBsaWNhdGlvbk1vZHVsZScpOwogICAgICAgIGlmICgkUHJlTW9kdWxlKSB7CiAgICAgICAgICAgIG15ICVQcmVNb2R1bGVMaXN0OwogICAgICAgICAgICBpZiAoIHJlZiAkUHJlTW9kdWxlIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgICVQcmVNb2R1bGVMaXN0ID0gJXskUHJlTW9kdWxlfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQcmVNb2R1bGVMaXN0e0luaXR9ID0gJFByZU1vZHVsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTU9EVUxFOgogICAgICAgICAgICBmb3IgbXkgJFByZU1vZHVsZUtleSAoIHNvcnQga2V5cyAlUHJlTW9kdWxlTGlzdCApIHsKICAgICAgICAgICAgICAgIG15ICRQcmVNb2R1bGUgPSAkUHJlTW9kdWxlTGlzdHskUHJlTW9kdWxlS2V5fTsKICAgICAgICAgICAgICAgIG5leHQgTU9EVUxFIGlmICEkUHJlTW9kdWxlOwogICAgICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoJFByZU1vZHVsZSk7CgogICAgICAgICAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ3VzdG9tZXJQYW5lbFByZUFwcGxpY2F0aW9uIG1vZHVsZSAkUHJlTW9kdWxlIGlzIHVzZWQuIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgdXNlIG1vZHVsZQogICAgICAgICAgICAgICAgbXkgJFByZU1vZHVsZU9iamVjdCA9ICRQcmVNb2R1bGUtPm5ldygKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJVVzZXJEYXRhLAoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJFByZU1vZHVsZU9iamVjdC0+UHJlUnVuKCk7CiAgICAgICAgICAgICAgICBpZiAoJE91dHB1dCkgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KCBPdXRwdXQgPT4gXCRPdXRwdXQgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259IC4gJy0+bmV3JywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRGcm9udGVuZE9iamVjdCA9ICggJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259ICktPm5ldygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICAgICBEZWJ1ZyAgICAgPT4gJFNlbGYtPntEZWJ1Z30sCiAgICAgICAgKTsKCiAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0tlcm5lbDo6TW9kdWxlczo6JyAuICRQYXJhbXtBY3Rpb259IC4gJy0+cnVuJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgLT5SdW4gJEFjdGlvbiB3aXRoICRGcm9udGVuZE9iamVjdAogICAgICAgICRMYXlvdXRPYmplY3QtPlByaW50KCBPdXRwdXQgPT4gXCRGcm9udGVuZE9iamVjdC0+UnVuKCkgKTsKCiAgICAgICAgIyBsb2cgcmVxdWVzdCB0aW1lCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BlcmZvcm1hbmNlTG9nJykgKSB7CiAgICAgICAgICAgIGlmICggKCAhJFF1ZXJ5U3RyaW5nICYmICRQYXJhbXtBY3Rpb259ICkgfHwgJFF1ZXJ5U3RyaW5nICF+IC9BY3Rpb249LyApIHsKICAgICAgICAgICAgICAgICRRdWVyeVN0cmluZyA9ICdBY3Rpb249JyAuICRQYXJhbXtBY3Rpb259IC4gJztTdWJhY3Rpb249JyAuICRQYXJhbXtTdWJhY3Rpb259OwogICAgICAgICAgICB9CiAgICAgICAgICAgIG15ICRGaWxlID0gJENvbmZpZ09iamVjdC0+R2V0KCdQZXJmb3JtYW5jZUxvZzo6RmlsZScpOwogICAgICAgICAgICAjIyBubyBjcml0aWMKICAgICAgICAgICAgaWYgKCBvcGVuIG15ICRPdXQsICc+PicsICRGaWxlICkgewogICAgICAgICAgICAgICAgIyMgdXNlIGNyaXRpYwogICAgICAgICAgICAgICAgcHJpbnQgJE91dCB0aW1lKCkKICAgICAgICAgICAgICAgICAgICAuICc6OkN1c3RvbWVyOjonCiAgICAgICAgICAgICAgICAgICAgLiAoIHRpbWUoKSAtICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gKQogICAgICAgICAgICAgICAgICAgIC4gIjo6JFVzZXJEYXRhe1VzZXJMb2dpbn06OiRRdWVyeVN0cmluZ1xuIjsKICAgICAgICAgICAgICAgIGNsb3NlICRPdXQ7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdSZXNwb25zZTo6Q3VzdG9tZXI6ICcKICAgICAgICAgICAgICAgICAgICAgICAgLiAoIHRpbWUoKSAtICRTZWxmLT57UGVyZm9ybWFuY2VMb2dTdGFydH0gKQogICAgICAgICAgICAgICAgICAgICAgICAuICJzIHRha2VuIChVUkw6JFF1ZXJ5U3RyaW5nOiRVc2VyRGF0YXtVc2VyTG9naW59KSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3Qgd3JpdGUgJEZpbGU6ICQhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBwcmludCBhbiBlcnJvciBzY3JlZW4KICAgIG15ICVEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoCiAgICAgICAgU2Vzc2lvbklEID0+ICRQYXJhbXtTZXNzaW9uSUR9LAogICAgKTsKICAgICREYXRhe1VzZXJUaW1lWm9uZX0gPSAkU2VsZi0+X1VzZXJUaW1lWm9uZUdldCglRGF0YSk7CiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAlRGF0YSwKICAgICAgICB9LAogICAgKTsKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICAkTGF5b3V0T2JqZWN0LT5DdXN0b21lckZhdGFsRXJyb3IoCiAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgKTsKICAgIHJldHVybjsKfQoKPWJlZ2luIEludGVybmFsOgoKPWhlYWQyIF9DaGVja01vZHVsZVBlcm1pc3Npb24oKQoKbW9kdWxlIHBlcm1pc3Npb24gY2hlY2sKCiAgICAoJEFjY2Vzc1JvLCAkQWNjZXNzUncgPSAkQXV0b1Jlc3BvbnNlT2JqZWN0LT5fQ2hlY2tNb2R1bGVQZXJtaXNzaW9uKAogICAgICAgIE1vZHVsZVJlZyA9PiAkTW9kdWxlUmVnLAogICAgICAgICVVc2VyRGF0YSwKICAgICk7Cgo9Y3V0CgpzdWIgX0NoZWNrTW9kdWxlUGVybWlzc2lvbiB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRBY2Nlc3NSbyA9IDA7CiAgICBteSAkQWNjZXNzUncgPSAwOwoKICAgIFBFUk1JU1NJT046CiAgICBmb3IgbXkgJFBlcm1pc3Npb24gKHF3KEdyb3VwUm8gR3JvdXApKSB7CiAgICAgICAgbXkgJEFjY2Vzc09rID0gMDsKICAgICAgICBteSAkR3JvdXAgICAgPSAkUGFyYW17TW9kdWxlUmVnfS0+eyRQZXJtaXNzaW9ufTsKCiAgICAgICAgbmV4dCBQRVJNSVNTSU9OIGlmICEkR3JvdXA7CgogICAgICAgIG15ICRHcm91cE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwJyk7CgogICAgICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCRHcm91cCkgKSB7CiAgICAgICAgICAgIEdST1VQOgogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKCBAeyRHcm91cH0gKSB7CiAgICAgICAgICAgICAgICBuZXh0IEdST1VQIGlmICEkSXRlbTsKICAgICAgICAgICAgICAgIG5leHQgR1JPVVAgaWYgISRHcm91cE9iamVjdC0+UGVybWlzc2lvbkNoZWNrKAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICBHcm91cE5hbWUgPT4gJEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICRQZXJtaXNzaW9uIGVxICdHcm91cFJvJyA/ICdybycgOiAncncnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkQWNjZXNzT2sgPSAxOwogICAgICAgICAgICAgICAgbGFzdCBHUk9VUDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbXkgJEhhc1Blcm1pc3Npb24gPSAkR3JvdXBPYmplY3QtPlBlcm1pc3Npb25DaGVjaygKICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9PiAkR3JvdXAsCiAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJFBlcm1pc3Npb24gZXEgJ0dyb3VwUm8nID8gJ3JvJyA6ICdydycsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICgkSGFzUGVybWlzc2lvbikgewogICAgICAgICAgICAgICAgJEFjY2Vzc09rID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoICRQZXJtaXNzaW9uIGVxICdHcm91cCcgJiYgJEFjY2Vzc09rICkgewogICAgICAgICAgICAkQWNjZXNzUm8gPSAxOwogICAgICAgICAgICAkQWNjZXNzUncgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRQZXJtaXNzaW9uIGVxICdHcm91cFJvJyAmJiAkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICRBY2Nlc3NSbyA9IDE7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAoICRBY2Nlc3NSbywgJEFjY2Vzc1J3ICk7Cn0KCj1oZWFkMiBfVXNlclRpbWVab25lR2V0KCkKCkdldCB0aW1lIHpvbmUgZm9yIHRoZSBjdXJyZW50IHVzZXIuIFRoaXMgZnVuY3Rpb24gd2lsbCB2YWxpZGF0ZSBwYXNzZWQgdGltZSB6b25lIHBhcmFtZXRlciBhbmQgcmV0dXJuIGRlZmF1bHQgdXNlciB0aW1lCnpvbmUgaWYgaXQncyBub3QgdmFsaWQuCgogICAgbXkgJFVzZXJUaW1lWm9uZSA9ICRTZWxmLT5fVXNlclRpbWVab25lR2V0KAogICAgICAgIFVzZXJUaW1lWm9uZSA9PiAnRXVyb3BlL0JlcmxpbicsCiAgICApOwoKPWN1dAoKc3ViIF9Vc2VyVGltZVpvbmVHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkVXNlclRpbWVab25lOwoKICAgICMgUmV0dXJuIHBhc3NlZCB0aW1lIHpvbmUgb25seSBpZiBpdCdzIHZhbGlkLiBJdCBjYW4gaGFwcGVuIHRoYXQgdXNlciBwcmVmZXJlbmNlcyBvciBzZXNzaW9uIHN0b3JlIGFuIG9sZC1zdHlsZQogICAgIyAgIG9mZnNldCB3aGljaCBpcyBub3QgdmFsaWQgYW55bW9yZS4gSW4gdGhpcyBjYXNlLCByZXR1cm4gdGhlIGRlZmF1bHQgdmFsdWUuCiAgICAjICAgUGxlYXNlIHNlZSBidWcjMTMzNzQgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICBpZiAoCiAgICAgICAgJFBhcmFte1VzZXJUaW1lWm9uZX0KICAgICAgICAmJiBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUtPklzVGltZVpvbmVWYWxpZCggVGltZVpvbmUgPT4gJFBhcmFte1VzZXJUaW1lWm9uZX0gKQogICAgICAgICkKICAgIHsKICAgICAgICAkVXNlclRpbWVab25lID0gJFBhcmFte1VzZXJUaW1lWm9uZX07CiAgICB9CgogICAgJFVzZXJUaW1lWm9uZSB8fD0gS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lLT5Vc2VyRGVmYXVsdFRpbWVab25lR2V0KCk7CgogICAgcmV0dXJuICRVc2VyVGltZVpvbmU7Cn0KCj1lbmQgSW50ZXJuYWw6Cgo9Y3V0CgpzdWIgREVTVFJPWSB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgICMgZGVidWcgaW5mbwogICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2RlYnVnJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0dsb2JhbCBoYW5kbGUgc3RvcHBlZC4nLAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCjE7Cgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHBzOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMy4wLnR4dD4uCgo9Y3V0Cg==</File>
    </Filelist>
</otrs_package>